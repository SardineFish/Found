!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=71)}([function(t,e,n){"use strict";function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0}),r(n(36)),r(n(18)),r(n(42)),r(n(81));const s=i(n(51));e.plugins=s,r(n(51)),r(n(98))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(7),i=n(3);class s extends Array{get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get magnitude(){return Math.hypot(...this)}get normalized(){const t=this.magnitude;return 0==t?o.zero():this.clone().div(o(t,t,t))}get negative(){return this.clone().negate()}get inversed(){return this.clone().inverse()}constructor(t,e,n){super(t,e,n)}static zero(){return new s(0,0,0)}static one(){return new s(1,1,1)}plus(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this}minus(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}mul(t){return this[0]*=t[0],this[1]*=t[1],this[2]*=t[2],this}div(t){return this[0]/=t[0],this[1]/=t[1],this[2]/=t[2],this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}normalize(){const t=this.magnitude;return 0==t?o.zero():this.clone().div(o(t,t,t))}inverse(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this}negate(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this}cross(t){return o(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}clone(){return o(this[0],this[1],this[2])}toVec2(){return i.vec2(this[0],this[1])}__to(t){switch(t){case r.Vector4:return r.vec4(this[0],this[1],this[2],0);case i.Vector2:return i.vec2(this[0],this[1])}return this.clone()}}function o(t,e=t,n=t){return new s(t,e,n)}e.Vector3=s,e.vec3=o,o.from=t=>{const[e=0,n=0,r=0]=t;return o(e,n,r)},o.zero=s.zero,o.one=s.one},function(t,e,n){"use strict";let r;Object.defineProperty(e,"__esModule",{value:!0}),e.setGlobalContext=t=>r=t,e.GlobalContext=()=>r,e.GL=()=>e.GlobalContext().gl},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(7),i=n(1);class s extends Array{get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get magnitude(){return Math.hypot(...this)}get normalized(){const t=this.magnitude;return 0==t?o.zero():this.clone().div(o(t,t))}get negative(){return this.clone().negate()}get inversed(){return this.clone().inverse()}constructor(t,e){super(t,e)}static zero(){return new s(0,0)}static one(){return new s(1,1)}static up(){return new s(0,1)}static down(){return new s(0,-1)}static left(){return new s(-1,0)}static right(){return new s(1,0)}plus(t){return this[0]+=t[0],this[1]+=t[1],this}minus(t){return this[0]-=t[0],this[1]-=t[1],this}mul(t){return this[0]*=t[0],this[1]*=t[1],this}div(t){return this[0]/=t[0],this[1]/=t[1],this}dot(t){return this[0]*t[0]+this[1]*t[1]}normalize(){const t=this.magnitude;return 0==t?o.zero():this.clone().div(o(t,t))}inverse(){return this[0]=1/this[0],this[1]=1/this[1],this}negate(){return this[0]=-this[0],this[1]=-this[1],this}cross(t){return this.x*t.y-this.y*t.x}clone(){return o(this[0],this[1])}toVec3(t=0){return i.vec3(this[0],this[1],t)}__to(t){switch(t){case r.Vector4:return r.vec4(this[0],this[1],0,0);case i.Vector3:return i.vec3(this[0],this[1],0)}return this.clone()}}function o(t,e=t){return new s(t,e)}e.Vector2=s,e.vec2=o,o.from=t=>{const[e=0,n=0]=t;return o(e,n)},o.zero=s.zero,o.one=s.one,o.left=s.left,o.right=s.right,o.down=s.down,o.up=s.up},function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(31),e.panicNull=function(t,e){if(null===t)throw new Error(e);return t},e.panic=function(t){throw new Error(t)},e.warn=function(t){return console.warn(t),null},e.decorator=function(t,e,n=(t=>t)){const r=Symbol(t);return[t=>(void 0===t&&(t=e),Reflect.metadata(r,n(t))),(t,e)=>void 0===e?Reflect.getMetadata(r,t):Reflect.getMetadata(r,t,e)]},e.getUniformsLocation=function(t,e,n){const r={};for(const i in n)r[i]=t.getUniformLocation(e,n[i]);return r},e.fillArray=function(t,e){const n=new Array(e);for(let r=0;r<e;r++)n[r]="function"==typeof t?t(r):t;return n};e.DoubleBuffer=class{constructor(t){this.currentIdx=0,this.buffers=[t(),t()]}get current(){return this.buffers[this.currentIdx%2]}set current(t){this.buffers[this.currentIdx%2]=t}get back(){return this.buffers[(this.currentIdx+1)%2]}set back(t){this.buffers[(this.currentIdx+1)%2]=t}update(){this.currentIdx++}},e.setImmediate=function(t){setTimeout(t,0)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(7);class i extends r.Vector4{get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get b(){return this[2]}set b(t){this[2]=t}get a(){return this[3]}set a(t){this[3]=t}constructor(t,e,n,r=1){super(t,e,n,r)}static get white(){return new i(1,1,1)}static get transparent(){return new i(1,1,1,0)}static get black(){return new i(0,0,0)}static get red(){return new i(1,0,0)}static get green(){return new i(0,1,0)}static get blue(){return new i(0,0,1)}static get cyan(){return new i(0,1,1)}static get yellow(){return new i(1,1,0)}static get magenta(){return new i(1,0,1)}static get gray(){return new i(.5,.5,.5)}}e.Color=i,e.rgba=(t,e,n,r=1)=>new i(t,e,n,r),e.rgb=(t,e,n)=>new i(t,e,n,1)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(1),i=n(3);class s extends Array{get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}get magnitude(){return Math.hypot(...this)}get normalized(){const t=this.magnitude;return 0==t?o.zero():this.clone().div(o(t,t,t,t))}get negative(){return this.clone().negate()}get inversed(){return this.clone().inverse()}constructor(t,e,n=0,r=0){super(t,e,n||0,r||0)}static zero(){return new s(0,0,0,0)}static one(){return new s(1,1,1,1)}plus(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this[3]+=t[3],this}minus(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this[3]-=t[3],this}mul(t){return this[0]*=t[0],this[1]*=t[1],this[2]*=t[2],this[3]*=t[3],this}div(t){return this[0]/=t[0],this[1]/=t[1],this[2]/=t[2],this[3]/=t[3],this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3]}normalize(){const t=this.magnitude;return 0==t?o.zero():this.clone().div(o(t,t,t,t))}inverse(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this[3]=1/this[3],this}negate(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this[3]=-this[3],this}clone(){return o(this[0],this[1],this[2],this[3])}__to(t){switch(t){case s:return this.clone();case r.Vector3:return r.vec3(this[0],this[1],this[2]);case i.Vector2:return i.vec2(this[0],this[1])}return this.clone()}}function o(t,e=t,n=t,r=t){return new s(t,e,n,r)}e.Vector4=s,e.vec4=o,o.from=t=>{const[e=0,n=0,r=0,i=0]=t;return o(e,n,r,i)},o.zero=s.zero,o.one=s.one},function(t,e,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(t[r]=n[r])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var s={arraySet:function(t,e,n,r,i){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),i);else for(var s=0;s<r;s++)t[i+s]=e[n+s]},flattenChunks:function(t){var e,n,r,i,s,o;for(r=0,e=0,n=t.length;e<n;e++)r+=t[e].length;for(o=new Uint8Array(r),i=0,e=0,n=t.length;e<n;e++)s=t[e],o.set(s,i),i+=s.length;return o}},o={arraySet:function(t,e,n,r,i){for(var s=0;s<r;s++)t[i+s]=e[n+s]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,s)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,o))},e.setTyped(r)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(16),i=n(1),s=n(7);function o(t){return r.mat4.clone(t)}e.Matrix4x4=o,o.identity=()=>{const t=r.mat4.create();return r.mat4.identity(t)},o.rts=(t,n,i)=>{const s=e.mat4.identity();return r.mat4.fromRotationTranslationScale(s,t,n,i),s},o.translate=t=>{const n=e.mat4.identity();return r.mat4.translate(n,r.mat4.identity(n),t)},o.invert=t=>{const e=r.mat4.create();return r.mat4.invert(e,t),e},o.getTranslation=t=>{let e=i.vec3(0,0,0);return r.mat4.getTranslation(e,t),e},o.getRotation=t=>{let e=r.quat.create();return r.mat4.getRotation(e,t),e},o.getScaling=t=>{let e=i.vec3(0,0,0);return r.mat4.getScaling(e,t),e},o.mulPoint=(t,e)=>{let n=s.vec4(e.x,e.y,e.z,1),o=s.vec4.zero();return r.vec4.transformMat4(o,n,t),i.vec3(o.x,o.y,o.z)},o.mulVector=(t,e)=>{let n=s.vec4(e.x,e.y,e.z,0),o=s.vec4.zero();return r.vec4.transformMat4(o,n,t),i.vec3(o.x,o.y,o.z)},o.mulVec4=(t,e)=>{let n=s.vec4.zero();return r.vec4.transformMat4(n,e,t),n},o.perspective=(t,e,n,i)=>{const s=r.mat4.create();return r.mat4.perspective(s,t,e,n,i)},o.transpose=t=>r.mat4.transpose(r.mat4.create(),t),o.ortho=(t,e,n,i)=>{const s=r.mat4.create();return r.mat4.ortho(s,-e*t,e*t,-t,t,n,i),s},o.rotate=(t,e,n)=>r.mat4.rotate(r.mat4.create(),t,n,e),o.scale=(t,e)=>r.mat4.scale(r.mat4.create(),t,e),o.fromRotation=(t,e)=>r.mat4.fromRotation(r.mat4.create(),e,t),o.fromScaling=t=>r.mat4.fromScaling(r.mat4.create(),t),o.mul=(t,e,n)=>(n||(n=e,e=t,t=r.mat4.create()),r.mat4.mul(t,e,n)),e.mat4=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(5),i=n(19);e.Asset=class{constructor(t){this.destroyed=!1,this.assetID=e.AssetManager.newAssetID(this),this.name=t||"Asset_"+this.assetID}destroy(){this.destroyed=!0,e.AssetManager.destroy(this.assetID)}};e.AssetManager=new class{constructor(){this.assetsMap=new Map,this.id=1,this.eventEmitter=new i.EventEmitter}newAssetID(t){const e=++this.id;return this.assetsMap.set(e,t),r.setImmediate(()=>this.eventEmitter.emit("asset-created",t)),t.assetID=e}find(t){if("number"==typeof t)return this.assetsMap.get(t);if("string"==typeof t)for(const e of this.assetsMap.values())if(e.name===t)return e}destroy(t){const e=this.assetsMap.get(t);e&&(this.assetsMap.delete(t),r.setImmediate(()=>this.eventEmitter.emit("asset-destroyed",e)))}findAssetsOfType(t){return Array.from(this.assetsMap.values()).filter(e=>e instanceof t)}on(t,e){return this.eventEmitter.on(t,e)}off(t,e){return this.eventEmitter.off(t,e)}}},function(t,e,n){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.RGB=1]="RGB",t[t.RGBA=2]="RGBA",t[t.LUMINANCE_ALPHA=3]="LUMINANCE_ALPHA",t[t.LUMINANCE=4]="LUMINANCE",t[t.ALPHA=5]="ALPHA",t[t.R8=6]="R8",t[t.R16F=7]="R16F",t[t.R32F=8]="R32F",t[t.R8UI=9]="R8UI",t[t.RG8=10]="RG8",t[t.RG16F=11]="RG16F",t[t.RG32F=12]="RG32F",t[t.RG8UI=13]="RG8UI",t[t.RGB8=14]="RGB8",t[t.SRGB8=15]="SRGB8",t[t.RGB565=16]="RGB565",t[t.R11F_G11F_B10F=17]="R11F_G11F_B10F",t[t.RGB9_E5=18]="RGB9_E5",t[t.RGB16F=19]="RGB16F",t[t.RGB32F=20]="RGB32F",t[t.RGB8UI=21]="RGB8UI",t[t.RGBA8=22]="RGBA8",t[t.SRGB8_ALPHA8=23]="SRGB8_ALPHA8",t[t.RGB5_A1=24]="RGB5_A1",t[t.RGB10_A2=25]="RGB10_A2",t[t.RGBA4=26]="RGBA4",t[t.RGBA16F=27]="RGBA16F",t[t.RGBA32F=28]="RGBA32F",t[t.RGBA8UI=29]="RGBA8UI",t[t.DEPTH_COMPONENT=30]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=31]="DEPTH_STENCIL"}(r=e.TextureFormat||(e.TextureFormat={})),e.mapGLFormat=function(t,e){return{[r.RGB]:[t.RGB,t.RGB,t.UNSIGNED_BYTE],[r.RGBA]:[t.RGBA,t.RGBA,t.UNSIGNED_BYTE],[r.LUMINANCE_ALPHA]:[t.LUMINANCE_ALPHA,t.LUMINANCE_ALPHA,t.UNSIGNED_BYTE],[r.LUMINANCE]:[t.LUMINANCE,t.LUMINANCE,t.UNSIGNED_BYTE],[r.ALPHA]:[t.ALPHA,t.ALPHA,t.UNSIGNED_BYTE],[r.R8]:[t.R8,t.RED,t.UNSIGNED_BYTE],[r.R16F]:[t.R16F,t.RED,t.HALF_FLOAT],[r.R32F]:[t.R32F,t.RED,t.FLOAT],[r.R8UI]:[t.R8UI,t.RED_INTEGER,t.UNSIGNED_BYTE],[r.RG8]:[t.RG8,t.RG,t.UNSIGNED_BYTE],[r.RG16F]:[t.RG16F,t.RG,t.HALF_FLOAT],[r.RG32F]:[t.RG32F,t.RG,t.FLOAT],[r.RG8UI]:[t.RG8UI,t.RG_INTEGER,t.UNSIGNED_BYTE],[r.RGB8]:[t.RGB8,t.RGB,t.UNSIGNED_BYTE],[r.SRGB8]:[t.SRGB8,t.RGB,t.UNSIGNED_BYTE],[r.RGB565]:[t.RGB565,t.RGB,t.UNSIGNED_BYTE],[r.R11F_G11F_B10F]:[t.R11F_G11F_B10F,t.RGB,t.UNSIGNED_INT_10F_11F_11F_REV],[r.RGB9_E5]:[t.RGB9_E5,t.RGB,t.HALF_FLOAT],[r.RGB16F]:[t.RGB16F,t.RGB,t.HALF_FLOAT],[r.RGB32F]:[t.RGB32F,t.RGB,t.FLOAT],[r.RGB8UI]:[t.RGB8UI,t.RGB_INTEGER,t.UNSIGNED_BYTE],[r.RGBA8]:[t.RGBA8,t.RGBA,t.UNSIGNED_BYTE],[r.SRGB8_ALPHA8]:[t.SRGB8_ALPHA8,t.RGBA,t.UNSIGNED_BYTE],[r.RGB5_A1]:[t.RGB5_A1,t.RGBA,t.UNSIGNED_BYTE],[r.RGB10_A2]:[t.RGB10_A2,t.RGBA,t.UNSIGNED_INT_2_10_10_10_REV],[r.RGBA4]:[t.RGBA4,t.RGBA,t.UNSIGNED_BYTE],[r.RGBA16F]:[t.RGBA16F,t.RGBA,t.HALF_FLOAT],[r.RGBA32F]:[t.RGBA32F,t.RGBA,t.FLOAT],[r.RGBA8UI]:[t.RGBA8UI,t.RGBA_INTEGER,t.UNSIGNED_BYTE],[r.DEPTH_COMPONENT]:[t.DEPTH_COMPONENT,t.DEPTH_COMPONENT,t.UNSIGNED_INT],[r.DEPTH_STENCIL]:[t.DEPTH_STENCIL,t.DEPTH_COMPONENT,t.UNSIGNED_INT]}[e]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.boxRaycast=e.Rect=e.minAbs=e.floor2=e.floorReminder=void 0;const r=n(0);e.floorReminder=function(t,e){return t>=0?t%e:(e+t%e)%e},e.floor2=function(t){return r.vec2(Math.floor(t.x),Math.floor(t.y))},e.minAbs=function(t,e){return Math.abs(t)<=Math.abs(e)?t:e};e.Rect=class{constructor(t,e){this.min=t,this.max=r.plus(t,e)}get xMin(){return this.min.x}get yMin(){return this.min.y}get xMax(){return this.max.x}get yMax(){return this.max.y}},e.boxRaycast=function(t,e,n){if(0==(n=n.normalized).x&&0==n.y)return[!1,0,r.vec2.zero()];let i=r.vec2.zero(),s=r.vec2.zero();if(0==n.x)return i.y=(t.yMin-e.y)/n.y,s.y=(t.yMax-e.y)/n.y,i.x=s.x=Number.NEGATIVE_INFINITY,t.xMin<=e.x&&e.x<=t.xMax?i.y<s.y?[!0,i.y,r.vec2(0,-1)]:[!0,s.y,r.vec2(0,1)]:[!1,0,r.vec2.zero()];if(0==n.y)return i.x=(t.xMin-e.x)/n.x,s.x=(t.xMax-e.x)/n.x,i.y=s.y=Number.NEGATIVE_INFINITY,t.yMin<=e.y&&e.y<=t.yMax?i.x<s.x?[!0,i.x,r.vec2(-1,0)]:[!0,s.x,r.vec2(1,0)]:[!1,0,r.vec2.zero()];i=r.minus(t.min,e).div(n),s=r.minus(t.max,e).div(n);var o=i.x,a=s.x,u=r.vec2(-1,0),c=i.y,l=s.y,h=r.vec2(0,-1);return i.x>s.x&&(o=s.x,a=i.x,u=r.vec2(1,0)),i.y>s.y&&(c=s.y,l=i.y,h=r.vec2(0,1)),c>a||o>l?[!1,0,r.vec2.zero()]:o>c?[!0,o,u]:[!0,c,h]}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.loadAssets=e.Global=e.initGlobalEntities=void 0;const s=n(0),o=n(35),a=i(n(120)),u=n(26),c=i(n(62)),l=n(11);let h;e.initGlobalEntities=function(t){h=t},e.Global=function(){return h},e.loadAssets=function(){return r(this,void 0,void 0,(function*(){const t={};return yield Promise.all([u.loadImage(a.default).then(e=>{const n=new s.Texture2D;n.setData(e),t.spriteChest=new o.Sprite(n,s.vec2(4,4),s.vec2(0,3))}),u.loadImage(a.default).then(e=>{const n=new s.Texture2D;n.setData(e),t.mark=new o.Sprite(n,s.vec2(4,4),s.vec2(2,3))}),u.loadImage(c.default).then(e=>{const n=new s.Texture2D(e.width,e.height,l.TextureFormat.RGB,s.FilterMode.Nearest);n.setData(e);const r={};for(let t=0;t<7;t++)for(let e=0;e<7;e++)r[`[${e},${t}]`]=new o.Sprite(n,s.vec2(7,7),s.vec2(e,t));t.tiles=r})]),t}))}},function(t,e,n){"use strict";n.r(e),n.d(e,"glMatrix",(function(){return r})),n.d(e,"mat2",(function(){return i})),n.d(e,"mat2d",(function(){return s})),n.d(e,"mat3",(function(){return o})),n.d(e,"mat4",(function(){return a})),n.d(e,"quat",(function(){return l})),n.d(e,"quat2",(function(){return h})),n.d(e,"vec2",(function(){return d})),n.d(e,"vec3",(function(){return u})),n.d(e,"vec4",(function(){return c}));var r={};n.r(r),n.d(r,"EPSILON",(function(){return f})),n.d(r,"ARRAY_TYPE",(function(){return v})),n.d(r,"RANDOM",(function(){return p})),n.d(r,"setMatrixArrayType",(function(){return m})),n.d(r,"toRadian",(function(){return _})),n.d(r,"equals",(function(){return y}));var i={};n.r(i),n.d(i,"create",(function(){return b})),n.d(i,"clone",(function(){return w})),n.d(i,"copy",(function(){return M})),n.d(i,"identity",(function(){return x})),n.d(i,"fromValues",(function(){return T})),n.d(i,"set",(function(){return R})),n.d(i,"transpose",(function(){return k})),n.d(i,"invert",(function(){return E})),n.d(i,"adjoint",(function(){return P})),n.d(i,"determinant",(function(){return A})),n.d(i,"multiply",(function(){return S})),n.d(i,"rotate",(function(){return C})),n.d(i,"scale",(function(){return B})),n.d(i,"fromRotation",(function(){return D})),n.d(i,"fromScaling",(function(){return I})),n.d(i,"str",(function(){return F})),n.d(i,"frob",(function(){return L})),n.d(i,"LDU",(function(){return O})),n.d(i,"add",(function(){return N})),n.d(i,"subtract",(function(){return U})),n.d(i,"exactEquals",(function(){return G})),n.d(i,"equals",(function(){return z})),n.d(i,"multiplyScalar",(function(){return j})),n.d(i,"multiplyScalarAndAdd",(function(){return V})),n.d(i,"mul",(function(){return q})),n.d(i,"sub",(function(){return K}));var s={};n.r(s),n.d(s,"create",(function(){return W})),n.d(s,"clone",(function(){return H})),n.d(s,"copy",(function(){return Z})),n.d(s,"identity",(function(){return X})),n.d(s,"fromValues",(function(){return Y})),n.d(s,"set",(function(){return $})),n.d(s,"invert",(function(){return Q})),n.d(s,"determinant",(function(){return J})),n.d(s,"multiply",(function(){return tt})),n.d(s,"rotate",(function(){return et})),n.d(s,"scale",(function(){return nt})),n.d(s,"translate",(function(){return rt})),n.d(s,"fromRotation",(function(){return it})),n.d(s,"fromScaling",(function(){return st})),n.d(s,"fromTranslation",(function(){return ot})),n.d(s,"str",(function(){return at})),n.d(s,"frob",(function(){return ut})),n.d(s,"add",(function(){return ct})),n.d(s,"subtract",(function(){return lt})),n.d(s,"multiplyScalar",(function(){return ht})),n.d(s,"multiplyScalarAndAdd",(function(){return dt})),n.d(s,"exactEquals",(function(){return ft})),n.d(s,"equals",(function(){return vt})),n.d(s,"mul",(function(){return pt})),n.d(s,"sub",(function(){return mt}));var o={};n.r(o),n.d(o,"create",(function(){return gt})),n.d(o,"fromMat4",(function(){return _t})),n.d(o,"clone",(function(){return yt})),n.d(o,"copy",(function(){return bt})),n.d(o,"fromValues",(function(){return wt})),n.d(o,"set",(function(){return Mt})),n.d(o,"identity",(function(){return xt})),n.d(o,"transpose",(function(){return Tt})),n.d(o,"invert",(function(){return Rt})),n.d(o,"adjoint",(function(){return kt})),n.d(o,"determinant",(function(){return Et})),n.d(o,"multiply",(function(){return Pt})),n.d(o,"translate",(function(){return At})),n.d(o,"rotate",(function(){return St})),n.d(o,"scale",(function(){return Ct})),n.d(o,"fromTranslation",(function(){return Bt})),n.d(o,"fromRotation",(function(){return Dt})),n.d(o,"fromScaling",(function(){return It})),n.d(o,"fromMat2d",(function(){return Ft})),n.d(o,"fromQuat",(function(){return Lt})),n.d(o,"normalFromMat4",(function(){return Ot})),n.d(o,"projection",(function(){return Nt})),n.d(o,"str",(function(){return Ut})),n.d(o,"frob",(function(){return Gt})),n.d(o,"add",(function(){return zt})),n.d(o,"subtract",(function(){return jt})),n.d(o,"multiplyScalar",(function(){return Vt})),n.d(o,"multiplyScalarAndAdd",(function(){return qt})),n.d(o,"exactEquals",(function(){return Kt})),n.d(o,"equals",(function(){return Wt})),n.d(o,"mul",(function(){return Ht})),n.d(o,"sub",(function(){return Zt}));var a={};n.r(a),n.d(a,"create",(function(){return Xt})),n.d(a,"clone",(function(){return Yt})),n.d(a,"copy",(function(){return $t})),n.d(a,"fromValues",(function(){return Qt})),n.d(a,"set",(function(){return Jt})),n.d(a,"identity",(function(){return te})),n.d(a,"transpose",(function(){return ee})),n.d(a,"invert",(function(){return ne})),n.d(a,"adjoint",(function(){return re})),n.d(a,"determinant",(function(){return ie})),n.d(a,"multiply",(function(){return se})),n.d(a,"translate",(function(){return oe})),n.d(a,"scale",(function(){return ae})),n.d(a,"rotate",(function(){return ue})),n.d(a,"rotateX",(function(){return ce})),n.d(a,"rotateY",(function(){return le})),n.d(a,"rotateZ",(function(){return he})),n.d(a,"fromTranslation",(function(){return de})),n.d(a,"fromScaling",(function(){return fe})),n.d(a,"fromRotation",(function(){return ve})),n.d(a,"fromXRotation",(function(){return pe})),n.d(a,"fromYRotation",(function(){return me})),n.d(a,"fromZRotation",(function(){return ge})),n.d(a,"fromRotationTranslation",(function(){return _e})),n.d(a,"fromQuat2",(function(){return ye})),n.d(a,"getTranslation",(function(){return be})),n.d(a,"getScaling",(function(){return we})),n.d(a,"getRotation",(function(){return Me})),n.d(a,"fromRotationTranslationScale",(function(){return xe})),n.d(a,"fromRotationTranslationScaleOrigin",(function(){return Te})),n.d(a,"fromQuat",(function(){return Re})),n.d(a,"frustum",(function(){return ke})),n.d(a,"perspective",(function(){return Ee})),n.d(a,"perspectiveFromFieldOfView",(function(){return Pe})),n.d(a,"ortho",(function(){return Ae})),n.d(a,"lookAt",(function(){return Se})),n.d(a,"targetTo",(function(){return Ce})),n.d(a,"str",(function(){return Be})),n.d(a,"frob",(function(){return De})),n.d(a,"add",(function(){return Ie})),n.d(a,"subtract",(function(){return Fe})),n.d(a,"multiplyScalar",(function(){return Le})),n.d(a,"multiplyScalarAndAdd",(function(){return Oe})),n.d(a,"exactEquals",(function(){return Ne})),n.d(a,"equals",(function(){return Ue})),n.d(a,"mul",(function(){return Ge})),n.d(a,"sub",(function(){return ze}));var u={};n.r(u),n.d(u,"create",(function(){return je})),n.d(u,"clone",(function(){return Ve})),n.d(u,"length",(function(){return qe})),n.d(u,"fromValues",(function(){return Ke})),n.d(u,"copy",(function(){return We})),n.d(u,"set",(function(){return He})),n.d(u,"add",(function(){return Ze})),n.d(u,"subtract",(function(){return Xe})),n.d(u,"multiply",(function(){return Ye})),n.d(u,"divide",(function(){return $e})),n.d(u,"ceil",(function(){return Qe})),n.d(u,"floor",(function(){return Je})),n.d(u,"min",(function(){return tn})),n.d(u,"max",(function(){return en})),n.d(u,"round",(function(){return nn})),n.d(u,"scale",(function(){return rn})),n.d(u,"scaleAndAdd",(function(){return sn})),n.d(u,"distance",(function(){return on})),n.d(u,"squaredDistance",(function(){return an})),n.d(u,"squaredLength",(function(){return un})),n.d(u,"negate",(function(){return cn})),n.d(u,"inverse",(function(){return ln})),n.d(u,"normalize",(function(){return hn})),n.d(u,"dot",(function(){return dn})),n.d(u,"cross",(function(){return fn})),n.d(u,"lerp",(function(){return vn})),n.d(u,"hermite",(function(){return pn})),n.d(u,"bezier",(function(){return mn})),n.d(u,"random",(function(){return gn})),n.d(u,"transformMat4",(function(){return _n})),n.d(u,"transformMat3",(function(){return yn})),n.d(u,"transformQuat",(function(){return bn})),n.d(u,"rotateX",(function(){return wn})),n.d(u,"rotateY",(function(){return Mn})),n.d(u,"rotateZ",(function(){return xn})),n.d(u,"angle",(function(){return Tn})),n.d(u,"zero",(function(){return Rn})),n.d(u,"str",(function(){return kn})),n.d(u,"exactEquals",(function(){return En})),n.d(u,"equals",(function(){return Pn})),n.d(u,"sub",(function(){return Sn})),n.d(u,"mul",(function(){return Cn})),n.d(u,"div",(function(){return Bn})),n.d(u,"dist",(function(){return Dn})),n.d(u,"sqrDist",(function(){return In})),n.d(u,"len",(function(){return Fn})),n.d(u,"sqrLen",(function(){return Ln})),n.d(u,"forEach",(function(){return On}));var c={};n.r(c),n.d(c,"create",(function(){return Nn})),n.d(c,"clone",(function(){return Un})),n.d(c,"fromValues",(function(){return Gn})),n.d(c,"copy",(function(){return zn})),n.d(c,"set",(function(){return jn})),n.d(c,"add",(function(){return Vn})),n.d(c,"subtract",(function(){return qn})),n.d(c,"multiply",(function(){return Kn})),n.d(c,"divide",(function(){return Wn})),n.d(c,"ceil",(function(){return Hn})),n.d(c,"floor",(function(){return Zn})),n.d(c,"min",(function(){return Xn})),n.d(c,"max",(function(){return Yn})),n.d(c,"round",(function(){return $n})),n.d(c,"scale",(function(){return Qn})),n.d(c,"scaleAndAdd",(function(){return Jn})),n.d(c,"distance",(function(){return tr})),n.d(c,"squaredDistance",(function(){return er})),n.d(c,"length",(function(){return nr})),n.d(c,"squaredLength",(function(){return rr})),n.d(c,"negate",(function(){return ir})),n.d(c,"inverse",(function(){return sr})),n.d(c,"normalize",(function(){return or})),n.d(c,"dot",(function(){return ar})),n.d(c,"cross",(function(){return ur})),n.d(c,"lerp",(function(){return cr})),n.d(c,"random",(function(){return lr})),n.d(c,"transformMat4",(function(){return hr})),n.d(c,"transformQuat",(function(){return dr})),n.d(c,"zero",(function(){return fr})),n.d(c,"str",(function(){return vr})),n.d(c,"exactEquals",(function(){return pr})),n.d(c,"equals",(function(){return mr})),n.d(c,"sub",(function(){return gr})),n.d(c,"mul",(function(){return _r})),n.d(c,"div",(function(){return yr})),n.d(c,"dist",(function(){return br})),n.d(c,"sqrDist",(function(){return wr})),n.d(c,"len",(function(){return Mr})),n.d(c,"sqrLen",(function(){return xr})),n.d(c,"forEach",(function(){return Tr}));var l={};n.r(l),n.d(l,"create",(function(){return Rr})),n.d(l,"identity",(function(){return kr})),n.d(l,"setAxisAngle",(function(){return Er})),n.d(l,"getAxisAngle",(function(){return Pr})),n.d(l,"getAngle",(function(){return Ar})),n.d(l,"multiply",(function(){return Sr})),n.d(l,"rotateX",(function(){return Cr})),n.d(l,"rotateY",(function(){return Br})),n.d(l,"rotateZ",(function(){return Dr})),n.d(l,"calculateW",(function(){return Ir})),n.d(l,"exp",(function(){return Fr})),n.d(l,"ln",(function(){return Lr})),n.d(l,"pow",(function(){return Or})),n.d(l,"slerp",(function(){return Nr})),n.d(l,"random",(function(){return Ur})),n.d(l,"invert",(function(){return Gr})),n.d(l,"conjugate",(function(){return zr})),n.d(l,"fromMat3",(function(){return jr})),n.d(l,"fromEuler",(function(){return Vr})),n.d(l,"str",(function(){return qr})),n.d(l,"clone",(function(){return $r})),n.d(l,"fromValues",(function(){return Qr})),n.d(l,"copy",(function(){return Jr})),n.d(l,"set",(function(){return ti})),n.d(l,"add",(function(){return ei})),n.d(l,"mul",(function(){return ni})),n.d(l,"scale",(function(){return ri})),n.d(l,"dot",(function(){return ii})),n.d(l,"lerp",(function(){return si})),n.d(l,"length",(function(){return oi})),n.d(l,"len",(function(){return ai})),n.d(l,"squaredLength",(function(){return ui})),n.d(l,"sqrLen",(function(){return ci})),n.d(l,"normalize",(function(){return li})),n.d(l,"exactEquals",(function(){return hi})),n.d(l,"equals",(function(){return di})),n.d(l,"rotationTo",(function(){return fi})),n.d(l,"sqlerp",(function(){return vi})),n.d(l,"setAxes",(function(){return pi}));var h={};n.r(h),n.d(h,"create",(function(){return mi})),n.d(h,"clone",(function(){return gi})),n.d(h,"fromValues",(function(){return _i})),n.d(h,"fromRotationTranslationValues",(function(){return yi})),n.d(h,"fromRotationTranslation",(function(){return bi})),n.d(h,"fromTranslation",(function(){return wi})),n.d(h,"fromRotation",(function(){return Mi})),n.d(h,"fromMat4",(function(){return xi})),n.d(h,"copy",(function(){return Ti})),n.d(h,"identity",(function(){return Ri})),n.d(h,"set",(function(){return ki})),n.d(h,"getReal",(function(){return Ei})),n.d(h,"getDual",(function(){return Pi})),n.d(h,"setReal",(function(){return Ai})),n.d(h,"setDual",(function(){return Si})),n.d(h,"getTranslation",(function(){return Ci})),n.d(h,"translate",(function(){return Bi})),n.d(h,"rotateX",(function(){return Di})),n.d(h,"rotateY",(function(){return Ii})),n.d(h,"rotateZ",(function(){return Fi})),n.d(h,"rotateByQuatAppend",(function(){return Li})),n.d(h,"rotateByQuatPrepend",(function(){return Oi})),n.d(h,"rotateAroundAxis",(function(){return Ni})),n.d(h,"add",(function(){return Ui})),n.d(h,"multiply",(function(){return Gi})),n.d(h,"mul",(function(){return zi})),n.d(h,"scale",(function(){return ji})),n.d(h,"dot",(function(){return Vi})),n.d(h,"lerp",(function(){return qi})),n.d(h,"invert",(function(){return Ki})),n.d(h,"conjugate",(function(){return Wi})),n.d(h,"length",(function(){return Hi})),n.d(h,"len",(function(){return Zi})),n.d(h,"squaredLength",(function(){return Xi})),n.d(h,"sqrLen",(function(){return Yi})),n.d(h,"normalize",(function(){return $i})),n.d(h,"str",(function(){return Qi})),n.d(h,"exactEquals",(function(){return Ji})),n.d(h,"equals",(function(){return ts}));var d={};n.r(d),n.d(d,"create",(function(){return es})),n.d(d,"clone",(function(){return ns})),n.d(d,"fromValues",(function(){return rs})),n.d(d,"copy",(function(){return is})),n.d(d,"set",(function(){return ss})),n.d(d,"add",(function(){return os})),n.d(d,"subtract",(function(){return as})),n.d(d,"multiply",(function(){return us})),n.d(d,"divide",(function(){return cs})),n.d(d,"ceil",(function(){return ls})),n.d(d,"floor",(function(){return hs})),n.d(d,"min",(function(){return ds})),n.d(d,"max",(function(){return fs})),n.d(d,"round",(function(){return vs})),n.d(d,"scale",(function(){return ps})),n.d(d,"scaleAndAdd",(function(){return ms})),n.d(d,"distance",(function(){return gs})),n.d(d,"squaredDistance",(function(){return _s})),n.d(d,"length",(function(){return ys})),n.d(d,"squaredLength",(function(){return bs})),n.d(d,"negate",(function(){return ws})),n.d(d,"inverse",(function(){return Ms})),n.d(d,"normalize",(function(){return xs})),n.d(d,"dot",(function(){return Ts})),n.d(d,"cross",(function(){return Rs})),n.d(d,"lerp",(function(){return ks})),n.d(d,"random",(function(){return Es})),n.d(d,"transformMat2",(function(){return Ps})),n.d(d,"transformMat2d",(function(){return As})),n.d(d,"transformMat3",(function(){return Ss})),n.d(d,"transformMat4",(function(){return Cs})),n.d(d,"rotate",(function(){return Bs})),n.d(d,"angle",(function(){return Ds})),n.d(d,"zero",(function(){return Is})),n.d(d,"str",(function(){return Fs})),n.d(d,"exactEquals",(function(){return Ls})),n.d(d,"equals",(function(){return Os})),n.d(d,"len",(function(){return Ns})),n.d(d,"sub",(function(){return Us})),n.d(d,"mul",(function(){return Gs})),n.d(d,"div",(function(){return zs})),n.d(d,"dist",(function(){return js})),n.d(d,"sqrDist",(function(){return Vs})),n.d(d,"sqrLen",(function(){return qs})),n.d(d,"forEach",(function(){return Ks}));var f=1e-6,v="undefined"!=typeof Float32Array?Float32Array:Array,p=Math.random;function m(t){v=t}var g=Math.PI/180;function _(t){return t*g}function y(t,e){return Math.abs(t-e)<=f*Math.max(1,Math.abs(t),Math.abs(e))}function b(){var t=new v(4);return v!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function w(t){var e=new v(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function M(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function x(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function T(t,e,n,r){var i=new v(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function R(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function k(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function E(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*s-i*r;return o?(o=1/o,t[0]=s*o,t[1]=-r*o,t[2]=-i*o,t[3]=n*o,t):null}function P(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t}function A(t){return t[0]*t[3]-t[2]*t[1]}function S(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=n[0],u=n[1],c=n[2],l=n[3];return t[0]=r*a+s*u,t[1]=i*a+o*u,t[2]=r*c+s*l,t[3]=i*c+o*l,t}function C(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u+s*a,t[1]=i*u+o*a,t[2]=r*-a+s*u,t[3]=i*-a+o*u,t}function B(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=n[0],u=n[1];return t[0]=r*a,t[1]=i*a,t[2]=s*u,t[3]=o*u,t}function D(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t}function I(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function F(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function L(t){return Math.hypot(t[0],t[1],t[2],t[3])}function O(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]}function N(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function U(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function G(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function z(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],o=e[0],a=e[1],u=e[2],c=e[3];return Math.abs(n-o)<=f*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=f*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=f*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(s-c)<=f*Math.max(1,Math.abs(s),Math.abs(c))}function j(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function V(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var q=S,K=U;function W(){var t=new v(6);return v!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function H(t){var e=new v(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Z(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function X(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Y(t,e,n,r,i,s){var o=new v(6);return o[0]=t,o[1]=e,o[2]=n,o[3]=r,o[4]=i,o[5]=s,o}function $(t,e,n,r,i,s,o){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=s,t[5]=o,t}function Q(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=n*s-r*i;return u?(u=1/u,t[0]=s*u,t[1]=-r*u,t[2]=-i*u,t[3]=n*u,t[4]=(i*a-s*o)*u,t[5]=(r*o-n*a)*u,t):null}function J(t){return t[0]*t[3]-t[1]*t[2]}function tt(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=n[0],l=n[1],h=n[2],d=n[3],f=n[4],v=n[5];return t[0]=r*c+s*l,t[1]=i*c+o*l,t[2]=r*h+s*d,t[3]=i*h+o*d,t[4]=r*f+s*v+a,t[5]=i*f+o*v+u,t}function et(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=Math.sin(n),l=Math.cos(n);return t[0]=r*l+s*c,t[1]=i*l+o*c,t[2]=r*-c+s*l,t[3]=i*-c+o*l,t[4]=a,t[5]=u,t}function nt(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=n[0],l=n[1];return t[0]=r*c,t[1]=i*c,t[2]=s*l,t[3]=o*l,t[4]=a,t[5]=u,t}function rt(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=n[0],l=n[1];return t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=r*c+s*l+a,t[5]=i*c+o*l+u,t}function it(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t}function st(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function ot(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function at(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ut(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function ct(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t}function lt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}function ht(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t}function dt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t}function ft(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function vt(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=e[0],c=e[1],l=e[2],h=e[3],d=e[4],v=e[5];return Math.abs(n-u)<=f*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-c)<=f*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-l)<=f*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-h)<=f*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-d)<=f*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-v)<=f*Math.max(1,Math.abs(a),Math.abs(v))}var pt=tt,mt=lt;function gt(){var t=new v(9);return v!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function _t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function yt(t){var e=new v(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function bt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function wt(t,e,n,r,i,s,o,a,u){var c=new v(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c[4]=i,c[5]=s,c[6]=o,c[7]=a,c[8]=u,c}function Mt(t,e,n,r,i,s,o,a,u,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=c,t}function xt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Tt(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Rt(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],l=e[8],h=l*o-a*c,d=-l*s+a*u,f=c*s-o*u,v=n*h+r*d+i*f;return v?(v=1/v,t[0]=h*v,t[1]=(-l*r+i*c)*v,t[2]=(a*r-i*o)*v,t[3]=d*v,t[4]=(l*n-i*u)*v,t[5]=(-a*n+i*s)*v,t[6]=f*v,t[7]=(-c*n+r*u)*v,t[8]=(o*n-r*s)*v,t):null}function kt(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],l=e[8];return t[0]=o*l-a*c,t[1]=i*c-r*l,t[2]=r*a-i*o,t[3]=a*u-s*l,t[4]=n*l-i*u,t[5]=i*s-n*a,t[6]=s*c-o*u,t[7]=r*u-n*c,t[8]=n*o-r*s,t}function Et(t){var e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],c=t[8];return e*(c*s-o*u)+n*(-c*i+o*a)+r*(u*i-s*a)}function Pt(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],l=e[7],h=e[8],d=n[0],f=n[1],v=n[2],p=n[3],m=n[4],g=n[5],_=n[6],y=n[7],b=n[8];return t[0]=d*r+f*o+v*c,t[1]=d*i+f*a+v*l,t[2]=d*s+f*u+v*h,t[3]=p*r+m*o+g*c,t[4]=p*i+m*a+g*l,t[5]=p*s+m*u+g*h,t[6]=_*r+y*o+b*c,t[7]=_*i+y*a+b*l,t[8]=_*s+y*u+b*h,t}function At(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],l=e[7],h=e[8],d=n[0],f=n[1];return t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=d*r+f*o+c,t[7]=d*i+f*a+l,t[8]=d*s+f*u+h,t}function St(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],l=e[7],h=e[8],d=Math.sin(n),f=Math.cos(n);return t[0]=f*r+d*o,t[1]=f*i+d*a,t[2]=f*s+d*u,t[3]=f*o-d*r,t[4]=f*a-d*i,t[5]=f*u-d*s,t[6]=c,t[7]=l,t[8]=h,t}function Ct(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Bt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Dt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function It(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ft(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Lt(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,u=i+i,c=n*o,l=r*o,h=r*a,d=i*o,f=i*a,v=i*u,p=s*o,m=s*a,g=s*u;return t[0]=1-h-v,t[3]=l-g,t[6]=d+m,t[1]=l+g,t[4]=1-c-v,t[7]=f-p,t[2]=d-m,t[5]=f+p,t[8]=1-c-h,t}function Ot(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],l=e[8],h=e[9],d=e[10],f=e[11],v=e[12],p=e[13],m=e[14],g=e[15],_=n*a-r*o,y=n*u-i*o,b=n*c-s*o,w=r*u-i*a,M=r*c-s*a,x=i*c-s*u,T=l*p-h*v,R=l*m-d*v,k=l*g-f*v,E=h*m-d*p,P=h*g-f*p,A=d*g-f*m,S=_*A-y*P+b*E+w*k-M*R+x*T;return S?(S=1/S,t[0]=(a*A-u*P+c*E)*S,t[1]=(u*k-o*A-c*R)*S,t[2]=(o*P-a*k+c*T)*S,t[3]=(i*P-r*A-s*E)*S,t[4]=(n*A-i*k+s*R)*S,t[5]=(r*k-n*P-s*T)*S,t[6]=(p*x-m*M+g*w)*S,t[7]=(m*b-v*x-g*y)*S,t[8]=(v*M-p*b+g*_)*S,t):null}function Nt(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Ut(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Gt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function zt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function jt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function Vt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function qt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function Kt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Wt(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],c=t[7],l=t[8],h=e[0],d=e[1],v=e[2],p=e[3],m=e[4],g=e[5],_=e[6],y=e[7],b=e[8];return Math.abs(n-h)<=f*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-d)<=f*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-v)<=f*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(s-p)<=f*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(o-m)<=f*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-g)<=f*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(u-_)<=f*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(c-y)<=f*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(l-b)<=f*Math.max(1,Math.abs(l),Math.abs(b))}var Ht=Pt,Zt=jt;function Xt(){var t=new v(16);return v!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Yt(t){var e=new v(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function $t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Qt(t,e,n,r,i,s,o,a,u,c,l,h,d,f,p,m){var g=new v(16);return g[0]=t,g[1]=e,g[2]=n,g[3]=r,g[4]=i,g[5]=s,g[6]=o,g[7]=a,g[8]=u,g[9]=c,g[10]=l,g[11]=h,g[12]=d,g[13]=f,g[14]=p,g[15]=m,g}function Jt(t,e,n,r,i,s,o,a,u,c,l,h,d,f,v,p,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=c,t[9]=l,t[10]=h,t[11]=d,t[12]=f,t[13]=v,t[14]=p,t[15]=m,t}function te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ee(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ne(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],l=e[8],h=e[9],d=e[10],f=e[11],v=e[12],p=e[13],m=e[14],g=e[15],_=n*a-r*o,y=n*u-i*o,b=n*c-s*o,w=r*u-i*a,M=r*c-s*a,x=i*c-s*u,T=l*p-h*v,R=l*m-d*v,k=l*g-f*v,E=h*m-d*p,P=h*g-f*p,A=d*g-f*m,S=_*A-y*P+b*E+w*k-M*R+x*T;return S?(S=1/S,t[0]=(a*A-u*P+c*E)*S,t[1]=(i*P-r*A-s*E)*S,t[2]=(p*x-m*M+g*w)*S,t[3]=(d*M-h*x-f*w)*S,t[4]=(u*k-o*A-c*R)*S,t[5]=(n*A-i*k+s*R)*S,t[6]=(m*b-v*x-g*y)*S,t[7]=(l*x-d*b+f*y)*S,t[8]=(o*P-a*k+c*T)*S,t[9]=(r*k-n*P-s*T)*S,t[10]=(v*M-p*b+g*_)*S,t[11]=(h*b-l*M-f*_)*S,t[12]=(a*R-o*E-u*T)*S,t[13]=(n*E-r*R+i*T)*S,t[14]=(p*y-v*w-m*_)*S,t[15]=(l*w-h*y+d*_)*S,t):null}function re(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],l=e[8],h=e[9],d=e[10],f=e[11],v=e[12],p=e[13],m=e[14],g=e[15];return t[0]=a*(d*g-f*m)-h*(u*g-c*m)+p*(u*f-c*d),t[1]=-(r*(d*g-f*m)-h*(i*g-s*m)+p*(i*f-s*d)),t[2]=r*(u*g-c*m)-a*(i*g-s*m)+p*(i*c-s*u),t[3]=-(r*(u*f-c*d)-a*(i*f-s*d)+h*(i*c-s*u)),t[4]=-(o*(d*g-f*m)-l*(u*g-c*m)+v*(u*f-c*d)),t[5]=n*(d*g-f*m)-l*(i*g-s*m)+v*(i*f-s*d),t[6]=-(n*(u*g-c*m)-o*(i*g-s*m)+v*(i*c-s*u)),t[7]=n*(u*f-c*d)-o*(i*f-s*d)+l*(i*c-s*u),t[8]=o*(h*g-f*p)-l*(a*g-c*p)+v*(a*f-c*h),t[9]=-(n*(h*g-f*p)-l*(r*g-s*p)+v*(r*f-s*h)),t[10]=n*(a*g-c*p)-o*(r*g-s*p)+v*(r*c-s*a),t[11]=-(n*(a*f-c*h)-o*(r*f-s*h)+l*(r*c-s*a)),t[12]=-(o*(h*m-d*p)-l*(a*m-u*p)+v*(a*d-u*h)),t[13]=n*(h*m-d*p)-l*(r*m-i*p)+v*(r*d-i*h),t[14]=-(n*(a*m-u*p)-o*(r*m-i*p)+v*(r*u-i*a)),t[15]=n*(a*d-u*h)-o*(r*d-i*h)+l*(r*u-i*a),t}function ie(t){var e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],c=t[8],l=t[9],h=t[10],d=t[11],f=t[12],v=t[13],p=t[14],m=t[15];return(e*o-n*s)*(h*m-d*p)-(e*a-r*s)*(l*m-d*v)+(e*u-i*s)*(l*p-h*v)+(n*a-r*o)*(c*m-d*f)-(n*u-i*o)*(c*p-h*f)+(r*u-i*a)*(c*v-l*f)}function se(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],l=e[7],h=e[8],d=e[9],f=e[10],v=e[11],p=e[12],m=e[13],g=e[14],_=e[15],y=n[0],b=n[1],w=n[2],M=n[3];return t[0]=y*r+b*a+w*h+M*p,t[1]=y*i+b*u+w*d+M*m,t[2]=y*s+b*c+w*f+M*g,t[3]=y*o+b*l+w*v+M*_,y=n[4],b=n[5],w=n[6],M=n[7],t[4]=y*r+b*a+w*h+M*p,t[5]=y*i+b*u+w*d+M*m,t[6]=y*s+b*c+w*f+M*g,t[7]=y*o+b*l+w*v+M*_,y=n[8],b=n[9],w=n[10],M=n[11],t[8]=y*r+b*a+w*h+M*p,t[9]=y*i+b*u+w*d+M*m,t[10]=y*s+b*c+w*f+M*g,t[11]=y*o+b*l+w*v+M*_,y=n[12],b=n[13],w=n[14],M=n[15],t[12]=y*r+b*a+w*h+M*p,t[13]=y*i+b*u+w*d+M*m,t[14]=y*s+b*c+w*f+M*g,t[15]=y*o+b*l+w*v+M*_,t}function oe(t,e,n){var r,i,s,o,a,u,c,l,h,d,f,v,p=n[0],m=n[1],g=n[2];return e===t?(t[12]=e[0]*p+e[4]*m+e[8]*g+e[12],t[13]=e[1]*p+e[5]*m+e[9]*g+e[13],t[14]=e[2]*p+e[6]*m+e[10]*g+e[14],t[15]=e[3]*p+e[7]*m+e[11]*g+e[15]):(r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],l=e[7],h=e[8],d=e[9],f=e[10],v=e[11],t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=c,t[7]=l,t[8]=h,t[9]=d,t[10]=f,t[11]=v,t[12]=r*p+a*m+h*g+e[12],t[13]=i*p+u*m+d*g+e[13],t[14]=s*p+c*m+f*g+e[14],t[15]=o*p+l*m+v*g+e[15]),t}function ae(t,e,n){var r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ue(t,e,n,r){var i,s,o,a,u,c,l,h,d,v,p,m,g,_,y,b,w,M,x,T,R,k,E,P,A=r[0],S=r[1],C=r[2],B=Math.hypot(A,S,C);return B<f?null:(A*=B=1/B,S*=B,C*=B,i=Math.sin(n),o=1-(s=Math.cos(n)),a=e[0],u=e[1],c=e[2],l=e[3],h=e[4],d=e[5],v=e[6],p=e[7],m=e[8],g=e[9],_=e[10],y=e[11],b=A*A*o+s,w=S*A*o+C*i,M=C*A*o-S*i,x=A*S*o-C*i,T=S*S*o+s,R=C*S*o+A*i,k=A*C*o+S*i,E=S*C*o-A*i,P=C*C*o+s,t[0]=a*b+h*w+m*M,t[1]=u*b+d*w+g*M,t[2]=c*b+v*w+_*M,t[3]=l*b+p*w+y*M,t[4]=a*x+h*T+m*R,t[5]=u*x+d*T+g*R,t[6]=c*x+v*T+_*R,t[7]=l*x+p*T+y*R,t[8]=a*k+h*E+m*P,t[9]=u*k+d*E+g*P,t[10]=c*k+v*E+_*P,t[11]=l*k+p*E+y*P,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ce(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],u=e[7],c=e[8],l=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*r,t[5]=o*i+l*r,t[6]=a*i+h*r,t[7]=u*i+d*r,t[8]=c*i-s*r,t[9]=l*i-o*r,t[10]=h*i-a*r,t[11]=d*i-u*r,t}function le(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],u=e[3],c=e[8],l=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*r,t[1]=o*i-l*r,t[2]=a*i-h*r,t[3]=u*i-d*r,t[8]=s*r+c*i,t[9]=o*r+l*i,t[10]=a*r+h*i,t[11]=u*r+d*i,t}function he(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],u=e[3],c=e[4],l=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*r,t[1]=o*i+l*r,t[2]=a*i+h*r,t[3]=u*i+d*r,t[4]=c*i-s*r,t[5]=l*i-o*r,t[6]=h*i-a*r,t[7]=d*i-u*r,t}function de(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function fe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ve(t,e,n){var r,i,s,o=n[0],a=n[1],u=n[2],c=Math.hypot(o,a,u);return c<f?null:(o*=c=1/c,a*=c,u*=c,r=Math.sin(e),s=1-(i=Math.cos(e)),t[0]=o*o*s+i,t[1]=a*o*s+u*r,t[2]=u*o*s-a*r,t[3]=0,t[4]=o*a*s-u*r,t[5]=a*a*s+i,t[6]=u*a*s+o*r,t[7]=0,t[8]=o*u*s+a*r,t[9]=a*u*s-o*r,t[10]=u*u*s+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function pe(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function me(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ge(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _e(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=r+r,u=i+i,c=s+s,l=r*a,h=r*u,d=r*c,f=i*u,v=i*c,p=s*c,m=o*a,g=o*u,_=o*c;return t[0]=1-(f+p),t[1]=h+_,t[2]=d-g,t[3]=0,t[4]=h-_,t[5]=1-(l+p),t[6]=v+m,t[7]=0,t[8]=d+g,t[9]=v-m,t[10]=1-(l+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ye(t,e){var n=new v(3),r=-e[0],i=-e[1],s=-e[2],o=e[3],a=e[4],u=e[5],c=e[6],l=e[7],h=r*r+i*i+s*s+o*o;return h>0?(n[0]=2*(a*o+l*r+u*s-c*i)/h,n[1]=2*(u*o+l*i+c*r-a*s)/h,n[2]=2*(c*o+l*s+a*i-u*r)/h):(n[0]=2*(a*o+l*r+u*s-c*i),n[1]=2*(u*o+l*i+c*r-a*s),n[2]=2*(c*o+l*s+a*i-u*r)),_e(t,e,n),t}function be(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function we(t,e){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],a=e[6],u=e[8],c=e[9],l=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(u,c,l),t}function Me(t,e){var n=new v(3);we(n,e);var r=1/n[0],i=1/n[1],s=1/n[2],o=e[0]*r,a=e[1]*i,u=e[2]*s,c=e[4]*r,l=e[5]*i,h=e[6]*s,d=e[8]*r,f=e[9]*i,p=e[10]*s,m=o+l+p,g=0;return m>0?(g=2*Math.sqrt(m+1),t[3]=.25*g,t[0]=(h-f)/g,t[1]=(d-u)/g,t[2]=(a-c)/g):o>l&&o>p?(g=2*Math.sqrt(1+o-l-p),t[3]=(h-f)/g,t[0]=.25*g,t[1]=(a+c)/g,t[2]=(d+u)/g):l>p?(g=2*Math.sqrt(1+l-o-p),t[3]=(d-u)/g,t[0]=(a+c)/g,t[1]=.25*g,t[2]=(h+f)/g):(g=2*Math.sqrt(1+p-o-l),t[3]=(a-c)/g,t[0]=(d+u)/g,t[1]=(h+f)/g,t[2]=.25*g),t}function xe(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=e[3],u=i+i,c=s+s,l=o+o,h=i*u,d=i*c,f=i*l,v=s*c,p=s*l,m=o*l,g=a*u,_=a*c,y=a*l,b=r[0],w=r[1],M=r[2];return t[0]=(1-(v+m))*b,t[1]=(d+y)*b,t[2]=(f-_)*b,t[3]=0,t[4]=(d-y)*w,t[5]=(1-(h+m))*w,t[6]=(p+g)*w,t[7]=0,t[8]=(f+_)*M,t[9]=(p-g)*M,t[10]=(1-(h+v))*M,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Te(t,e,n,r,i){var s=e[0],o=e[1],a=e[2],u=e[3],c=s+s,l=o+o,h=a+a,d=s*c,f=s*l,v=s*h,p=o*l,m=o*h,g=a*h,_=u*c,y=u*l,b=u*h,w=r[0],M=r[1],x=r[2],T=i[0],R=i[1],k=i[2],E=(1-(p+g))*w,P=(f+b)*w,A=(v-y)*w,S=(f-b)*M,C=(1-(d+g))*M,B=(m+_)*M,D=(v+y)*x,I=(m-_)*x,F=(1-(d+p))*x;return t[0]=E,t[1]=P,t[2]=A,t[3]=0,t[4]=S,t[5]=C,t[6]=B,t[7]=0,t[8]=D,t[9]=I,t[10]=F,t[11]=0,t[12]=n[0]+T-(E*T+S*R+D*k),t[13]=n[1]+R-(P*T+C*R+I*k),t[14]=n[2]+k-(A*T+B*R+F*k),t[15]=1,t}function Re(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,u=i+i,c=n*o,l=r*o,h=r*a,d=i*o,f=i*a,v=i*u,p=s*o,m=s*a,g=s*u;return t[0]=1-h-v,t[1]=l+g,t[2]=d-m,t[3]=0,t[4]=l-g,t[5]=1-c-v,t[6]=f+p,t[7]=0,t[8]=d+m,t[9]=f-p,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ke(t,e,n,r,i,s,o){var a=1/(n-e),u=1/(i-r),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*u,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*u,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function Ee(t,e,n,r,i){var s,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(s=1/(r-i),t[10]=(i+r)*s,t[14]=2*i*r*s):(t[10]=-1,t[14]=-2*r),t}function Pe(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),u=2/(o+a),c=2/(i+s);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*u*.5,t[9]=(i-s)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Ae(t,e,n,r,i,s,o){var a=1/(e-n),u=1/(r-i),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*u,t[14]=(o+s)*c,t[15]=1,t}function Se(t,e,n,r){var i,s,o,a,u,c,l,h,d,v,p=e[0],m=e[1],g=e[2],_=r[0],y=r[1],b=r[2],w=n[0],M=n[1],x=n[2];return Math.abs(p-w)<f&&Math.abs(m-M)<f&&Math.abs(g-x)<f?te(t):(l=p-w,h=m-M,d=g-x,i=y*(d*=v=1/Math.hypot(l,h,d))-b*(h*=v),s=b*(l*=v)-_*d,o=_*h-y*l,(v=Math.hypot(i,s,o))?(i*=v=1/v,s*=v,o*=v):(i=0,s=0,o=0),a=h*o-d*s,u=d*i-l*o,c=l*s-h*i,(v=Math.hypot(a,u,c))?(a*=v=1/v,u*=v,c*=v):(a=0,u=0,c=0),t[0]=i,t[1]=a,t[2]=l,t[3]=0,t[4]=s,t[5]=u,t[6]=h,t[7]=0,t[8]=o,t[9]=c,t[10]=d,t[11]=0,t[12]=-(i*p+s*m+o*g),t[13]=-(a*p+u*m+c*g),t[14]=-(l*p+h*m+d*g),t[15]=1,t)}function Ce(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=r[0],u=r[1],c=r[2],l=i-n[0],h=s-n[1],d=o-n[2],f=l*l+h*h+d*d;f>0&&(l*=f=1/Math.sqrt(f),h*=f,d*=f);var v=u*d-c*h,p=c*l-a*d,m=a*h-u*l;return(f=v*v+p*p+m*m)>0&&(v*=f=1/Math.sqrt(f),p*=f,m*=f),t[0]=v,t[1]=p,t[2]=m,t[3]=0,t[4]=h*m-d*p,t[5]=d*v-l*m,t[6]=l*p-h*v,t[7]=0,t[8]=l,t[9]=h,t[10]=d,t[11]=0,t[12]=i,t[13]=s,t[14]=o,t[15]=1,t}function Be(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function De(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Ie(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Fe(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Le(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Oe(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Ne(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Ue(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],c=t[7],l=t[8],h=t[9],d=t[10],v=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=e[0],b=e[1],w=e[2],M=e[3],x=e[4],T=e[5],R=e[6],k=e[7],E=e[8],P=e[9],A=e[10],S=e[11],C=e[12],B=e[13],D=e[14],I=e[15];return Math.abs(n-y)<=f*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-b)<=f*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-w)<=f*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(s-M)<=f*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(o-x)<=f*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-T)<=f*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(u-R)<=f*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(c-k)<=f*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(l-E)<=f*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(h-P)<=f*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(d-A)<=f*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(v-S)<=f*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(p-C)<=f*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(m-B)<=f*Math.max(1,Math.abs(m),Math.abs(B))&&Math.abs(g-D)<=f*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(_-I)<=f*Math.max(1,Math.abs(_),Math.abs(I))}var Ge=se,ze=Fe;function je(){var t=new v(3);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ve(t){var e=new v(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function qe(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Ke(t,e,n){var r=new v(3);return r[0]=t,r[1]=e,r[2]=n,r}function We(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function He(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Ze(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Xe(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ye(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function $e(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Qe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Je(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function tn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function en(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function nn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function rn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function sn(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function on(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function an(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function un(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function cn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function ln(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function hn(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function dn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function fn(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],u=n[2];return t[0]=i*u-s*a,t[1]=s*o-r*u,t[2]=r*a-i*o,t}function vn(t,e,n,r){var i=e[0],s=e[1],o=e[2];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=o+r*(n[2]-o),t}function pn(t,e,n,r,i,s){var o=s*s,a=o*(2*s-3)+1,u=o*(s-2)+s,c=o*(s-1),l=o*(3-2*s);return t[0]=e[0]*a+n[0]*u+r[0]*c+i[0]*l,t[1]=e[1]*a+n[1]*u+r[1]*c+i[1]*l,t[2]=e[2]*a+n[2]*u+r[2]*c+i[2]*l,t}function mn(t,e,n,r,i,s){var o=1-s,a=o*o,u=s*s,c=a*o,l=3*s*a,h=3*u*o,d=u*s;return t[0]=e[0]*c+n[0]*l+r[0]*h+i[0]*d,t[1]=e[1]*c+n[1]*l+r[1]*h+i[1]*d,t[2]=e[2]*c+n[2]*l+r[2]*h+i[2]*d,t}function gn(t,e){e=e||1;var n=2*p()*Math.PI,r=2*p()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function _n(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function yn(t,e,n){var r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function bn(t,e,n){var r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],u=e[1],c=e[2],l=i*c-s*u,h=s*a-r*c,d=r*u-i*a,f=i*d-s*h,v=s*l-r*d,p=r*h-i*l,m=2*o;return l*=m,h*=m,d*=m,f*=2,v*=2,p*=2,t[0]=a+l+f,t[1]=u+h+v,t[2]=c+d+p,t}function wn(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function Mn(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function xn(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function Tn(t,e){var n=Ke(t[0],t[1],t[2]),r=Ke(e[0],e[1],e[2]);hn(n,n),hn(r,r);var i=dn(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}function Rn(t){return t[0]=0,t[1]=0,t[2]=0,t}function kn(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function En(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Pn(t,e){var n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2];return Math.abs(n-s)<=f*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-o)<=f*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=f*Math.max(1,Math.abs(i),Math.abs(a))}var An,Sn=Xe,Cn=Ye,Bn=$e,Dn=on,In=an,Fn=qe,Ln=un,On=(An=je(),function(t,e,n,r,i,s){var o,a;for(e||(e=3),n||(n=0),a=r?Math.min(r*e+n,t.length):t.length,o=n;o<a;o+=e)An[0]=t[o],An[1]=t[o+1],An[2]=t[o+2],i(An,An,s),t[o]=An[0],t[o+1]=An[1],t[o+2]=An[2];return t});function Nn(){var t=new v(4);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Un(t){var e=new v(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Gn(t,e,n,r){var i=new v(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function zn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function jn(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function Vn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function qn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Kn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Wn(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Hn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Zn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Xn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function Yn(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function $n(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Qn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Jn(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function tr(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],s=e[3]-t[3];return Math.hypot(n,r,i,s)}function er(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],s=e[3]-t[3];return n*n+r*r+i*i+s*s}function nr(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function rr(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function ir(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function sr(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function or(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=s*o,t}function ar(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function ur(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],s=n[0]*r[2]-n[2]*r[0],o=n[0]*r[3]-n[3]*r[0],a=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],l=e[0],h=e[1],d=e[2],f=e[3];return t[0]=h*c-d*u+f*a,t[1]=-l*c+d*o-f*s,t[2]=l*u-h*o+f*i,t[3]=-l*a+h*s-d*i,t}function cr(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=e[3];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=o+r*(n[2]-o),t[3]=a+r*(n[3]-a),t}function lr(t,e){var n,r,i,s,o,a;e=e||1;do{o=(n=2*p()-1)*n+(r=2*p()-1)*r}while(o>=1);do{a=(i=2*p()-1)*i+(s=2*p()-1)*s}while(a>=1);var u=Math.sqrt((1-o)/a);return t[0]=e*n,t[1]=e*r,t[2]=e*i*u,t[3]=e*s*u,t}function hr(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}function dr(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],u=n[2],c=n[3],l=c*r+a*s-u*i,h=c*i+u*r-o*s,d=c*s+o*i-a*r,f=-o*r-a*i-u*s;return t[0]=l*c+f*-o+h*-u-d*-a,t[1]=h*c+f*-a+d*-o-l*-u,t[2]=d*c+f*-u+l*-a-h*-o,t[3]=e[3],t}function fr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function vr(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function pr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function mr(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],o=e[0],a=e[1],u=e[2],c=e[3];return Math.abs(n-o)<=f*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=f*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=f*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(s-c)<=f*Math.max(1,Math.abs(s),Math.abs(c))}var gr=qn,_r=Kn,yr=Wn,br=tr,wr=er,Mr=nr,xr=rr,Tr=function(){var t=Nn();return function(e,n,r,i,s,o){var a,u;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,a=r;a<u;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();function Rr(){var t=new v(4);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function kr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Er(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Pr(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>f?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Ar(t,e){var n=ii(t,e);return Math.acos(2*n*n-1)}function Sr(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=n[0],u=n[1],c=n[2],l=n[3];return t[0]=r*l+o*a+i*c-s*u,t[1]=i*l+o*u+s*a-r*c,t[2]=s*l+o*c+r*u-i*a,t[3]=o*l-r*a-i*u-s*c,t}function Cr(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*a,t[1]=i*u+s*a,t[2]=s*u-i*a,t[3]=o*u-r*a,t}function Br(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u-s*a,t[1]=i*u+o*a,t[2]=s*u+r*a,t[3]=o*u-i*a,t}function Dr(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*a,t[1]=i*u-r*a,t[2]=s*u+o*a,t[3]=o*u-s*a,t}function Ir(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function Fr(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=Math.sqrt(n*n+r*r+i*i),a=Math.exp(s),u=o>0?a*Math.sin(o)/o:0;return t[0]=n*u,t[1]=r*u,t[2]=i*u,t[3]=a*Math.cos(o),t}function Lr(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=Math.sqrt(n*n+r*r+i*i),a=o>0?Math.atan2(o,s)/o:0;return t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=.5*Math.log(n*n+r*r+i*i+s*s),t}function Or(t,e,n){return Lr(t,e),ri(t,t,n),Fr(t,t),t}function Nr(t,e,n,r){var i,s,o,a,u,c=e[0],l=e[1],h=e[2],d=e[3],v=n[0],p=n[1],m=n[2],g=n[3];return(s=c*v+l*p+h*m+d*g)<0&&(s=-s,v=-v,p=-p,m=-m,g=-g),1-s>f?(i=Math.acos(s),o=Math.sin(i),a=Math.sin((1-r)*i)/o,u=Math.sin(r*i)/o):(a=1-r,u=r),t[0]=a*c+u*v,t[1]=a*l+u*p,t[2]=a*h+u*m,t[3]=a*d+u*g,t}function Ur(t){var e=p(),n=p(),r=p(),i=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=s*Math.sin(2*Math.PI*r),t[3]=s*Math.cos(2*Math.PI*r),t}function Gr(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-r*a,t[2]=-i*a,t[3]=s*a,t}function zr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function jr(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*o+o]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*s+o]-e[3*o+s])*n,t[s]=(e[3*s+i]+e[3*i+s])*n,t[o]=(e[3*o+i]+e[3*i+o])*n}return t}function Vr(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var s=Math.sin(e),o=Math.cos(e),a=Math.sin(n),u=Math.cos(n),c=Math.sin(r),l=Math.cos(r);return t[0]=s*u*l-o*a*c,t[1]=o*a*l+s*u*c,t[2]=o*u*c-s*a*l,t[3]=o*u*l+s*a*c,t}function qr(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Kr,Wr,Hr,Zr,Xr,Yr,$r=Un,Qr=Gn,Jr=zn,ti=jn,ei=Vn,ni=Sr,ri=Qn,ii=ar,si=cr,oi=nr,ai=oi,ui=rr,ci=ui,li=or,hi=pr,di=mr,fi=(Kr=je(),Wr=Ke(1,0,0),Hr=Ke(0,1,0),function(t,e,n){var r=dn(e,n);return r<-.999999?(fn(Kr,Wr,e),Fn(Kr)<1e-6&&fn(Kr,Hr,e),hn(Kr,Kr),Er(t,Kr,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(fn(Kr,e,n),t[0]=Kr[0],t[1]=Kr[1],t[2]=Kr[2],t[3]=1+r,li(t,t))}),vi=(Zr=Rr(),Xr=Rr(),function(t,e,n,r,i,s){return Nr(Zr,e,i,s),Nr(Xr,n,r,s),Nr(t,Zr,Xr,2*s*(1-s)),t}),pi=(Yr=gt(),function(t,e,n,r){return Yr[0]=n[0],Yr[3]=n[1],Yr[6]=n[2],Yr[1]=r[0],Yr[4]=r[1],Yr[7]=r[2],Yr[2]=-e[0],Yr[5]=-e[1],Yr[8]=-e[2],li(t,jr(t,Yr))});function mi(){var t=new v(8);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function gi(t){var e=new v(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function _i(t,e,n,r,i,s,o,a){var u=new v(8);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=i,u[5]=s,u[6]=o,u[7]=a,u}function yi(t,e,n,r,i,s,o){var a=new v(8);a[0]=t,a[1]=e,a[2]=n,a[3]=r;var u=.5*i,c=.5*s,l=.5*o;return a[4]=u*r+c*n-l*e,a[5]=c*r+l*t-u*n,a[6]=l*r+u*e-c*t,a[7]=-u*t-c*e-l*n,a}function bi(t,e,n){var r=.5*n[0],i=.5*n[1],s=.5*n[2],o=e[0],a=e[1],u=e[2],c=e[3];return t[0]=o,t[1]=a,t[2]=u,t[3]=c,t[4]=r*c+i*u-s*a,t[5]=i*c+s*o-r*u,t[6]=s*c+r*a-i*o,t[7]=-r*o-i*a-s*u,t}function wi(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function Mi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function xi(t,e){var n=Rr();Me(n,e);var r=new v(3);return be(r,e),bi(t,n,r),t}function Ti(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Ri(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function ki(t,e,n,r,i,s,o,a,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t}var Ei=Jr;function Pi(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var Ai=Jr;function Si(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function Ci(t,e){var n=e[4],r=e[5],i=e[6],s=e[7],o=-e[0],a=-e[1],u=-e[2],c=e[3];return t[0]=2*(n*c+s*o+r*u-i*a),t[1]=2*(r*c+s*a+i*o-n*u),t[2]=2*(i*c+s*u+n*a-r*o),t}function Bi(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=.5*n[0],u=.5*n[1],c=.5*n[2],l=e[4],h=e[5],d=e[6],f=e[7];return t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=o*a+i*c-s*u+l,t[5]=o*u+s*a-r*c+h,t[6]=o*c+r*u-i*a+d,t[7]=-r*a-i*u-s*c+f,t}function Di(t,e,n){var r=-e[0],i=-e[1],s=-e[2],o=e[3],a=e[4],u=e[5],c=e[6],l=e[7],h=a*o+l*r+u*s-c*i,d=u*o+l*i+c*r-a*s,f=c*o+l*s+a*i-u*r,v=l*o-a*r-u*i-c*s;return Cr(t,e,n),r=t[0],i=t[1],s=t[2],o=t[3],t[4]=h*o+v*r+d*s-f*i,t[5]=d*o+v*i+f*r-h*s,t[6]=f*o+v*s+h*i-d*r,t[7]=v*o-h*r-d*i-f*s,t}function Ii(t,e,n){var r=-e[0],i=-e[1],s=-e[2],o=e[3],a=e[4],u=e[5],c=e[6],l=e[7],h=a*o+l*r+u*s-c*i,d=u*o+l*i+c*r-a*s,f=c*o+l*s+a*i-u*r,v=l*o-a*r-u*i-c*s;return Br(t,e,n),r=t[0],i=t[1],s=t[2],o=t[3],t[4]=h*o+v*r+d*s-f*i,t[5]=d*o+v*i+f*r-h*s,t[6]=f*o+v*s+h*i-d*r,t[7]=v*o-h*r-d*i-f*s,t}function Fi(t,e,n){var r=-e[0],i=-e[1],s=-e[2],o=e[3],a=e[4],u=e[5],c=e[6],l=e[7],h=a*o+l*r+u*s-c*i,d=u*o+l*i+c*r-a*s,f=c*o+l*s+a*i-u*r,v=l*o-a*r-u*i-c*s;return Dr(t,e,n),r=t[0],i=t[1],s=t[2],o=t[3],t[4]=h*o+v*r+d*s-f*i,t[5]=d*o+v*i+f*r-h*s,t[6]=f*o+v*s+h*i-d*r,t[7]=v*o-h*r-d*i-f*s,t}function Li(t,e,n){var r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],u=e[1],c=e[2],l=e[3];return t[0]=a*o+l*r+u*s-c*i,t[1]=u*o+l*i+c*r-a*s,t[2]=c*o+l*s+a*i-u*r,t[3]=l*o-a*r-u*i-c*s,a=e[4],u=e[5],c=e[6],l=e[7],t[4]=a*o+l*r+u*s-c*i,t[5]=u*o+l*i+c*r-a*s,t[6]=c*o+l*s+a*i-u*r,t[7]=l*o-a*r-u*i-c*s,t}function Oi(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=n[0],u=n[1],c=n[2],l=n[3];return t[0]=r*l+o*a+i*c-s*u,t[1]=i*l+o*u+s*a-r*c,t[2]=s*l+o*c+r*u-i*a,t[3]=o*l-r*a-i*u-s*c,a=n[4],u=n[5],c=n[6],l=n[7],t[4]=r*l+o*a+i*c-s*u,t[5]=i*l+o*u+s*a-r*c,t[6]=s*l+o*c+r*u-i*a,t[7]=o*l-r*a-i*u-s*c,t}function Ni(t,e,n,r){if(Math.abs(r)<f)return Ti(t,e);var i=Math.hypot(n[0],n[1],n[2]);r*=.5;var s=Math.sin(r),o=s*n[0]/i,a=s*n[1]/i,u=s*n[2]/i,c=Math.cos(r),l=e[0],h=e[1],d=e[2],v=e[3];t[0]=l*c+v*o+h*u-d*a,t[1]=h*c+v*a+d*o-l*u,t[2]=d*c+v*u+l*a-h*o,t[3]=v*c-l*o-h*a-d*u;var p=e[4],m=e[5],g=e[6],_=e[7];return t[4]=p*c+_*o+m*u-g*a,t[5]=m*c+_*a+g*o-p*u,t[6]=g*c+_*u+p*a-m*o,t[7]=_*c-p*o-m*a-g*u,t}function Ui(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t}function Gi(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=n[4],u=n[5],c=n[6],l=n[7],h=e[4],d=e[5],f=e[6],v=e[7],p=n[0],m=n[1],g=n[2],_=n[3];return t[0]=r*_+o*p+i*g-s*m,t[1]=i*_+o*m+s*p-r*g,t[2]=s*_+o*g+r*m-i*p,t[3]=o*_-r*p-i*m-s*g,t[4]=r*l+o*a+i*c-s*u+h*_+v*p+d*g-f*m,t[5]=i*l+o*u+s*a-r*c+d*_+v*m+f*p-h*g,t[6]=s*l+o*c+r*u-i*a+f*_+v*g+h*m-d*p,t[7]=o*l-r*a-i*u-s*c+v*_-h*p-d*m-f*g,t}var zi=Gi;function ji(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t}var Vi=ii;function qi(t,e,n,r){var i=1-r;return Vi(e,n)<0&&(r=-r),t[0]=e[0]*i+n[0]*r,t[1]=e[1]*i+n[1]*r,t[2]=e[2]*i+n[2]*r,t[3]=e[3]*i+n[3]*r,t[4]=e[4]*i+n[4]*r,t[5]=e[5]*i+n[5]*r,t[6]=e[6]*i+n[6]*r,t[7]=e[7]*i+n[7]*r,t}function Ki(t,e){var n=Xi(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t}function Wi(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Hi=oi,Zi=Hi,Xi=ui,Yi=Xi;function $i(t,e){var n=Xi(e);if(n>0){n=Math.sqrt(n);var r=e[0]/n,i=e[1]/n,s=e[2]/n,o=e[3]/n,a=e[4],u=e[5],c=e[6],l=e[7],h=r*a+i*u+s*c+o*l;t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=(a-r*h)/n,t[5]=(u-i*h)/n,t[6]=(c-s*h)/n,t[7]=(l-o*h)/n}return t}function Qi(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Ji(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function ts(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],c=t[7],l=e[0],h=e[1],d=e[2],v=e[3],p=e[4],m=e[5],g=e[6],_=e[7];return Math.abs(n-l)<=f*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-h)<=f*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-d)<=f*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(s-v)<=f*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(o-p)<=f*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-m)<=f*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(u-g)<=f*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(c-_)<=f*Math.max(1,Math.abs(c),Math.abs(_))}function es(){var t=new v(2);return v!=Float32Array&&(t[0]=0,t[1]=0),t}function ns(t){var e=new v(2);return e[0]=t[0],e[1]=t[1],e}function rs(t,e){var n=new v(2);return n[0]=t,n[1]=e,n}function is(t,e){return t[0]=e[0],t[1]=e[1],t}function ss(t,e,n){return t[0]=e,t[1]=n,t}function os(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function as(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function us(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function cs(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function ls(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function hs(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function ds(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function fs(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function vs(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function ps(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function ms(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function gs(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function _s(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function ys(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function bs(t){var e=t[0],n=t[1];return e*e+n*n}function ws(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Ms(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function xs(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function Ts(t,e){return t[0]*e[0]+t[1]*e[1]}function Rs(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function ks(t,e,n,r){var i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function Es(t,e){e=e||1;var n=2*p()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function Ps(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function As(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function Ss(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function Cs(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}function Bs(t,e,n,r){var i=e[0]-n[0],s=e[1]-n[1],o=Math.sin(r),a=Math.cos(r);return t[0]=i*a-s*o+n[0],t[1]=i*o+s*a+n[1],t}function Ds(t,e){var n=t[0],r=t[1],i=e[0],s=e[1],o=n*n+r*r;o>0&&(o=1/Math.sqrt(o));var a=i*i+s*s;a>0&&(a=1/Math.sqrt(a));var u=(n*i+r*s)*o*a;return u>1?0:u<-1?Math.PI:Math.acos(u)}function Is(t){return t[0]=0,t[1]=0,t}function Fs(t){return"vec2("+t[0]+", "+t[1]+")"}function Ls(t,e){return t[0]===e[0]&&t[1]===e[1]}function Os(t,e){var n=t[0],r=t[1],i=e[0],s=e[1];return Math.abs(n-i)<=f*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=f*Math.max(1,Math.abs(r),Math.abs(s))}var Ns=ys,Us=as,Gs=us,zs=cs,js=gs,Vs=_s,qs=bs,Ks=function(){var t=es();return function(e,n,r,i,s,o){var a,u;for(n||(n=2),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,a=r;a<u;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(1),i=n(7),s=n(3);function o(t,e){return"number"==typeof t?[e,t,!0]:"number"==typeof e?[t,e,!1]:e.length>t.length?[e,t,!0]:[t,e,!1]}Number.prototype.__to=function(t){switch(t){case i.Vector4:return i.vec4(this.valueOf(),this.valueOf(),this.valueOf(),this.valueOf());case r.Vector3:return r.vec3(this.valueOf(),this.valueOf(),this.valueOf());case s.Vector2:return s.vec2(this.valueOf(),this.valueOf())}return this.valueOf()},e.plus=function(t,e){const[n,r]=o(t,e);return r.__to(n.constructor).plus(n)},e.minus=function(t,e){const[n,r,i]=o(t,e);return i?r.__to(n.constructor).minus(n):r.__to(n.constructor).minus(n).negate()},e.mul=function(t,e){const[n,r]=o(t,e);return r.__to(n.constructor).mul(n)},e.div=function(t,e){const[n,r,i]=o(t,e);return i?r.__to(n.constructor).div(n):r.__to(n.constructor).div(n).inversed},e.dot=function(t,e){return t.dot(e)},e.cross=function(t,e){return t.cross(e)},e.Deg2Rad=Math.PI/180,e.Rad2Deg=180/Math.PI},function(t,e,n){"use strict";function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),r(n(30)),r(n(38)),r(n(21)),r(n(74)),r(n(32)),r(n(23)),r(n(10)),r(n(41)),r(n(19))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.EventEmitter=class{constructor(){this.listeners=new Map}on(t,e){var n;this.listeners.has(t)||this.listeners.set(t,[]),null===(n=this.listeners.get(t))||void 0===n||n.push(e)}off(t,e){var n,r;this.listeners.has(t)&&this.listeners.set(t,null!=(r=null===(n=this.listeners.get(t))||void 0===n?void 0:n.filter(t=>t!==e))?r:[])}emit(t,...e){var n;null===(n=this.listeners.get(t))||void 0===n||n.forEach(t=>t(...e))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(44),i=n(10),s=n(19);class o extends r.Transform{constructor(){super(...arguments),this.assetID=i.AssetManager.newAssetID(this),this.name="Entity_"+this.assetID,this._scene=null,this.eventEmitter=new s.EventEmitter,this.destroyed=!1}get scene(){return this._scene}on(t,e){return this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}__addToScene(t){this._scene=t}__updateRecursive(t){this.eventEmitter.emit("update",this,t);for(const e of this.children)e.__updateRecursive(t)}destroy(){this.destroyed=!0,i.AssetManager.destroy(this.assetID)}}e.Entity=o;e.EntityManager=class{constructor(){this.entityMap=new Map,this._entities=[]}get entities(){return this._entities}add(t){this.entityMap.set(t.assetID,t),this._entities=Array.from(this.entityMap.values())}removeRecursive(t){this.entityMap.delete(t.assetID);for(const e of t.children)this.removeRecursive(e)}remove(t){this.removeRecursive(t),t.parent&&t.parent.children.delete(t),this._entities=Array.from(this.entityMap.values())}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(1),i=n(3),s=n(6),o=n(2),a=n(5),u=n(17),c=n(10);class l extends c.Asset{constructor(t=o.GL()){var e,n;super(),this._verts=[],this._triangles=[],this._uvs=[],this._uv2=[],this._colors=[],this._normals=[],this.dirty=!0,this.uploaded=!1,this.vertices=new Float32Array(0),this.indices=new Uint32Array(0),this.name="Mesh_"+this.assetID,this.gl=t,this.VBO=null!=(e=t.createBuffer())?e:a.panic("Failed to create vertex buffer."),this.EBO=null!=(n=t.createBuffer())?n:a.panic("Failed to create element buffer.")}get verts(){return this._verts}set verts(t){this._verts=t,this.dirty=!0}get triangles(){return this._triangles}set triangles(t){this._triangles=t,this.dirty=!0}get uvs(){return this._uvs}set uvs(t){this._uvs=t,this.dirty=!0}get uv2(){return this._uv2}set uv2(t){this._uv2=t,this.dirty=!0}get colors(){return this._colors}set colors(t){this._colors=t,this.dirty=!0}get normals(){return this._normals}set normals(t){this._normals=t,this.dirty=!0}clear(){this.verts=[],this.uvs=[],this.triangles=[],this.colors=[],this.normals=[]}calculateNormals(t=0){if(this.triangles.length%3!=0)throw new Error("Invalid triangles.");this.normals=a.fillArray(()=>r.vec3(0,0,0),this.verts.length);for(let t=0;t<this.triangles.length;t+=3){const e=this.verts[this.triangles[t]],n=this.verts[this.triangles[t+1]],r=this.verts[this.triangles[t+2]],i=u.minus(n,e),s=u.minus(r,e),o=u.cross(i,s).normalize();this.normals[this.triangles[t+0]].plus(o),this.normals[this.triangles[t+1]].plus(o),this.normals[this.triangles[t+2]].plus(o)}for(let t=0;t<this.normals.length;t++)this.normals[t]=this.normals[t].normalize()}update(){if(this.dirty){if(this.triangles.length%3!=0)throw new Error("Invalid triangles.");if(this.colors.length!==this.verts.length&&(this.colors=[...this.colors,...a.fillArray(s.Color.white,this.verts.length-this.colors.length)]),this.uvs.length!==this.verts.length&&(this.uvs=[...this.uvs,...a.fillArray(i.vec2(0,0),this.verts.length-this.uvs.length)]),this.uv2.length!==this.verts.length&&(this.uv2=[...this.uv2,...a.fillArray(i.vec2(0,0),this.verts.length-this.uv2.length)]),this.normals.length!==this.verts.length&&(this.normals=[...this.normals,...a.fillArray(r.vec3(0,0,0),this.verts.length-this.normals.length)]),this.vertices=new Float32Array(this.verts.flatMap((t,e)=>[...t,...this.colors[e],...this.uvs[e],...this.uv2[e],...this.normals[e]])),this.vertices.length!=14*this.verts.length)throw new Error("Buffer with invalid length.");this.indices=new Uint32Array(this.triangles.flat()),this.dirty=!1,this.uploaded=!1}}setup(t){return this.update(),this.uploaded||(t.bindBuffer(t.ARRAY_BUFFER,this.VBO),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.EBO),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),this.uploaded=!0),[this.VBO,this.EBO]}bind(t,e){this.setup(e);const n=t.attributes;e.bindBuffer(e.ARRAY_BUFFER,this.VBO),n.vert>=0&&(e.vertexAttribPointer(n.vert,3,e.FLOAT,!1,56,0),e.enableVertexAttribArray(n.vert)),n.color>=0&&(e.vertexAttribPointer(n.color,4,e.FLOAT,!1,56,12),e.enableVertexAttribArray(n.color)),n.uv>=0&&(e.vertexAttribPointer(n.uv,2,e.FLOAT,!1,56,28),e.enableVertexAttribArray(n.uv)),n.uv2>=0&&(e.vertexAttribPointer(n.uv2,2,e.FLOAT,!1,56,36),e.enableVertexAttribArray(n.uv2)),n.uv&&n.normal>=0&&(e.vertexAttribPointer(n.normal,3,e.FLOAT,!0,56,44),e.enableVertexAttribArray(n.normal)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.EBO)}destroy(){this.destroyed||(this.gl.deleteBuffer(this.VBO),this.gl.deleteBuffer(this.EBO),super.destroy())}}e.Mesh=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(2),i=n(5),s={canvasOutput:{tex:null,attachPoint:WebGL2RenderingContext.BACK},fromRenderTexture:t=>({tex:t.glTex})};class o{constructor(t=0,e=0,n=r.GlobalContext()){var o;this.colorAttachments=[],this.depthAttachment=s.canvasOutput,this.isCanvasTarget=!0,this.width=t,this.height=e,this.frameBuffer=n?null!=(o=n.gl.createFramebuffer())?o:i.panic("Failed to create frame buffer"):null}addColorAttachment(t){if(null!==t){if(this.isCanvasTarget=!1,0==this.width&&0==this.height&&(this.width=t.width,this.height=t.height),this.width!=t.width||this.height!=t.height)throw new Error("Framebuffer attachments must in same resolution.");this.colorAttachments.push(s.fromRenderTexture(t))}}setDepthAttachment(t){var e,n;if(0==this.width&&0==this.height&&(this.width=t.width,this.height=t.height),this.width!=t.width||this.height!=t.height)throw new Error("Framebuffer attachments must in same resolution.");this.depthAttachment={tex:(n=null===(e=t)||void 0===e?void 0:e.glTex,null!=n?n:null),attachPoint:WebGL2RenderingContext.DEPTH_ATTACHMENT}}bind(t=r.GlobalContext()){const e=t.gl;if(this.isCanvasTarget)e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,t.width,t.height);else{e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer);let t=0;for(let n=0;n<this.colorAttachments.length;n++)this.colorAttachments[n].tex&&(this.colorAttachments[n].attachPoint=e.COLOR_ATTACHMENT0+t++,e.framebufferTexture2D(e.FRAMEBUFFER,this.colorAttachments[n].attachPoint,e.TEXTURE_2D,this.colorAttachments[n].tex,0));e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,this.depthAttachment.tex,0),e.viewport(0,0,this.width,this.height);const n=this.colorAttachments.map(t=>t.attachPoint);e.drawBuffers(n)}}release(t=r.GlobalContext()){if(this.isCanvasTarget)return;t.gl.deleteFramebuffer(this.frameBuffer)}}e.RenderTarget=o,o.CanvasTarget=Object.freeze(new o)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(2),i=n(11),s=n(5),o=n(10);var a,u;!function(t){t[t.Linear=WebGL2RenderingContext.LINEAR]="Linear",t[t.Nearest=WebGL2RenderingContext.NEAREST]="Nearest"}(a=e.FilterMode||(e.FilterMode={})),function(t){t[t.Repeat=WebGL2RenderingContext.REPEAT]="Repeat",t[t.Clamp=WebGL2RenderingContext.CLAMP_TO_EDGE]="Clamp",t[t.Mirror=WebGL2RenderingContext.MIRRORED_REPEAT]="Mirror"}(u=e.WrapMode||(e.WrapMode={}));class c extends o.Asset{}e.Texture=c;class l extends o.Asset{constructor(t,e,n=i.TextureFormat.RGBA,o=a.Linear,c=r.GlobalContext()){var l;super(),this.mipmapLevel=0,this.wrapMode=u.Repeat,this.name="Texture_"+this.assetID;const h=c.gl;this.ctx=c,this.format=n,this.width=t,this.height=e,this.filterMode=o,this.glTex=null!=(l=h.createTexture())?l:s.panic("Failed to create texture.")}setup(){const t=this.ctx.gl;t.bindTexture(t.TEXTURE_2D,this.glTex),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.filterMode),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.filterMode),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.wrapMode),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.wrapMode)}bind(t,e){const n=e.gl;n.activeTexture(n.TEXTURE0+e.nextTextureUnit),n.bindTexture(n.TEXTURE_2D,this.glTex),n.uniform1i(t,e.nextTextureUnit),e.nextTextureUnit++}destroy(){if(this.destroyed)return;this.ctx.gl.deleteTexture(this.glTex),super.destroy()}}e.Texture2D=class extends l{constructor(t=0,e=0,n=i.TextureFormat.RGBA,s=a.Linear,o=r.GlobalContext()){super(t,e,n,s,o)}setData(t){super.setup();const e=this.ctx.gl,[n,r,s]=i.mapGLFormat(e,this.format);void 0!==t.width&&void 0!==t.height?(t=t,this.width=t.width,this.height=t.height,e.texImage2D(e.TEXTURE_2D,this.mipmapLevel,n,this.width,this.height,0,r,s,null)):e.texImage2D(e.TEXTURE_2D,this.mipmapLevel,n,this.width,this.height,0,r,s,null),d(this.ctx,this.glTex,t,this.width,this.height,this.format,this.filterMode,this.wrapMode,this.mipmapLevel)}};class h extends l{constructor(t,e,n=r.GlobalContext()){super(t,e,i.TextureFormat.DEPTH_COMPONENT,a.Nearest,n)}create(){super.setup();const t=this.ctx.gl;t.bindTexture(t.TEXTURE_2D,this.glTex);const[e,n,r]=i.mapGLFormat(t,i.TextureFormat.DEPTH_COMPONENT);t.texImage2D(t.TEXTURE_2D,this.mipmapLevel,e,this.width,this.height,0,n,r,null)}}e.DepthTexture=h;function d(t,e,n,r,o,a,u,c,l){var h,d;const f=t.gl,v=null!=(h=f.createTexture())?h:s.panic("Failed to create texture."),[p,m,g]=i.mapGLFormat(f,a);f.bindTexture(f.TEXTURE_2D,v),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,c),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,c),void 0!==n.width&&void 0!==n.height?(n=n,f.texImage2D(f.TEXTURE_2D,l,p,m,g,n)):(n=n,f.texImage2D(f.TEXTURE_2D,l,p,r,o,0,m,g,n));const _=null!=(d=f.createFramebuffer())?d:s.panic("Failed to create frame buffer");f.bindFramebuffer(f.FRAMEBUFFER,_),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,e,0),f.viewport(0,0,r,o),f.drawBuffers([f.COLOR_ATTACHMENT0]);const y=t.assets.shaders.FlipTexture;f.useProgram(y.program),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,v),f.uniform1i(y.builtinUniformLocations.mainTex,0),f.enable(f.BLEND),f.blendFuncSeparate(f.ONE,f.ZERO,f.ONE,f.ZERO);const b=t.assets.meshes.screenQuad;b.bind(y,f),f.drawElements(f.TRIANGLE_STRIP,b.triangles.length,f.UNSIGNED_INT,0),f.deleteFramebuffer(_),f.bindFramebuffer(f.FRAMEBUFFER,null),f.deleteTexture(v)}e.RenderTexture=class extends l{constructor(t,e,n,s=i.TextureFormat.RGBA,o=a.Linear,u=r.GlobalContext()){super(t,e,s,o,u),this.depthTexture=null,n&&(this.depthTexture=new h(t,e,u)),this.update()}update(){super.setup();const t=this.ctx.gl,[e,n,r]=i.mapGLFormat(t,this.format);t.texImage2D(t.TEXTURE_2D,this.mipmapLevel,e,this.width,this.height,0,n,r,null)}setData(t){const e=this.ctx.gl;e.bindTexture(e.TEXTURE_2D,this.glTex);const[n,r,s]=i.mapGLFormat(e,this.format);e.texImage2D(e.TEXTURE_2D,this.mipmapLevel,n,this.width,this.height,0,r,s,null),d(this.ctx,this.glTex,t,this.width,this.height,this.format,this.filterMode,this.wrapMode,this.mipmapLevel)}destroy(){var t;this.destroyed||(null===(t=this.depthTexture)||void 0===t||t.destroy(),super.destroy())}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(16);e.mulPoint=function(t,e,n){let[i,s,o]=n;const a=r.vec4.fromValues(i,s,o,1);return[i,s,o]=r.vec4.transformMat4(r.vec4.create(),a,e),r.vec3.set(t,i,s,o),t},e.mulVector=function(t,e,n){let[i,s,o]=n;const a=r.vec4.fromValues(i,s,o,0);return[i,s,o]=r.vec4.transformMat4(r.vec4.create(),a,e),r.vec3.set(t,i,s,o),t},e.readBlob=async function(t){return new Promise((e,n)=>{const r=new FileReader;r.addEventListener("loadend",()=>{e(r.result)}),r.addEventListener("error",t=>{n(r.error)}),r.readAsArrayBuffer(t)})},e.readString=function(t,e,n){const r=t.slice(e,e+n);return(new TextDecoder).decode(r)},e.assert=function(t,e){if(!t)throw new Error(e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Light2D=void 0;const r=n(0),i=n(58),s=n(60);class o extends r.Entity{constructor(){super(...arguments),this.enable=!0,this.mesh=s.makeQuad(),this.material=new i.ProceduralLightMaterial,this._size=4}get size(){return this._size}set size(t){this._size=t,this.localScaling=r.vec3(t,t,t)}get direction(){return this.material.lightDirection}set direction(t){this.material.lightDirection=t}get halfAngle(){return this.material.lightAngle}set halfAngle(t){this.material.lightAngle=t}}e.Light2D=o},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.loadImage=void 0,e.loadImage=function(t){return r(this,void 0,void 0,(function*(){return new Promise((e,n)=>{const r=new Image;r.src=t,r.complete&&e(r),r.onload=()=>{e(r)},r.onerror=(t,e,r,i,s)=>{n(s)}})}))}},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ChunkData=e.ChunksManager=e.ItemName=e.ItemType=void 0;const i=n(0),s=r(n(109)),o=n(12),a=r(n(118)),u=n(119),c=n(15),l=n(63),h=a.default.Noise;var d;!function(t){t.None="none",t.Glass="glass",t.PCB="pcb",t.Wire="wire",t.Iron="iron",t.Paint="paint",t.Battery="battery",t.Petrol="petrol",t.Wood="wood",t.Flashlight="flashlight",t.Campfire="campfire",t.Pickaxe="pickaxe",t.Radio="radio"}(d=e.ItemType||(e.ItemType={})),e.ItemName={[d.None]:"[]",[d.Glass]:"",[d.PCB]:"",[d.Wire]:"",[d.Iron]:"",[d.Paint]:"",[d.Battery]:"",[d.Petrol]:"",[d.Wood]:"",[d.Flashlight]:"",[d.Campfire]:"",[d.Pickaxe]:"",[d.Radio]:""};const f={[d.Paint]:1,[d.Wood]:20.6,[d.Battery]:10,[d.Glass]:10,[d.Iron]:10,[d.Petrol]:10,[d.Wire]:10,[d.PCB]:10},v=(i.vec2(3,3),i.vec2(6,3),i.vec2(6,4),i.vec2(5,4),i.vec2(4,4),i.vec2(3,6),i.vec2(2,6),i.vec2(2,5),i.vec2(2,4),i.vec2(1,4),i.vec2(0,3),i.vec2(0,2),i.vec2(1,2),i.vec2(2,2),i.vec2(2,1),i.vec2(3,0),i.vec2(4,0),i.vec2(4,1),i.vec2(4,2),i.vec2(5,2),Object.keys(f).map(t=>({item:t,weight:f[t]})).sort((t,e)=>t.weight-e.weight));{let t=0;for(const e of v)e.weight+=t,t=e.weight}i.vec2(1,3),i.vec2(0,2);e.ChunksManager=class{constructor(t,e){this.chunks=new Map,this.previousLoadedChunk=new Map,this.loadedChunk=new Map,this.tilemap=t,this.seed=e,this.prng=s.default(e),this.noiseMap=new h(this.prng.double())}update(){this.previousLoadedChunk=this.loadedChunk,this.loadedChunk=new Map;const t=c.Global().camera,e=c.Global().tilemap,[n,r]=e.visibleChunkRange(t);for(let t=n.y;t<r.y;t++)for(let e=n.x;e<r.x;e++)this.loadChunk(i.vec2(e,t))}getChunkAt(t){const[e,n]=l.calcChunkPos(t,16);return this.loadChunk(e)}loadChunk(t){t=o.floor2(t);let e=l.calcChunkID(t),n=this.chunks.get(e);return this.previousLoadedChunk.has(e)||(n?console.log(`load existed chunk ${t} ${e}`):console.log(`load new chunk ${t} ${e}`)),n||(n=new p(this.seed,t),this.chunks.set(e,n),n.generateMap(this.noiseMap),n.generateItems()),this.loadedChunk.set(e,n),n}};class p{constructor(t,e){this.chests=[],this.chunkPos=e,this.prng=s.default(`${t}@[${e.x},${e.y}]`)}generateMap(t){const e=c.Global().tilemap;for(let n=0;n<16;n++)for(let r=0;r<16;r++){let s=i.vec2(r,n),o=i.plus(i.mul(this.chunkPos,16),s);this.noiseAt(t,o)<0?e.setTile(o,{collide:!1,texture_offset:i.vec2(0,0)}):this.noiseAt(t,i.plus(o,i.vec2.down()))>=0?e.setTile(o,{collide:!0,texture_offset:i.vec2(3,3)}):e.setTile(o,{collide:!0,texture_offset:i.vec2(3,0)})}}noiseAt(t,e){return t.simplex2(e.x/10,e.y/10)/2+t.perlin2(e.x/5,e.y/5)/4-.1}generateItems(){var t;const e=1+3*this.prng.quick(),n=c.Global().tilemap;this.chests=[];for(let r=0;r<e;r++){const e=o.floor2(i.vec2(16*this.prng.quick(),16*this.prng.quick()));if(null===(t=n.getTile(i.mul(this.chunkPos,16).plus(e)))||void 0===t?void 0:t.collide)continue;let r=0;const s=[];for(let t=0;t<5;t++){for(const t of Object.keys(f))this.prng.quick()<f[t]-r&&s.push(t);r++}const a=new u.Chest(s,this);a.position=i.mul(this.chunkPos,16).plus(e).plus(i.vec2(.5)).toVec3(2),this.chests.push(a),c.Global().scene.add(a)}}removeChest(t){this.chests=this.chests.filter(e=>e!==t)}tileAt(t,e){c.Global().assets.tiles[`[${t.x},${t.y}]`];return{collide:e,texture_offset:t}}}e.ChunkData=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteObject=void 0;const r=n(0),i=n(61),s=n(60);class o extends r.RenderObject{constructor(){super(),this.mesh=s.makeQuad(),this.material=new i.Material2D,this._sprite=null,this.meshes[0]=this.mesh,this.materials[0]=this.material}get sprite(){return this._sprite}set sprite(t){this._sprite=t,t?(this.material.texture=t.texture,this.mesh.uvs=[r.vec2(t.uvRect.xMin,t.uvRect.yMin),r.vec2(t.uvRect.xMax,t.uvRect.yMin),r.vec2(t.uvRect.xMax,t.uvRect.yMax),r.vec2(t.uvRect.xMin,t.uvRect.yMax)],this.mesh.update()):this.material.texture=null}}e.SpriteObject=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(16),i=n(1),s=n(17);function o(){return r.quat.create()}e.Quaternion=o,o.identity=()=>{const t=r.quat.create();return r.quat.identity(t),t},o.axis=(t,e)=>r.quat.setAxisAngle(r.quat.create(),t,e),o.mul=(t,e)=>{const n=r.quat.create();return r.quat.mul(n,t,e)},o.invert=t=>{const e=r.quat.create();return r.quat.invert(e,t)},o.normalize=t=>r.quat.normalize(r.quat.create(),t),o.euler=t=>i.vec3(Math.atan2(2*(t[3]*t[0]+t[1]*t[2]),1-2*(t[0]**2+t[1]**2))*s.Rad2Deg,Math.asin(2*(t[3]*t[1]-t[2]*t[0]))*s.Rad2Deg,Math.atan2(2*(t[3]*t[2]+t[0]*t[1]),1-2*(t[1],t[2]**2))*s.Rad2Deg),o.fromEuler=t=>r.quat.fromEuler(r.quat.create(),t[0],t[1],t[2]),o.rotate=(t,e)=>r.vec3.transformQuat(i.vec3(0,0,0),e,t),e.quat=o,e.quat.identity=o.identity},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(31);const r=n(2);n(31);const i=n(10);class s extends i.Asset{constructor(t,e=r.GL()){super(),this.propertyBlock={},this.name="Material_"+this.assetID,this.gl=e,this._shader=t}get shader(){return this._shader}set shader(t){const e=this.gl;if(t!=this._shader){this._shader=t;for(const t in this.propertyBlock){const n=e.getUniformLocation(this._shader.program,this.propertyBlock[t].name);this.propertyBlock[t].location=n}}}setup(t){var e;const n=t.gl;for(const r in this.propertyBlock){const i=this.propertyBlock[r];switch(i.type){case"float":n.uniform1f(i.location,this[r]);break;case"vec2":n.uniform2fv(i.location,this[r]);break;case"vec3":n.uniform3fv(i.location,this[r]);break;case"vec4":case"color":n.uniform4fv(i.location,this[r]);break;case"mat4":n.uniformMatrix4fv(i.location,!1,this[r]);break;case"tex2d":this[r]?null===(e=this[r]||null)||void 0===e||e.bind(i.location,t):t.assets.textures.default.bind(i.location,t)}}}setProp(t,e,n,r){let i=t,s=e,o=n,a=r;if("string"!=typeof n&&(i=s=t,o=e,a=n),this.propertyBlock[i])this.propertyBlock[i].type=o;else{const t=this.gl.getUniformLocation(this.shader.program,s);t&&(this.propertyBlock[i]={location:t,type:o,name:s})}this[i]=a}}e.Material=s;const o=Symbol("shaderProp");e.shaderProp=function(t,e){return Reflect.metadata(o,{name:t,type:e})},e.MaterialFromShader=function(t){return class extends s{constructor(e=r.GL()){super(t,e)}}},e.materialDefine=function(t){return class extends t{constructor(...t){var e;super(...t);const n=this.gl,r=this.shader,i=this.propertyBlock;for(const t in this){const u=(s=this,a=t,Reflect.getMetadata(o,s,a));if(!u)continue;const c=n.getUniformLocation(r.program,null===(e=u)||void 0===e?void 0:e.name);c&&(i[t]={type:u.type,location:c,name:u.name})}var s,a;this.propertyBlock=i}}}},function(t,e,n){(function(t,e){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n;!function(n){!function(r){var i="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),s=o(n);function o(t,e){return function(n,r){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0===i.Reflect?i.Reflect=n:s=o(i.Reflect,s),function(e){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,i=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,u=!o&&!a,c={create:o?function(){return D(Object.create(null))}:a?function(){return D({__proto__:null})}:function(){return D({})},has:u?function(t,e){return n.call(t,e)}:function(t,e){return e in t},get:u?function(t,e){return n.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),h="object"==typeof t&&t.env&&"true"===t.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[s]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,i)},e.prototype.entries=function(){return new n(this._keys,this._values,o)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[s]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function i(t,e){return e}function o(t,e){return[t,e]}}():Map,f=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new d}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[s]=function(){return this.keys()},t}():Set,v=new(h||"function"!=typeof WeakMap?function(){var t=c.create(),e=r();return function(){function t(){this._key=r()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&c.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?c.get(e,this._key):void 0},t.prototype.set=function(t,e){return i(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=r()},t}();function r(){var e;do{e="@@WeakMap@@"+o()}while(c.has(t,e));return t[e]=!0,e}function i(t,r){if(!n.call(t,e)){if(!r)return;Object.defineProperty(t,e,{value:c.create()})}return t[e]}function s(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function o(){var t,e=(t=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):s(new Uint8Array(t),t):s(new Array(t),t));e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",r=0;r<16;++r){var i=e[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function p(t,e,n){var r=v.get(t);if(w(r)){if(!n)return;r=new d,v.set(t,r)}var i=r.get(e);if(w(i)){if(!n)return;i=new d,r.set(e,i)}return i}function m(t,e,n){var r=p(e,n,!1);return!w(r)&&!!r.has(t)}function g(t,e,n){var r=p(e,n,!1);if(!w(r))return r.get(t)}function _(t,e,n,r){p(n,r,!0).set(t,e)}function y(t,e){var n=[],r=p(t,e,!1);if(w(r))return n;for(var i=function(t){var e=A(t,s);if(!E(e))throw new TypeError;var n=e.call(t);if(!x(n))throw new TypeError;return n}(r.keys()),o=0;;){var a=S(i);if(!a)return n.length=o,n;var u=a.value;try{n[o]=u}catch(t){try{C(i)}finally{throw t}}o++}}function b(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function w(t){return void 0===t}function M(t){return null===t}function x(t){return"object"==typeof t?null!==t:"function"==typeof t}function T(t,e){switch(b(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",r=A(t,i);if(void 0!==r){var s=r.call(t,n);if(x(s))throw new TypeError;return s}return function(t,e){if("string"===e){var n=t.toString;if(E(n))if(!x(i=n.call(t)))return i;if(E(r=t.valueOf))if(!x(i=r.call(t)))return i}else{var r;if(E(r=t.valueOf))if(!x(i=r.call(t)))return i;var i,s=t.toString;if(E(s))if(!x(i=s.call(t)))return i}throw new TypeError}(t,"default"===n?"number":n)}function R(t){var e=T(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function k(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function E(t){return"function"==typeof t}function P(t){return"function"==typeof t}function A(t,e){var n=t[e];if(null!=n){if(!E(n))throw new TypeError;return n}}function S(t){var e=t.next();return!e.done&&e}function C(t){var e=t.return;e&&e.call(t)}function B(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===l)return e;if(e!==l)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i||i===t?e:i}function D(t){return t.__=void 0,delete t.__,t}e("decorate",(function(t,e,n,r){if(w(n)){if(!k(t))throw new TypeError;if(!P(e))throw new TypeError;return function(t,e){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e);if(!w(r)&&!M(r)){if(!P(r))throw new TypeError;e=r}}return e}(t,e)}if(!k(t))throw new TypeError;if(!x(e))throw new TypeError;if(!x(r)&&!w(r)&&!M(r))throw new TypeError;return M(r)&&(r=void 0),function(t,e,n,r){for(var i=t.length-1;i>=0;--i){var s=(0,t[i])(e,n,r);if(!w(s)&&!M(s)){if(!x(s))throw new TypeError;r=s}}return r}(t,e,n=R(n),r)})),e("metadata",(function(t,e){return function(n,r){if(!x(n))throw new TypeError;if(!w(r)&&!function(t){switch(b(t)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;_(t,e,n,r)}})),e("defineMetadata",(function(t,e,n,r){if(!x(n))throw new TypeError;return w(r)||(r=R(r)),_(t,e,n,r)})),e("hasMetadata",(function(t,e,n){if(!x(e))throw new TypeError;return w(n)||(n=R(n)),function t(e,n,r){if(m(e,n,r))return!0;var i=B(n);return!M(i)&&t(e,i,r)}(t,e,n)})),e("hasOwnMetadata",(function(t,e,n){if(!x(e))throw new TypeError;return w(n)||(n=R(n)),m(t,e,n)})),e("getMetadata",(function(t,e,n){if(!x(e))throw new TypeError;return w(n)||(n=R(n)),function t(e,n,r){if(m(e,n,r))return g(e,n,r);var i=B(n);return M(i)?void 0:t(e,i,r)}(t,e,n)})),e("getOwnMetadata",(function(t,e,n){if(!x(e))throw new TypeError;return w(n)||(n=R(n)),g(t,e,n)})),e("getMetadataKeys",(function(t,e){if(!x(t))throw new TypeError;return w(e)||(e=R(e)),function t(e,n){var r=y(e,n),i=B(e);if(null===i)return r;var s=t(i,n);if(s.length<=0)return r;if(r.length<=0)return s;for(var o=new f,a=[],u=0,c=r;u<c.length;u++){var l=c[u];o.has(l)||(o.add(l),a.push(l))}for(var h=0,d=s;h<d.length;h++){l=d[h];o.has(l)||(o.add(l),a.push(l))}return a}(t,e)})),e("getOwnMetadataKeys",(function(t,e){if(!x(t))throw new TypeError;return w(e)||(e=R(e)),y(t,e)})),e("deleteMetadata",(function(t,e,n){if(!x(e))throw new TypeError;w(n)||(n=R(n));var r=p(e,n,!1);if(w(r))return!1;if(!r.delete(t))return!1;if(r.size>0)return!0;var i=v.get(e);return i.delete(n),i.size>0||v.delete(e),!0}))}(s)}()}(n||(n={}))}).call(this,n(72),n(73))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(5),i=n(2),s=n(39),o=n(5),a=n(10);var u,c,l;!function(t){t[t.Disable=-1]="Disable",t[t.Always=WebGL2RenderingContext.ALWAYS]="Always",t[t.Never=WebGL2RenderingContext.NEVER]="Never",t[t.Less=WebGL2RenderingContext.LESS]="Less",t[t.Equal=WebGL2RenderingContext.EQUAL]="Equal",t[t.LEqual=WebGL2RenderingContext.LEQUAL]="LEqual",t[t.Greater=WebGL2RenderingContext.GREATER]="Greater",t[t.NotEqual=WebGL2RenderingContext.NOTEQUAL]="NotEqual",t[t.GEqual=WebGL2RenderingContext.GEQUAL]="GEqual"}(u=e.DepthTest||(e.DepthTest={})),function(t){t[t.Disable=-1]="Disable",t[t.Zero=WebGL2RenderingContext.ZERO]="Zero",t[t.One=WebGL2RenderingContext.ONE]="One",t[t.SrcColor=WebGL2RenderingContext.SRC_COLOR]="SrcColor",t[t.OneMinusSrcColor=WebGL2RenderingContext.ONE_MINUS_SRC_COLOR]="OneMinusSrcColor",t[t.DstColor=WebGL2RenderingContext.DST_COLOR]="DstColor",t[t.OneMinusDstColor=WebGL2RenderingContext.ONE_MINUS_DST_COLOR]="OneMinusDstColor",t[t.SrcAlpha=WebGL2RenderingContext.SRC_ALPHA]="SrcAlpha",t[t.OneMinusSrcAlpha=WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA]="OneMinusSrcAlpha",t[t.DstAlpha=WebGL2RenderingContext.DST_ALPHA]="DstAlpha",t[t.OneMinusDstAlpha=WebGL2RenderingContext.ONE_MINUS_DST_ALPHA]="OneMinusDstAlpha"}(c=e.Blending||(e.Blending={})),function(t){t[t.Disable=-1]="Disable",t[t.Back=WebGL2RenderingContext.BACK]="Back",t[t.Front=WebGL2RenderingContext.FRONT]="Front",t[t.Both=WebGL2RenderingContext.FRONT_AND_BACK]="Both"}(l=e.Culling||(e.Culling={})),e.DefaultShaderAttributes={vert:"aPos",color:"aColor",uv:"aUV",uv2:"aUV2",normal:"aNormal"};class h extends a.Asset{constructor(t,n,a={},h=i.GL()){super(a.name),this._compiled=!1,a.name||(this.name="Shader_"+this.assetID),this.gl=h,this.program=r.panicNull(h.createProgram(),"Failed to create shader program"),this.vertexShaderSource=t,this.fragmentShaderSouce=n,this.vertexShader=r.panicNull(h.createShader(h.VERTEX_SHADER),"Failed to create vertex shader"),this.fragmentShader=r.panicNull(h.createShader(h.FRAGMENT_SHADER),"Failed to create fragment shader"),this.compile();const d=a.attributes||e.DefaultShaderAttributes;this.attributes={vert:this.gl.getAttribLocation(this.program,d.vert),color:this.gl.getAttribLocation(this.program,d.color),uv:this.gl.getAttribLocation(this.program,d.uv),uv2:this.gl.getAttribLocation(this.program,d.uv2),normal:this.gl.getAttribLocation(this.program,d.normal)},this.settings={depth:a.depth||u.Less,blend:a.blend||c.Disable,zWrite:!1!==a.zWrite,cull:a.cull||l.Back},this.builtinUniformLocations=o.getUniformsLocation(h,this.program,s.BuiltinUniforms)}get compiled(){return this._compiled}compile(){if(this.gl.shaderSource(this.vertexShader,this.vertexShaderSource),this.gl.compileShader(this.vertexShader),!this.gl.getShaderParameter(this.vertexShader,this.gl.COMPILE_STATUS))throw new Error("Failed to compile vertex shader:\r\n"+this.gl.getShaderInfoLog(this.vertexShader));if(this.gl.shaderSource(this.fragmentShader,this.fragmentShaderSouce),this.gl.compileShader(this.fragmentShader),!this.gl.getShaderParameter(this.fragmentShader,this.gl.COMPILE_STATUS))throw new Error("Failed to compile fragment shader:\r\n"+this.gl.getShaderInfoLog(this.fragmentShader));if(this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw new Error("Failed to link shader program:\r\n"+this.gl.getProgramInfoLog(this.program))}}e.Shader=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.AssetsPack=class{constructor(){this.mainAsset=null,this.assets=new Map}add(t,e){e.name=t,this.assets.set(t,e)}setMain(t){this.mainAsset=t}get(t){for(const[e,n]of this.assets)if(n instanceof t)return n;return null}getAll(t){return Array.from(this.assets.values()).filter(e=>e instanceof t)}}},function(t,e,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;const r=n(0),i=n(12);e.Sprite=class{constructor(t,e,n){this.texture=t,this.uvRect=new i.Rect(r.div(n,e),r.div(1,e))}}},function(t,e,n){"use strict";function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0});n(16).glMatrix.setMatrixArrayType(Array),r(n(3)),r(n(1)),r(n(7)),r(n(6)),r(n(17)),r(n(9)),r(n(29)),r(n(37))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ray=function(t,e){return{origin:t,direction:e.normalized}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n(30)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(32),i="#version 300 es\nprecision mediump float;\n\nin vec3 aPos;\nin vec4 aColor;\nin vec2 aUV;\nin vec3 aNormal;\n\nuniform mat4 uTransformM;\nuniform mat4 uTransformVP;\nuniform mat4 uTransformMVP;\n\nout vec4 vColor;\nout vec4 vPos;\nout vec2 vUV;\nout vec3 vNormal;\n\nvoid main()\n{\n    gl_Position = uTransformMVP * vec4(aPos, 1);\n    vColor = aColor;\n    vUV = aUV;\n    vNormal = aNormal;\n}\n";e.BuiltinShaderSources={DefaultVert:i,DefaultFrag:"#version 300 es\nprecision mediump float;\n\nin vec4 vColor;\nin vec4 vPos;\nin vec2 vUV;\n\nuniform sampler2D uMainTex;\nuniform vec4 uColor;\n\nout vec4 fragColor;\n\nvoid main()\n{\n    vec4 color = texture(uMainTex, vUV.xy).rgba;\n    color = color * vColor * uColor;\n    fragColor = color;\n}\n",BlitCopyFrag:"#version 300 es\nprecision mediump float;\n\nin vec4 vColor;\nin vec4 vPos;\nin vec2 vUV;\nin vec3 vNormal;\n\nuniform sampler2D uMainTex;\n\nout vec4 fragColor;\n\nvoid main()\n{\n    fragColor = texture(uMainTex, vUV).rgba;\n}\n",FlipTexVert:"#version 300 es\nprecision mediump float;\n\nin vec3 aPos;\nin vec2 aUV;\n\nout vec2 vUV;\n\nvoid main()\n{\n    gl_Position = vec4(aPos, 1);\n    vUV = vec2(aUV.x, vec2(1) - aUV.y);\n}"},e.BuiltinUniforms={matM:"uTransformM",matM_IT:"uTransformM_IT",matMInv:"uTransformMInv",matVP:"uTransformVP",matMVP:"uTransformMVP",matMV_IT:"uTransformMV_IT",flipUV:"uFlipUV",mainTex:"uMainTex"},e.compileBuiltinShaders=function(t){return{DefaultShader:new r.Shader(e.BuiltinShaderSources.DefaultVert,e.BuiltinShaderSources.DefaultFrag,{name:"DefaultShader"},t),BlitCopy:new r.Shader(e.BuiltinShaderSources.DefaultVert,e.BuiltinShaderSources.BlitCopyFrag,{name:"BlitCopy",depth:r.DepthTest.Always,blend:r.Blending.Disable,zWrite:!1},t),FlipTexture:new r.Shader(e.BuiltinShaderSources.FlipTexVert,e.BuiltinShaderSources.BlitCopyFrag,{blend:[r.Blending.One,r.Blending.Zero]},t),ColoredLine:new r.Shader("#version 300 es\nprecision mediump float;\n\nin vec3 aPos;\nin vec4 aColor;\n\nuniform mat4 uTransformM;\nuniform mat4 uTransformVP;\nuniform mat4 uTransformMVP;\n\nout vec4 vColor;\nout vec4 vPos;\n\nvoid main()\n{\n    gl_Position = uTransformMVP * vec4(aPos, 1);\n    vColor = aColor;\n}\n","#version 300 es\nprecision mediump float;\n\nin vec4 vColor;\nin vec4 vPos;\n\nout vec4 fragColor;\n\nvoid main()\n{\n    fragColor = vColor;\n}\n",{blend:[r.Blending.SrcAlpha,r.Blending.OneMinusSrcAlpha],depth:r.DepthTest.Disable,zWrite:!1},t),ErrorShader:new r.Shader(i,"#version 300 es\nprecision mediump float;\n\nin vec4 vPos;\nin vec2 vUV;\n\nuniform sampler2D uMainTex;\n\nout vec4 fragColor;\n\nvoid main()\n{\n    fragColor = texture(uMainTex, vUV).rgba;\n}\n",{name:"Error"},t)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(36),i=n(2),s=n(21);e.MeshBuilder=class{constructor(t=0,e=i.GlobalContext().gl){this.verts=[],this.triangles=[],this.uvs=[],this.colors=[],this.gl=e}addPolygon(t,e){const n=this.verts.length;for(let n=0;n<t.length;n++)this.verts.push(t[n]),this.uvs.push(e[n]),this.colors.push(r.Color.white);for(let e=2;e<t.length;e++)this.triangles.push(n+0,n+e-1,n+e)}addSubMesh(t,e,n=[r.Color.white],i=[r.vec2(0,0)]){const s=this.verts.length;if(e.length%3!=0)throw new Error("Invalid number of triangles.");for(let e=0;e<t.length;e++)this.verts.push(t[e]),this.uvs.push(e>=i.length?i[i.length-1]:i[e]),this.colors.push(e>=n.length?n[n.length-1]:n[e]);for(let t=0;t<e.length;t++)this.triangles.push(s+e[t])}toMesh(){const t=new s.Mesh(this.gl);return t.verts=this.verts,t.triangles=this.triangles,t.colors=this.colors,t.uvs=this.uvs,t.calculateNormals(),t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(6),i=n(2),s=n(5),o=n(10);class a extends o.Asset{constructor(t=i.GL()){var e,n;super(),this._verts=[],this._colors=[],this._lines=[],this.dirty=!0,this.vertices=new Float32Array(0),this.indices=new Uint32Array(0),this.name="Lines_"+this.assetID,this.gl=t,this.VBO=null!=(e=t.createBuffer())?e:s.panic("Failed to create vertex buffer."),this.EBO=null!=(n=t.createBuffer())?n:s.panic("Failed to create element buffer.")}get verts(){return this._verts}set verts(t){this._verts=t,this.dirty=!0}get colors(){return this._colors}set colors(t){this._colors=t,this.dirty=!0}get lines(){return this._lines}set lines(t){this._lines=t,this.dirty=!0}clear(){this.verts=[],this.colors=[],this.lines=[]}update(){if(this.dirty){const t=this.gl;if(this.lines.length%2!=0)throw new Error("Invalid lines.");if(this.colors.length!==this.verts.length&&(this.colors=[...this.colors,...s.fillArray(r.Color.white,this.verts.length-this.colors.length)]),this.vertices=new Float32Array(this.verts.flatMap((t,e)=>[...t,...this.colors[e]])),this.vertices.length!=7*this.verts.length)throw new Error("Buffer with invalid length.");this.indices=new Uint32Array(this.lines.flat()),t.bindBuffer(t.ARRAY_BUFFER,this.VBO),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.EBO),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.DYNAMIC_DRAW),this.dirty=!1}}bind(t){const e=this.gl;this.update();const n=t.attributes;e.bindBuffer(e.ARRAY_BUFFER,this.VBO),n.vert>=0&&(e.vertexAttribPointer(n.vert,3,e.FLOAT,!1,28,0),e.enableVertexAttribArray(n.vert)),n.color>=0&&(e.vertexAttribPointer(n.color,4,e.FLOAT,!1,28,12),e.enableVertexAttribArray(n.color)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.EBO)}destroy(){this.destroyed||(this.gl.deleteBuffer(this.VBO),this.gl.deleteBuffer(this.EBO),super.destroy())}}e.Lines=a;e.LineBuilder=class{constructor(t=0,e=i.GL()){this.verts=[],this.colors=[],this.lines=[],this.gl=e}addLine(t,e=r.Color.white){const n=this.verts.length,[i,s]=t;this.verts.push(i,s),this.colors.push(e,e),this.lines.push(n,n+1)}toLines(){const t=new a(this.gl);return t.verts=this.verts,t.colors=this.colors,t.lines=this.lines,t.update(),t}}},function(t,e,n){"use strict";function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),r(n(43)),r(n(45)),r(n(46)),r(n(20)),r(n(47)),r(n(44)),r(n(79)),r(n(80))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(23),i=n(22),s=n(2),o=n(3),a=n(20),u=n(9),c=n(17),l=n(6),h=n(1),d=n(37),f=n(7);var v;!function(t){t[t.Perspective=0]="Perspective",t[t.Orthographic=1]="Orthographic"}(v=e.Projection||(e.Projection={}));class p extends a.Entity{constructor(t=s.GlobalContext()){super(),this.output=i.RenderTarget.CanvasTarget,this.FOV=30,this.near=.3,this.far=1e3,this.viewHeight=1,this.projection=v.Perspective,this.clearColor=l.Color.black,this.clearDepth=!0,this.ctx=t}get pixelSize(){return this.output instanceof r.RenderTexture?o.vec2(this.output.width,this.output.height):o.vec2(this.ctx.width,this.ctx.height)}get aspectRatio(){return this.pixelSize.x/this.pixelSize.y}get viewProjectionMatrix(){const t=this.worldToLocalMatrix,e=this.projectionMatrix;return u.mat4.mul(e,t)}get projectionMatrix(){return this.projection===v.Perspective?u.mat4.perspective(this.FOV*c.Deg2Rad,this.aspectRatio,this.near,this.far):u.mat4.ortho(this.viewHeight,this.aspectRatio,this.near,this.far)}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.on(t,e)}__preRender(t){this.eventEmitter.emit("prerender",this,t)}__postRender(t){this.eventEmitter.emit("postrender",this,t)}screenToRay(t){const e=this.screenToWorld(t);return d.ray(this.position,c.minus(h.vec3(e.x,e.y,e.z),this.position))}screenToWorld(t){const e=this.projection==v.Perspective?this.near:1,n=this.screenToViewport(t).mul(o.vec2(2,-2)).minus(o.vec2(1,-1)),r=c.mul(f.vec4(n.x,n.y,-1,1),e),i=u.mat4.invert(this.viewProjectionMatrix),s=u.mat4.mulVec4(i,r);return h.vec3(s[0],s[1],s[2])}screenToViewport(t){return this.output===i.RenderTarget.CanvasTarget?c.div(t,o.vec2(this.ctx.width,this.ctx.height)):this.output instanceof r.RenderTexture?c.div(t,o.vec2(this.output.width,this.output.height)):o.vec2.zero()}}e.Camera=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(9),i=n(1),s=n(29);e.Transform=class{constructor(){this._parent=null,this.children=new Set,this.localPosition=i.vec3.zero(),this.localRotation=s.quat.identity(),this.localScaling=i.vec3.one()}get position(){return this._parent?r.mat4.mulPoint(this._parent.localToWorldMatrix,this.localPosition):this.localPosition}set position(t){this._parent?this.localPosition=r.mat4.mulPoint(this._parent.worldToLocalMatrix,t):this.localPosition=t}get rotation(){return this._parent?s.quat.mul(this._parent.rotation,this.localRotation):this.localRotation}set rotation(t){this._parent?this.localRotation=s.quat.normalize(s.quat.mul(s.quat.invert(this._parent.rotation),t)):this.localRotation=s.quat.normalize(t)}get localToWorldMatrix(){if(!this._parent)return r.mat4.rts(this.localRotation,this.localPosition,this.localScaling);const t=r.mat4.rts(this.localRotation,this.localPosition,this.localScaling);return r.mat4.mul(t,this._parent.localToWorldMatrix,t)}get worldToLocalMatrix(){return r.mat4.invert(this.localToWorldMatrix)}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.children.add(this)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(2),i=n(20);class s extends i.Entity{constructor(t=r.GlobalContext()){super(),this.meshes=[],this.materials=[],this.materials=[t.assets.materials.default]}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}__onRender(t,e){this.eventEmitter.emit("render",this,t,e)}}e.RenderObject=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(20),i=n(6);var s;!function(t){t[t.Directional=0]="Directional",t[t.Point=1]="Point"}(s=e.LightType||(e.LightType={}));class o extends r.Entity{constructor(t=s.Directional){super(),this.intensity=1,this.color=i.Color.white,this.type=t}}e.Light=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(20),i=n(19),s=n(18);class o extends r.EntityManager{constructor(){super(),this.eventEmitter=new i.EventEmitter,this.assetID=s.AssetManager.newAssetID(this),this.name="Scene_"+this.assetID}add(t,e){super.add(t),t.__addToScene(this);t.constructor;e&&(t.parent=e);for(const e of t.children)this.add(e,t);this.eventEmitter.emit("entity-add",t,e||null)}remove(t){super.remove(t),this.eventEmitter.emit("entity-remove",t,t.parent)}rootEntities(){return this._entities.filter(t=>null===t.parent)}getEntities(){return this._entities}getEntitiesOfType(t){return this.entities.filter(e=>e instanceof t)}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}destroy(){throw this._entities=[],this.entityMap.clear(),new Error("Method not implemented.")}}e.Scene=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(9),i=n(49),s=n(6),o=n(22),a=n(41),u=n(1),c=n(50);e.PreviewRenderer=class{constructor(t){this.materialReplaceMap=new Map,this.debugLayer=new c.DebugLayerRenderer,this.renderer=t;const e=s.rgba(1,1,1,.1),n=new a.LineBuilder(0,t.gl);for(let t=-10;t<=10;t+=1)n.addLine([u.vec3(t,0,-10),u.vec3(t,0,10)],e),n.addLine([u.vec3(-10,0,t),u.vec3(10,0,t)],e);this.grid=n.toLines()}render(t,e){for(let n=0;n<e.length;n++){const r=new i.RenderData(e[n],t.scene);this.renderCamera(t,r)}}setupLight(t,e){t.renderer.setGlobalUniform("uLightDir","vec3",u.vec3(-1,1,0).normalize()),t.renderer.setGlobalUniform("uAmbientSky","color",s.rgb(.2,.2,.2)),t.renderer.setGlobalUniform("uLightPos","vec3",e.camera.position),t.renderer.setGlobalUniform("uLightColor","color",s.rgb(.8,.8,.8))}renderCamera(t,e){t.renderer.clear(s.rgb(.3,.3,.3),!0);const n=e.camera;n.__preRender(t),n.output===o.RenderTarget.CanvasTarget?t.renderer.setRenderTarget(o.RenderTarget.CanvasTarget):t.renderer.setRenderTarget(n.output),t.renderer.clear(n.clearColor,n.clearDepth),t.renderer.setViewProjection(n.worldToLocalMatrix,n.projectionMatrix),t.renderer.setGlobalUniform("uCameraPos","vec3",n.position),this.setupLight(t,e);const r=e.getVisibleObjects(i.RenderOrder.NearToFar);for(const n of r){n.__onRender(t,e);const r=n.localToWorldMatrix;for(let e=0;e<n.meshes.length;e++){if(!n.meshes[e])continue;const i=n.materials[e]||t.renderer.assets.materials.default;this.drawWithMaterial(n.meshes[e],r,i)}}this.debugLayer.render(t,e),n.__postRender(t)}renderGrid(t,e){this.renderer.drawLines(this.grid,r.mat4.identity(),this.renderer.assets.materials.ColoredLine)}drawWithMaterial(t,e,n){this.materialReplaceMap.has(n.constructor)?this.renderer.drawMesh(t,e,this.materialReplaceMap.get(n.constructor)):this.renderer.drawMesh(t,e,n)}replaceMaterial(t,e){this.materialReplaceMap.set(t,e)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(45),i=n(46),s=n(9);var o;!function(t){t[t.NearToFar=0]="NearToFar",t[t.FarToNear=1]="FarToNear"}(o=e.RenderOrder||(e.RenderOrder={}));e.RenderData=class{constructor(t,e){this.visibleObjects=[],this.visibleLights=[],this.camera=t,this.visibleLights=e.getEntitiesOfType(i.Light),this.visibleObjects=e.getEntitiesOfType(r.RenderObject)}getVisibleObjects(t=o.NearToFar){const e=this.camera.worldToLocalMatrix;let n=this.visibleObjects.map(t=>({pos:s.mat4.mulPoint(e,t.position),obj:t}));return n=t===o.NearToFar?n.sort((t,e)=>t.pos.z-e.pos.z):n.sort((t,e)=>e.pos.z-t.pos.z),n.map(t=>t.obj)}getVisibleLights(){return this.visibleLights}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(18),i=n(6),s=n(9),o=n(3);e.DebugLayerRenderer=class{constructor(){this.lines=new r.Lines}drawLine(t,e,n=i.Color.white){const r=this.lines.verts,s=this.lines.lines,o=this.lines.colors,a=r.length;r.push(t,e),o.push(n,n),s.push(a,a+1),this.lines.verts=r,this.lines.colors=o,this.lines.lines=s}drawRect(t,e,n=i.Color.white){this.drawLine(o.vec2(t.x,t.y).toVec3(),o.vec2(e.x,t.y).toVec3(),n),this.drawLine(o.vec2(e.x,t.y).toVec3(),o.vec2(e.x,e.y).toVec3(),n),this.drawLine(o.vec2(e.x,e.y).toVec3(),o.vec2(t.x,e.y).toVec3(),n),this.drawLine(o.vec2(t.x,e.y).toVec3(),o.vec2(t.x,t.y).toVec3(),n)}render(t,e){t.renderer.drawLines(this.lines,s.mat4.identity(),t.renderer.assets.materials.ColoredLine),this.lines.clear()}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(82))},function(t,e,n){"use strict";t.exports=function(t,e,n,r){for(var i=65535&t|0,s=t>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{s=s+(i=i+e[r++]|0)|0}while(--o);i%=65521,s%=65521}return i|s<<16|0}},function(t,e,n){"use strict";var r=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();t.exports=function(t,e,n,i){var s=r,o=i+n;t^=-1;for(var a=i;a<o;a++)t=t>>>8^s[255&(t^e[a])];return-1^t}},function(t,e,n){"use strict";var r=n(8),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){s=!1}for(var o=new r.Buf8(256),a=0;a<256;a++)o[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function u(t,e){if(e<65534&&(t.subarray&&s||!t.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",o=0;o<e;o++)n+=String.fromCharCode(t[o]);return n}o[254]=o[254]=1,e.string2buf=function(t){var e,n,i,s,o,a=t.length,u=0;for(s=0;s<a;s++)55296==(64512&(n=t.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=t.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),u+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(u),o=0,s=0;o<u;s++)55296==(64512&(n=t.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=t.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),n<128?e[o++]=n:n<2048?(e[o++]=192|n>>>6,e[o++]=128|63&n):n<65536?(e[o++]=224|n>>>12,e[o++]=128|n>>>6&63,e[o++]=128|63&n):(e[o++]=240|n>>>18,e[o++]=128|n>>>12&63,e[o++]=128|n>>>6&63,e[o++]=128|63&n);return e},e.buf2binstring=function(t){return u(t,t.length)},e.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e},e.buf2string=function(t,e){var n,r,i,s,a=e||t.length,c=new Array(2*a);for(r=0,n=0;n<a;)if((i=t[n++])<128)c[r++]=i;else if((s=o[i])>4)c[r++]=65533,n+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&n<a;)i=i<<6|63&t[n++],s--;s>1?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return u(c,r)},e.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+o[t[n]]>e?n:e}},function(t,e,n){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,n){"use strict";let r;Object.defineProperty(e,"__esModule",{value:!0}),e.Debug=e.initDebugLyaerRenderer=void 0,e.initDebugLyaerRenderer=function(t){r=t},e.Debug=function(){return r}},function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.LightComposeMaterial=e.ProceduralLightMaterial=void 0;const s=n(0),o=i(n(59)),a=i(n(100)),u=i(n(101));let c=class extends(s.MaterialFromShader(new s.Shader(o.default,a.default,{depth:s.DepthTest.Disable,blend:[s.Blending.One,s.Blending.One],zWrite:!1}))){constructor(){super(...arguments),this.lightDirection=s.vec2.up(),this.lightAngle=Math.PI}};r([s.shaderProp("uLightDirection","vec2")],c.prototype,"lightDirection",void 0),r([s.shaderProp("uLightAngle","float")],c.prototype,"lightAngle",void 0),c=r([s.materialDefine],c),e.ProceduralLightMaterial=c;let l=class extends(s.MaterialFromShader(new s.Shader(o.default,u.default,{name:"BlitCopy",depth:s.DepthTest.Disable,blend:[s.Blending.DstColor,s.Blending.Zero],zWrite:!1}))){};l=r([s.materialDefine],l),e.LightComposeMaterial=l},function(t,e){t.exports="#version 300 es\r\nprecision mediump float;\r\n\r\nin vec3 aPos;\r\nin vec4 aColor;\r\nin vec2 aUV;\r\nin vec3 aNormal;\r\n\r\nuniform mat4 uTransformM;\r\nuniform mat4 uTransformVP;\r\nuniform mat4 uTransformMVP;\r\nuniform mat4 uTransformM_IT;\r\n\r\nout vec4 vColor;\r\nout vec4 vPos;\r\nout vec2 vUV;\r\nout vec3 vNormal;\r\nout vec3 vWorldPos;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = uTransformMVP * vec4(aPos, 1);\r\n    vPos = gl_Position;\r\n    vColor = aColor;\r\n    vUV = aUV;\r\n    vNormal = (uTransformM_IT *  vec4(aNormal, 0)).xyz;\r\n    vWorldPos = (uTransformM * vec4(aPos, 1)).xyz;\r\n    \r\n}"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.makeQuad=void 0;const r=n(0);e.makeQuad=function(){const t=new r.Mesh;return t.verts=[r.vec3(-.5,-.5,0),r.vec3(.5,-.5,0),r.vec3(.5,.5,0),r.vec3(-.5,.5,0)],t.triangles=[0,1,3,1,2,3],t.uvs=[r.vec2(0,0),r.vec2(1,0),r.vec2(1,1),r.vec2(0,1)],t.calculateNormals(),t.name="mesh_quad",t}},function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Material2D=void 0;const s=i(n(59)),o=i(n(103)),a=n(0);let u=class extends(a.MaterialFromShader(new a.Shader(s.default,o.default,{blend:[a.Blending.SrcAlpha,a.Blending.OneMinusSrcAlpha]}))){constructor(){super(...arguments),this.color=a.Color.white,this.texture=null}};r([a.shaderProp("uColor","color")],u.prototype,"color",void 0),r([a.shaderProp("uMainTex","tex2d")],u.prototype,"texture",void 0),u=r([a.materialDefine],u),e.Material2D=u},function(t,e,n){"use strict";n.r(e),e.default=n.p+"static/img/tiles.png"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.calcChunkPos=e.calcChunkID=void 0;const r=n(0),i=n(12);e.calcChunkID=function(t){-0==t.x&&(t.x=0),-0==t.y&&(t.y=0);const e=t.x>=0?0:1,n=t.y>=0?0:1;return e<<31|Math.abs(Math.floor(t.x))<<16|n<<15|Math.abs(Math.floor(t.y))},e.calcChunkPos=function(t,e){const n=r.vec2((t.x,0),(t.y,0));return[r.minus(i.floor2(r.div(t,r.vec2(e,e))),n),r.vec2(i.floorReminder(t.x,e),i.floorReminder(t.y,e))]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.$$=e.$=void 0;e.$=t=>document.querySelector(t);e.$$=t=>Array.from(document.querySelectorAll(t))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Campfire=void 0;const r=n(15),i=n(25);class s extends i.Light2D{constructor(){super(),this.size=20}static spawn(t,e=!1){const n=new s;n.position=t.toVec3(1),r.Global().scene.add(n),e&&r.Global().session.setObj({pos:t,type:"campfire"})}}e.Campfire=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.showLog=void 0;const r=document.querySelector("#logs");e.showLog=function(t){const e=document.createElement("p");e.innerText=t,r.appendChild(e),setTimeout(()=>{e.remove()},3e3)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Mark=void 0;const r=n(0),i=n(12),s=n(15),o=n(28);class a extends o.SpriteObject{constructor(){super(),this.sprite=s.Global().assets.mark}static makeOnGround(t,e=!1){t=i.floor2(t).plus(r.vec2(.5));const n=new a;n.position=t.toVec3(1),s.Global().scene.add(n),e&&s.Global().session.setObj({type:"mark",pos:t})}}e.Mark=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FlashLight=void 0;const r=n(25);class i extends r.Light2D{constructor(){super()}}e.FlashLight=i},function(t,e,n){"use strict";n.r(e),e.default=n.p+"static/img/0x72_16x16DungeonTileset.v4.png"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MessageType=void 0,function(t){t.Join="join",t.ServerHandshake="handshake",t.Reconnect="reconnect",t.Sync="sync",t.Start="start",t.SetObject="setobj"}(e.MessageType||(e.MessageType={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),i=n(57),s=document.querySelector("#canvas");let o=s.getBoundingClientRect();s.width=o.width,s.height=o.height;const a=new r.ZograEngine(s),u=n(99),c=n(102),l=n(126),h=n(66),d=new l.GameSession("ws://found.sardinefish.com/ws","User");h.showLog("connected"),d.onStart=()=>{h.showLog("game start");const t=new u.RenderPipeline;a.renderPipeline=t,i.initDebugLyaerRenderer(t.debuglayer),c.start(a,d)}},function(t,e){var n,r,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var u,c=[],l=!1,h=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&f())}function f(){if(!l){var t=a(d);l=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function v(t,e){this.fun=t,this.array=e}function p(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new v(t,e)),1!==c.length||l||a(f)},v.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(5),i=n(2),s=n(1),o=n(6),a=n(9),u=n(22),c=n(23),l=n(3),h=n(75),d=n(29),f=n(32);e.ZograRenderer=class{constructor(t,e,n){this.viewProjectionMatrix=a.mat4.identity(),this.viewMatrix=a.mat4.identity(),this.projectionMatrix=a.mat4.identity(),this.target=u.RenderTarget.CanvasTarget,this.shader=null,this.globalUniforms=new Map,this.globalTextures=new Map,this.canvas=t,this.width=void 0===e?t.width:e,this.height=void 0===n?t.height:n,this.canvas.width=this.width,this.canvas.height=this.height,this.gl=r.panicNull(this.canvas.getContext("webgl2"),"WebGL2 is not support on current device."),this.assets=new h.BuiltinAssets(this.gl),this.ctx={gl:this.gl,width:this.width,height:this.height,assets:this.assets},i.GlobalContext()||this.use()}use(){i.setGlobalContext(this.ctx)}setSize(t,e){this.canvas.width=t,this.canvas.height=e,this.width=t,this.height=e,this.ctx.width=t,this.ctx.height=e}get canvasSize(){return l.vec2(this.width,this.height)}setViewProjection(t,e){this.viewProjectionMatrix=a.mat4.mul(e,t)}setRenderTarget(t,e){if(t instanceof u.RenderTarget)this.target!==t&&this.target.release(),this.target=t;else if(t instanceof Array){this.target.release(),this.target=new u.RenderTarget(t[0].width,t[0].height,this.ctx);for(let e=0;e<t.length;e++)this.target.addColorAttachment(t[e])}else t instanceof c.RenderTexture&&(this.target.release(),this.target=new u.RenderTarget(t.width,t.height,this.ctx),this.target.addColorAttachment(t));e&&this.target.setDepthAttachment(e),this.target.bind(this.ctx)}clear(t=o.Color.black,e=!0){this.gl.clearColor(t.r,t.g,t.b,t.a),this.gl.clear(this.gl.COLOR_BUFFER_BIT|(e?this.gl.DEPTH_BUFFER_BIT:0))}blit(t,e,n=this.assets.materials.blitCopy){if(e instanceof c.RenderTexture){const t=new u.RenderTarget(e.width,e.height,this.ctx);t.addColorAttachment(e),e=t}else if(e instanceof Array){const t=new u.RenderTarget(0,0,this.ctx);for(let n=0;n<e.length;n++)t.addColorAttachment(e[n]);e=t}const r=this.viewProjectionMatrix,i=this.target;this.target=e,this.viewProjectionMatrix=a.mat4.identity(),this.setGlobalTexture("uMainTex",t),this.drawMesh(this.assets.meshes.quad,a.mat4.rts(d.quat.identity(),s.vec3(0,0,0),s.vec3(2,2,1)),n),this.unsetGlobalTexture("uMainTex"),this.target=i,this.viewProjectionMatrix=r}useShader(t){const e=this.gl;if(this.shader=t,e.useProgram(t.program),t.settings.depth===f.DepthTest.Disable?e.disable(e.DEPTH_TEST):(e.enable(e.DEPTH_TEST),e.depthMask(t.settings.zWrite),e.depthFunc(t.settings.depth)),t.settings.blend===f.Blending.Disable)e.disable(e.BLEND);else{const[n,r]="number"==typeof t.settings.blend?[t.settings.blend,f.Blending.Zero]:t.settings.blend;e.enable(e.BLEND),e.blendFunc(n,r)}t.settings.cull===f.Culling.Disable?e.disable(e.CULL_FACE):(e.enable(e.CULL_FACE),e.cullFace(t.settings.cull),e.frontFace(e.CCW))}setupTransforms(t,e){const n=this.gl,r=a.mat4.mul(this.viewProjectionMatrix,e),i=a.mat4.transpose(a.mat4.invert(e)),s=a.mat4.transpose(a.mat4.invert(a.mat4.mul(this.viewMatrix,e)));t.builtinUniformLocations.matM&&n.uniformMatrix4fv(t.builtinUniformLocations.matM,!1,e),t.builtinUniformLocations.matVP&&n.uniformMatrix4fv(t.builtinUniformLocations.matVP,!1,this.viewProjectionMatrix),t.builtinUniformLocations.matMVP&&n.uniformMatrix4fv(t.builtinUniformLocations.matMVP,!1,r),t.builtinUniformLocations.matM_IT&&n.uniformMatrix4fv(t.builtinUniformLocations.matM_IT,!1,i),t.builtinUniformLocations.matMV_IT&&n.uniformMatrix4fv(t.builtinUniformLocations.matMV_IT,!1,s)}setupGlobalUniforms(t,e){const n=this.gl;for(const e of this.globalUniforms.values()){const r=n.getUniformLocation(t.program,e.name);if(r)switch(e.type){case"int":n.uniform1i(r,e.value);break;case"float":n.uniform1f(r,e.value);break;case"vec2":n.uniform2fv(r,e.value,0,2);break;case"vec3":n.uniform3fv(r,e.value,0,3);break;case"vec4":case"color":n.uniform4fv(r,e.value,0,4)}}for(const r of this.globalTextures.values()){const i=n.getUniformLocation(t.program,r.name);i&&r.texture.bind(i,e)}}drawMesh(t,e,n){n||(n=this.assets.materials.error);const r=this.gl,i={assets:this.assets,gl:r,nextTextureUnit:0,size:l.vec2(this.width,this.height)};this.target.bind(this.ctx),this.useShader(n.shader),n.setup(i),this.setupTransforms(n.shader,e),this.setupGlobalUniforms(n.shader,i),t.bind(n.shader,r),r.drawElements(r.TRIANGLES,t.triangles.length,r.UNSIGNED_INT,0)}drawLines(t,e,n){const r=this.gl,i={assets:this.assets,gl:r,nextTextureUnit:0,size:l.vec2(this.width,this.height)};this.target.bind(this.ctx),this.useShader(n.shader),n.setup(i),this.setupTransforms(n.shader,e),this.setupGlobalUniforms(n.shader,i),t.bind(n.shader),r.drawElements(r.LINES,t.lines.length,r.UNSIGNED_INT,0)}setGlobalUniform(t,e,n){this.globalUniforms.set(t,{name:t,type:e,value:n})}unsetGlobalUniform(t){this.globalUniforms.delete(t)}setGlobalTexture(t,e){this.globalTextures.set(t,{name:t,texture:e})}unsetGlobalTexture(t){this.globalTextures.delete(t)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(76),i=n(39),s=n(77),o=n(78);e.BuiltinAssets=class{constructor(t){let e={assets:this,gl:t,width:0,height:0};this.gl=t,this.BuiltinUniforms=i.BuiltinUniforms,this.shaderSources=i.BuiltinShaderSources,this.shaders=i.compileBuiltinShaders(t),this.meshes=o.createBuiltinMesh(t),this.textures=s.createDefaultTextures(e),this.types=r.createBuiltinMaterialTypes(t,this.textures,this.shaders),this.materials=r.createBuiltinMaterial(t,this.types,this.shaders,this.textures)}}},function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o};Object.defineProperty(e,"__esModule",{value:!0});const i=n(30),s=n(6),o=(n(38),n(3));e.createBuiltinMaterial=function(t,e,n,r){const s=new i.Material(n.ErrorShader,t);return s.setProp("uMainTex","tex2d",r.error),{error:s,default:new e.DefaultMaterial(t),blitCopy:new e.BlitCopy(t),ColoredLine:new i.Material(n.ColoredLine,t)}},e.createBuiltinMaterialTypes=function(t,e,n){let a=class extends(i.MaterialFromShader(n.DefaultShader)){constructor(){super(...arguments),this.color=s.Color.white,this.mainTexture=e.default}};r([i.shaderProp("uColor","color")],a.prototype,"color",void 0),r([i.shaderProp("uMainTex","tex2d")],a.prototype,"mainTexture",void 0),a=r([i.materialDefine],a);let u=class extends(i.MaterialFromShader(n.BlitCopy)){constructor(){super(...arguments),this.flip=o.vec2(0,0)}};r([i.shaderProp("uFlip","vec2")],u.prototype,"flip",void 0),u=r([i.materialDefine],u);let c=class extends(i.MaterialFromShader(n.DefaultShader)){constructor(){super(...arguments),this.color=s.Color.white,this.mainTexture=e.default,this.normalTexture=e.defaultNormal,this.emission=s.Color.black,this.specular=s.Color.white,this.metiallic=.023,this.smoothness=.5,this.fresnel=5}};return r([i.shaderProp("uColor","color")],c.prototype,"color",void 0),r([i.shaderProp("uMainTex","tex2d")],c.prototype,"mainTexture",void 0),r([i.shaderProp("uNormalTex","tex2d")],c.prototype,"normalTexture",void 0),r([i.shaderProp("uEmission","color")],c.prototype,"emission",void 0),r([i.shaderProp("uSpecular","color")],c.prototype,"specular",void 0),r([i.shaderProp("uMetallic","float")],c.prototype,"metiallic",void 0),r([i.shaderProp("uSmoothness","float")],c.prototype,"smoothness",void 0),r([i.shaderProp("uFresnel","float")],c.prototype,"fresnel",void 0),c=r([i.materialDefine],c),{DefaultMaterial:a,BlitCopy:u,DefaultLit:c}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(5),i=n(23),s=n(11);e.createDefaultTextures=function(t){var e;const n=document.createElement("canvas");n.width=n.height=64;const o=null!=(e=n.getContext("2d"))?e:r.panic("Failed to create default texture.");o.fillStyle="black",o.fillRect(0,0,64,64),o.fillStyle="cyan",o.fillRect(0,0,32,32),o.fillRect(32,32,32,32);const a=new i.Texture2D(64,64,s.TextureFormat.RGBA,i.FilterMode.Linear,t);a.setData(n),a.name="Texture-Error",o.fillStyle="blue",o.fillRect(0,0,64,64);const u=new i.Texture2D(64,64,s.TextureFormat.RGBA,i.FilterMode.Linear,t);u.setData(n),u.name="Default-Normal",o.fillStyle="white",o.fillRect(0,0,64,64);const c=new i.Texture2D(64,64,s.TextureFormat.RGBA,i.FilterMode.Linear,t);return c.setData(n),c.name="Default-White",{default:c,defaultNormal:u,error:a}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(21),i=n(1),s=n(3),o=n(40);function a(t){const e=new r.Mesh(t);return e.verts=[i.vec3(-.5,-.5,0),i.vec3(.5,-.5,0),i.vec3(.5,.5,0),i.vec3(-.5,.5,0)],e.triangles=[0,1,3,1,2,3],e.uvs=[s.vec2(0,0),s.vec2(1,0),s.vec2(1,1),s.vec2(0,1)],e.calculateNormals(),e.name="mesh_quad",e}function u(t){const e=new r.Mesh(t);return e.verts=[i.vec3(-1,-1,0),i.vec3(1,-1,0),i.vec3(1,1,0),i.vec3(-1,1,0)],e.triangles=[0,1,3,1,2,3],e.uvs=[s.vec2(0,0),s.vec2(1,0),s.vec2(1,1),s.vec2(0,1)],e.calculateNormals(),e.name="mesh_screen_quad",e}function c(t){const e=[i.vec3(-.5,-.5,-.5),i.vec3(.5,-.5,-.5),i.vec3(.5,.5,-.5),i.vec3(-.5,.5,-.5),i.vec3(-.5,-.5,.5),i.vec3(.5,-.5,.5),i.vec3(.5,.5,.5),i.vec3(-.5,.5,.5)],n=[s.vec2(0,0),s.vec2(1,0),s.vec2(1,1),s.vec2(0,1)],r=new o.MeshBuilder(24,t);r.addPolygon([e[1],e[0],e[3],e[2]],[n[0],n[1],n[2],n[3]]),r.addPolygon([e[5],e[1],e[2],e[6]],[n[0],n[1],n[2],n[3]]),r.addPolygon([e[4],e[5],e[6],e[7]],[n[0],n[1],n[2],n[3]]),r.addPolygon([e[0],e[4],e[7],e[3]],[n[0],n[1],n[2],n[3]]),r.addPolygon([e[7],e[6],e[2],e[3]],[n[0],n[1],n[2],n[3]]),r.addPolygon([e[0],e[1],e[5],e[4]],[n[0],n[1],n[2],n[3]]);const a=r.toMesh();return a.name="mesh_cube",a}e.createBuiltinMesh=function(t){return{quad:a(t),screenQuad:u(t),cube:c(t)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(47),i=n(48),s=n(43),o=n(18),a=n(19);class u{constructor(t,e=i.PreviewRenderer){this._time={deltaTime:0,time:0},u.current=this,this.renderer=new o.ZograRenderer(t,t.width,t.height),this.renderPipeline=new e(this.renderer),this._scene=new r.Scene,this.eventEmitter=new a.EventEmitter}get time(){return this._time}get scene(){return this._scene}set scene(t){const e=this._scene;this._scene=t,this.eventEmitter.emit("scene-change",t,e)}renderScene(){const t=this.scene.getEntitiesOfType(s.Camera);this.renderPipeline.render({renderer:this.renderer,scene:this.scene},t)}updateEntities(t){const e=this.scene.rootEntities();for(const n of e)n.__updateRecursive(t)}start(){let t=0,e=0;const n=r=>{if(0===t)return e=t=r,void requestAnimationFrame(n);const i=(r-t)/1e3;t=r;const o={time:(r-e)/1e3,deltaTime:i};this._time=o,this.eventEmitter.emit("update",o),this.updateEntities(o),this.eventEmitter.emit("render",this.scene.getEntitiesOfType(s.Camera)),this.renderScene(),requestAnimationFrame(n)};requestAnimationFrame(n)}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}}e.ZograEngine=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(3),i=n(17),s=n(5);var o,a;!function(t){t[t.Pressed=1]="Pressed",t[t.Released=0]="Released"}(o=e.KeyState||(e.KeyState={}));class u{constructor(){this.keyStates=new Map,this.keyStatesThisFrame=new Map,this.mousePos=r.vec2.zero(),this.mouseDelta=r.vec2.zero(),this.wheelDelta=0}}e.InputManager=class{constructor(t={}){var e,n;this.preventBrowserShortcut=!0,this.states=new s.DoubleBuffer(()=>new u),this.eventTarget=t.target||window,t.bound?this.bound=t.bound:(null===(e=t.target)||void 0===e?void 0:e.getBoundingClientRect)&&(this.bound=t.target),this.pointerLockElement=null!=(n=t.pointerLockElement)?n:document.body,this.eventTarget.addEventListener("keydown",t=>{this.states.back.keyStates.set(t.keyCode,o.Pressed),this.states.back.keyStatesThisFrame.set(t.keyCode,o.Pressed),this.preventBrowserShortcut&&t.ctrlKey&&(t.keyCode==a.S||t.keyCode==a.W)&&(t.preventDefault(),t.stopPropagation())}),this.eventTarget.addEventListener("keyup",t=>{this.states.back.keyStates.set(t.keyCode,o.Released),this.states.back.keyStatesThisFrame.set(t.keyCode,o.Released)}),this.eventTarget.addEventListener("mousedown",t=>{var e,n;const s=null===(e=this.bound)||void 0===e?void 0:e.getBoundingClientRect();if(s){const e=r.vec2(s.left,null===(n=s)||void 0===n?void 0:n.top),o=i.minus(r.vec2(t.clientX,t.clientY),e);if(o.x<0||o.y<0||o.x>s.width||o.y>s.height)return}this.states.back.keyStates.set(a.Mouse0+t.button,o.Pressed),this.states.back.keyStatesThisFrame.set(a.Mouse0+t.button,o.Pressed)}),this.eventTarget.addEventListener("mouseup",t=>{var e,n;const s=null===(e=this.bound)||void 0===e?void 0:e.getBoundingClientRect();if(s){const e=r.vec2(s.left,null===(n=s)||void 0===n?void 0:n.top),o=i.minus(r.vec2(t.clientX,t.clientY),e);if(o.x<0||o.y<0||o.x>s.width||o.y>s.height)return}this.states.back.keyStates.set(a.Mouse0+t.button,o.Released),this.states.back.keyStatesThisFrame.set(a.Mouse0+t.button,o.Released)}),this.eventTarget.addEventListener("mousemove",t=>{var e,n,s,o,a;const u=null===(e=this.bound)||void 0===e?void 0:e.getBoundingClientRect(),c=r.vec2(null!=(s=null===(n=u)||void 0===n?void 0:n.left)?s:0,null!=(a=null===(o=u)||void 0===o?void 0:o.top)?a:0),l=i.minus(r.vec2(t.clientX,t.clientY),c);this.states.back.mouseDelta.plus(r.vec2(t.movementX,t.movementY)),this.states.back.mousePos=l}),this.eventTarget.addEventListener("wheel",t=>{this.states.back.wheelDelta=t.deltaY});for(const t in a)isNaN(t)&&a.hasOwnProperty(t)&&this.states.back.keyStates.set(a[t],o.Released);window.addEventListener("beforeunload",t=>{!this.preventBrowserShortcut||this.states.back.keyStates.get(a.W)!==o.Pressed&&this.states.back.keyStates.get(a.Control)!==o.Pressed||(t.preventDefault(),t.returnValue="Really want to quit?")})}get pointerPosition(){return this.states.current.mousePos}get pointerDelta(){return this.states.current.mouseDelta}get wheelDelta(){return this.states.current.wheelDelta}getKey(t){return this.states.current.keyStates.get(t)===o.Pressed}getKeyDown(t){return this.states.current.keyStatesThisFrame.get(t)===o.Pressed}getKeyUp(t){return this.states.current.keyStatesThisFrame.get(t)===o.Released}update(){this.states.update(),this.states.back.keyStatesThisFrame.clear(),this.states.back.mouseDelta=r.vec2.zero(),this.states.back.wheelDelta=0;for(const[t,e]of this.states.current.keyStates)this.states.back.keyStates.set(t,e);this.states.back.mousePos=this.states.current.mousePos}lockPointer(){this.pointerLockElement.requestPointerLock()}releasePointer(){document.exitPointerLock()}},function(t){t[t.BackSpace=8]="BackSpace",t[t.Tab=9]="Tab",t[t.Clear=12]="Clear",t[t.Enter=13]="Enter",t[t.Shift=16]="Shift",t[t.Control=17]="Control",t[t.Alt=18]="Alt",t[t.Pause=19]="Pause",t[t.CapsLock=20]="CapsLock",t[t.Escape=27]="Escape",t[t.Space=32]="Space",t[t.Prior=33]="Prior",t[t.Next=34]="Next",t[t.End=35]="End",t[t.Home=36]="Home",t[t.Left=37]="Left",t[t.Up=38]="Up",t[t.Right=39]="Right",t[t.Down=40]="Down",t[t.Select=41]="Select",t[t.Print=42]="Print",t[t.Execute=43]="Execute",t[t.Insert=45]="Insert",t[t.Delete=46]="Delete",t[t.Help=47]="Help",t[t.Num0=48]="Num0",t[t.Num1=49]="Num1",t[t.Num2=50]="Num2",t[t.Num3=51]="Num3",t[t.Num4=52]="Num4",t[t.Num5=53]="Num5",t[t.Num6=54]="Num6",t[t.Num7=55]="Num7",t[t.Num8=56]="Num8",t[t.Num9=57]="Num9",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.KP0=96]="KP0",t[t.KP1=97]="KP1",t[t.KP2=98]="KP2",t[t.KP3=99]="KP3",t[t.KP4=100]="KP4",t[t.KP5=101]="KP5",t[t.KP6=102]="KP6",t[t.KP7=103]="KP7",t[t.KP8=104]="KP8",t[t.KP9=105]="KP9",t[t.KPMultiply=106]="KPMultiply",t[t.KPAdd=107]="KPAdd",t[t.KPSeparator=108]="KPSeparator",t[t.KPSubtract=109]="KPSubtract",t[t.KPDecimal=110]="KPDecimal",t[t.KPDivide=111]="KPDivide",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.F13=124]="F13",t[t.F14=125]="F14",t[t.F15=126]="F15",t[t.F16=127]="F16",t[t.F17=128]="F17",t[t.F18=129]="F18",t[t.F19=130]="F19",t[t.F20=131]="F20",t[t.F21=132]="F21",t[t.F22=133]="F22",t[t.F23=134]="F23",t[t.F24=135]="F24",t[t.NumLock=136]="NumLock",t[t.ScrollLock=137]="ScrollLock",t[t.Mouse0=256]="Mouse0",t[t.Mouse1=257]="Mouse1",t[t.Mouse2=258]="Mouse2",t[t.Mouse3=259]="Mouse3",t[t.Mouse4=260]="Mouse4",t[t.Mouse5=261]="Mouse5",t[t.Mouse6=262]="Mouse6"}(a=e.Keys||(e.Keys={}))},function(t,e,n){"use strict";function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),r(n(48)),r(n(49)),r(n(50))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(2),i=n(83),s=n(97),o=n(24);!function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(33));const a={img:s.TextureImporter,fbx:i.FBXImporter};function u(t,e=r.GlobalContext()){const n={};for(const r in a)n[r]=n=>a[r].import(t,n,e);return n}e.AssetsImporter={importers:a,url:async(t,e=r.GlobalContext())=>u(await fetch(t).then(t=>t.arrayBuffer()),e),blob:async(t,e=r.GlobalContext())=>u(await o.readBlob(t),e),buffer:async(t,e=r.GlobalContext())=>u(t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(33),i=n(2),s=n(6),o=n(7),a=n(42),u=n(1),c=n(21),l=n(3),h=n(84),d=n(95);function f(t,e=i.GlobalContext()){const n=new r.AssetsPack,s=new Map,h=function(t){return e=>{const n=new c.Mesh(t.gl);return n.verts=e.verts.map(t=>u.vec3.from(t)),n.normals=e.normals.map(t=>u.vec3.from(t)),n.uvs=e.uv0.map(t=>l.vec2.from(t)),n.triangles=e.triangles,n.update(),n}}(e);for(const r of t.materials){const t=new e.assets.types.DefaultLit(e.gl);t.name=r.name,t.color=v(r,"DiffuseColor",t.color),t.emission=v(r,"Emissive",t.emission),t.specular=v(r,"Specular",t.specular),t.emission.mul(o.vec4(p(r,"EmissiveFactor",1))),s.set(r.id,t),n.add(t.name,t)}for(const r of t.models){const t=new a.RenderObject(e);t.name=r.name,t.localPosition=u.vec3.from(r.transform.localPosition),t.localRotation=r.transform.localRotation,t.localScaling=u.vec3.from(r.transform.localScaling),t.meshes=r.meshes.map(h),t.meshes.forEach((e,r)=>n.add(`${t.name}_${r}`,e)),t.materials=r.meshes.map(t=>{var n;return null!=(n=s.get(t.material.id))?n:e.assets.materials.default}),s.set(r.id,t)}const d=new a.Entity;d.name="FBX Model",n.add("FBX Model",d),n.setMain(d);for(const e of t.models)if(e.transform.parent){var f=s.get(e.id),m=s.get(e.transform.parent.model.id);f.parent=m}else s.get(e.id).parent=d;for(const t of s.values())n.add(t.name,t);return n}function v(t,e,n=s.Color.white){if(void 0===t[e]||t[e].length<3)return n;if(3===t[e].length){const[n,r,i]=t[e];return new s.Color(n,r,i)}const[r,i,o,a]=t[e];return new s.Color(r,i,o,a)}function p(t,e,n=0){return void 0===t[e]||isNaN(t[e])?n:t[e]}e.FBXImporter={async import(t,e,n=i.GlobalContext()){const r=h.parseFBX(t);return f(d.extractFBXAssets(r),n)}}},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(85),s=r(n(86));function o(t,e){const n=[];for(;;){const e=a(t);if(null===e)break;n.push(e)}if(e>0&&t.position!==e)throw new Error("Unexpectly end of nodes.");return n}function a(t){const e=t.readUInt32(),n=t.readUInt32(),r=t.readUInt32(),i=t.readUInt8();if(0===e&&0===n&&0===r&&0===i)return null;const s={name:t.readString(i),properties:new Array(n),nestedNodes:[]},a={Y:()=>t.readInt16(),C:()=>t.readBoolean(),I:()=>t.readInt32(),F:()=>t.readFloat32(),D:()=>t.readFloat64(),L:()=>t.readUInt64(),f:()=>new Float32Array(u(t,4)),d:()=>new Float64Array(u(t,8)),l:()=>new BigInt64Array(u(t,8)),i:()=>new Int32Array(u(t,4)),b:()=>Array.from(new Uint8Array(u(t,1))).map(t=>1===t),S:()=>t.readString(t.readUInt32()),R:()=>t.readBytes(t.readUInt32())},c=t.position;for(let e=0;e<n;e++){const n=a[t.readChar()]();s.properties[e]=n}if(t.position!==c+r)throw new Error("Unexpectly end of property list.");return t.position<e&&(s.nestedNodes=o(t,e)),s}function u(t,e){const n=t.readUInt32(),r=t.readUInt32(),i=t.readUInt32();if(0===r)return t.readSlice(e*n);{const e=t.readSlice(i);return s.default.inflate(new Uint8Array(e)).buffer}}e.parseFBX=function(t){const e={version:0,nodes:[]},n=new i.DataReader(t);if("Kaydara FBX Binary  "===n.readString(20)){n.position=23;const t=n.readUInt32();e.version=t,n.position=27,e.nodes=o(n,0)}return e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(24);e.DataReader=class{constructor(t,e=0){this.buffer=t,this.dataView=new DataView(t),this.position=e}readSlice(t){const e=this.buffer.slice(this.position,this.position+t);return this.position+=t,e}readUInt8(){const t=this.dataView.getUint8(this.position);return this.position+=1,t}readInt8(){const t=this.dataView.getInt8(this.position);return this.position+=1,t}readUInt16(){const t=this.dataView.getUint16(this.position,!0);return this.position+=2,t}readInt16(){const t=this.dataView.getInt16(this.position,!0);return this.position+=2,t}readUInt32(){const t=this.dataView.getUint32(this.position,!0);return this.position+=4,t}readInt32(){const t=this.dataView.getInt32(this.position,!0);return this.position+=4,t}readUInt64(){const t=this.dataView.getBigUint64(this.position,!0);return this.position+=8,t}readInt64(){const t=this.dataView.getBigInt64(this.position,!0);return this.position+=8,t}readBoolean(){return 1===this.readUInt8()}readFloat32(){const t=this.dataView.getFloat32(this.position,!0);return this.position+=4,t}readFloat64(){const t=this.dataView.getFloat64(this.position,!0);return this.position+=8,t}readChar(){const t=this.readUInt8();return String.fromCharCode(t)}readString(t){const e=r.readString(this.buffer,this.position,t);return this.position+=t,e}readBytes(t){const e=new Uint8Array(this.buffer,this.position,t);return this.position+=t,e}}},function(t,e,n){"use strict";var r={};(0,n(8).assign)(r,n(87),n(90),n(56)),t.exports=r},function(t,e,n){"use strict";var r=n(88),i=n(8),s=n(54),o=n(34),a=n(55),u=Object.prototype.toString;function c(t){if(!(this instanceof c))return new c(t);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==n)throw new Error(o[n]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){var l;if(l="string"==typeof e.dictionary?s.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(n=r.deflateSetDictionary(this.strm,l)))throw new Error(o[n]);this._dict_set=!0}}function l(t,e){var n=new c(e);if(n.push(t,!0),n.err)throw n.msg||o[n.err];return n.result}c.prototype.push=function(t,e){var n,o,a=this.strm,c=this.options.chunkSize;if(this.ended)return!1;o=e===~~e?e:!0===e?4:0,"string"==typeof t?a.input=s.string2buf(t):"[object ArrayBuffer]"===u.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new i.Buf8(c),a.next_out=0,a.avail_out=c),1!==(n=r.deflate(a,o))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(s.buf2binstring(i.shrinkBuf(a.output,a.next_out))):this.onData(i.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===o?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==o||(this.onEnd(0),a.avail_out=0,!0)},c.prototype.onData=function(t){this.chunks.push(t)},c.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=c,e.deflate=l,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,l(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,l(t,e)}},function(t,e,n){"use strict";var r,i=n(8),s=n(89),o=n(52),a=n(53),u=n(34);function c(t,e){return t.msg=u[e],e}function l(t){return(t<<1)-(t>4?9:0)}function h(t){for(var e=t.length;--e>=0;)t[e]=0}function d(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(i.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function f(t,e){s._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,d(t.strm)}function v(t,e){t.pending_buf[t.pending++]=e}function p(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function m(t,e){var n,r,i=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match,u=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,c=t.window,l=t.w_mask,h=t.prev,d=t.strstart+258,f=c[s+o-1],v=c[s+o];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do{if(c[(n=e)+o]===v&&c[n+o-1]===f&&c[n]===c[s]&&c[++n]===c[s+1]){s+=2,n++;do{}while(c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&s<d);if(r=258-(d-s),s=d-258,r>o){if(t.match_start=e,o=r,r>=a)break;f=c[s+o-1],v=c[s+o]}}}while((e=h[e&l])>u&&0!=--i);return o<=t.lookahead?o:t.lookahead}function g(t){var e,n,r,s,u,c,l,h,d,f,v=t.w_size;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=v+(v-262)){i.arraySet(t.window,t.window,v,v,0),t.match_start-=v,t.strstart-=v,t.block_start-=v,e=n=t.hash_size;do{r=t.head[--e],t.head[e]=r>=v?r-v:0}while(--n);e=n=v;do{r=t.prev[--e],t.prev[e]=r>=v?r-v:0}while(--n);s+=v}if(0===t.strm.avail_in)break;if(c=t.strm,l=t.window,h=t.strstart+t.lookahead,d=s,f=void 0,(f=c.avail_in)>d&&(f=d),n=0===f?0:(c.avail_in-=f,i.arraySet(l,c.input,c.next_in,f,h),1===c.state.wrap?c.adler=o(c.adler,l,f,h):2===c.state.wrap&&(c.adler=a(c.adler,l,f,h)),c.next_in+=f,c.total_in+=f,f),t.lookahead+=n,t.lookahead+t.insert>=3)for(u=t.strstart-t.insert,t.ins_h=t.window[u],t.ins_h=(t.ins_h<<t.hash_shift^t.window[u+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[u+3-1])&t.hash_mask,t.prev[u&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=u,u++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)}function _(t,e){for(var n,r;;){if(t.lookahead<262){if(g(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-262&&(t.match_length=m(t,n)),t.match_length>=3)if(r=s._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(f(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(f(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(f(t,!1),0===t.strm.avail_out)?1:2}function y(t,e){for(var n,r,i;;){if(t.lookahead<262){if(g(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-262&&(t.match_length=m(t,n),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,r=s._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(f(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((r=s._tr_tally(t,0,t.window[t.strstart-1]))&&f(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=s._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(f(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(f(t,!1),0===t.strm.avail_out)?1:2}function b(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}function w(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function M(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=0,s._tr_init(e),0):c(t,-2)}function x(t){var e,n=M(t);return 0===n&&((e=t.state).window_size=2*e.w_size,h(e.head),e.max_lazy_match=r[e.level].max_lazy,e.good_match=r[e.level].good_length,e.nice_match=r[e.level].nice_length,e.max_chain_length=r[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),n}function T(t,e,n,r,s,o){if(!t)return-2;var a=1;if(-1===e&&(e=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),s<1||s>9||8!==n||r<8||r>15||e<0||e>9||o<0||o>4)return c(t,-2);8===r&&(r=9);var u=new w;return t.state=u,u.strm=t,u.wrap=a,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=s+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new i.Buf8(2*u.w_size),u.head=new i.Buf16(u.hash_size),u.prev=new i.Buf16(u.w_size),u.lit_bufsize=1<<s+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new i.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=e,u.strategy=o,u.method=n,x(t)}r=[new b(0,0,0,0,(function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(g(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,f(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-262&&(f(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(f(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(f(t,!1),t.strm.avail_out),1)})),new b(4,4,8,4,_),new b(4,5,16,8,_),new b(4,6,32,32,_),new b(4,4,16,16,y),new b(8,16,32,32,y),new b(8,16,128,128,y),new b(8,32,128,256,y),new b(32,128,258,1024,y),new b(32,258,258,4096,y)],e.deflateInit=function(t,e){return T(t,e,8,15,8,0)},e.deflateInit2=T,e.deflateReset=x,e.deflateResetKeep=M,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?-2:(t.state.gzhead=e,0):-2},e.deflate=function(t,e){var n,i,o,u;if(!t||!t.state||e>5||e<0)return t?c(t,-2):-2;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||666===i.status&&4!==e)return c(t,0===t.avail_out?-5:-2);if(i.strm=t,n=i.last_flush,i.last_flush=e,42===i.status)if(2===i.wrap)t.adler=0,v(i,31),v(i,139),v(i,8),i.gzhead?(v(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),v(i,255&i.gzhead.time),v(i,i.gzhead.time>>8&255),v(i,i.gzhead.time>>16&255),v(i,i.gzhead.time>>24&255),v(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),v(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(v(i,255&i.gzhead.extra.length),v(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=a(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(v(i,0),v(i,0),v(i,0),v(i,0),v(i,0),v(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),v(i,3),i.status=113);else{var m=8+(i.w_bits-8<<4)<<8;m|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(m|=32),m+=31-m%31,i.status=113,p(i,m),0!==i.strstart&&(p(i,t.adler>>>16),p(i,65535&t.adler)),t.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(t.adler=a(t.adler,i.pending_buf,i.pending-o,o)),d(t),o=i.pending,i.pending!==i.pending_buf_size));)v(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(t.adler=a(t.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(t.adler=a(t.adler,i.pending_buf,i.pending-o,o)),d(t),o=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,v(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>o&&(t.adler=a(t.adler,i.pending_buf,i.pending-o,o)),0===u&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(t.adler=a(t.adler,i.pending_buf,i.pending-o,o)),d(t),o=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,v(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>o&&(t.adler=a(t.adler,i.pending_buf,i.pending-o,o)),0===u&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&d(t),i.pending+2<=i.pending_buf_size&&(v(i,255&t.adler),v(i,t.adler>>8&255),t.adler=0,i.status=113)):i.status=113),0!==i.pending){if(d(t),0===t.avail_out)return i.last_flush=-1,0}else if(0===t.avail_in&&l(e)<=l(n)&&4!==e)return c(t,-5);if(666===i.status&&0!==t.avail_in)return c(t,-5);if(0!==t.avail_in||0!==i.lookahead||0!==e&&666!==i.status){var _=2===i.strategy?function(t,e){for(var n;;){if(0===t.lookahead&&(g(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,n=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(f(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(f(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(f(t,!1),0===t.strm.avail_out)?1:2}(i,e):3===i.strategy?function(t,e){for(var n,r,i,o,a=t.window;;){if(t.lookahead<=258){if(g(t),t.lookahead<=258&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=a[i=t.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i]){o=t.strstart+258;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<o);t.match_length=258-(o-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=s._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(f(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(f(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(f(t,!1),0===t.strm.avail_out)?1:2}(i,e):r[i.level].func(i,e);if(3!==_&&4!==_||(i.status=666),1===_||3===_)return 0===t.avail_out&&(i.last_flush=-1),0;if(2===_&&(1===e?s._tr_align(i):5!==e&&(s._tr_stored_block(i,0,0,!1),3===e&&(h(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),d(t),0===t.avail_out))return i.last_flush=-1,0}return 4!==e?0:i.wrap<=0?1:(2===i.wrap?(v(i,255&t.adler),v(i,t.adler>>8&255),v(i,t.adler>>16&255),v(i,t.adler>>24&255),v(i,255&t.total_in),v(i,t.total_in>>8&255),v(i,t.total_in>>16&255),v(i,t.total_in>>24&255)):(p(i,t.adler>>>16),p(i,65535&t.adler)),d(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},e.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&113!==e&&666!==e?c(t,-2):(t.state=null,113===e?c(t,-3):0):-2},e.deflateSetDictionary=function(t,e){var n,r,s,a,u,c,l,d,f=e.length;if(!t||!t.state)return-2;if(2===(a=(n=t.state).wrap)||1===a&&42!==n.status||n.lookahead)return-2;for(1===a&&(t.adler=o(t.adler,e,f,0)),n.wrap=0,f>=n.w_size&&(0===a&&(h(n.head),n.strstart=0,n.block_start=0,n.insert=0),d=new i.Buf8(n.w_size),i.arraySet(d,e,f-n.w_size,n.w_size,0),e=d,f=n.w_size),u=t.avail_in,c=t.next_in,l=t.input,t.avail_in=f,t.next_in=0,t.input=e,g(n);n.lookahead>=3;){r=n.strstart,s=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--s);n.strstart=r,n.lookahead=2,g(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=c,t.input=l,t.avail_in=u,n.wrap=a,0},e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e,n){"use strict";var r=n(8);function i(t){for(var e=t.length;--e>=0;)t[e]=0}var s=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=new Array(576);i(c);var l=new Array(60);i(l);var h=new Array(512);i(h);var d=new Array(256);i(d);var f=new Array(29);i(f);var v,p,m,g=new Array(30);function _(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}function y(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function b(t){return t<256?h[t]:h[256+(t>>>7)]}function w(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function M(t,e,n){t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,w(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function x(t,e,n){M(t,n[2*e],n[2*e+1])}function T(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function R(t,e,n){var r,i,s=new Array(16),o=0;for(r=1;r<=15;r++)s[r]=o=o+n[r-1]<<1;for(i=0;i<=e;i++){var a=t[2*i+1];0!==a&&(t[2*i]=T(s[a]++,a))}}function k(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function E(t){t.bi_valid>8?w(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function P(t,e,n,r){var i=2*e,s=2*n;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]}function A(t,e,n){for(var r=t.heap[n],i=n<<1;i<=t.heap_len&&(i<t.heap_len&&P(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!P(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r}function S(t,e,n){var r,i,a,u,c=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*c]<<8|t.pending_buf[t.d_buf+2*c+1],i=t.pending_buf[t.l_buf+c],c++,0===r?x(t,i,e):(x(t,(a=d[i])+256+1,e),0!==(u=s[a])&&M(t,i-=f[a],u),x(t,a=b(--r),n),0!==(u=o[a])&&M(t,r-=g[a],u))}while(c<t.last_lit);x(t,256,e)}function C(t,e){var n,r,i,s=e.dyn_tree,o=e.stat_desc.static_tree,a=e.stat_desc.has_stree,u=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<u;n++)0!==s[2*n]?(t.heap[++t.heap_len]=c=n,t.depth[n]=0):s[2*n+1]=0;for(;t.heap_len<2;)s[2*(i=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[i]=0,t.opt_len--,a&&(t.static_len-=o[2*i+1]);for(e.max_code=c,n=t.heap_len>>1;n>=1;n--)A(t,s,n);i=u;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],A(t,s,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,s[2*i]=s[2*n]+s[2*r],t.depth[i]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,s[2*n+1]=s[2*r+1]=i,t.heap[1]=i++,A(t,s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,r,i,s,o,a,u=e.dyn_tree,c=e.max_code,l=e.stat_desc.static_tree,h=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,v=e.stat_desc.max_length,p=0;for(s=0;s<=15;s++)t.bl_count[s]=0;for(u[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<573;n++)(s=u[2*u[2*(r=t.heap[n])+1]+1]+1)>v&&(s=v,p++),u[2*r+1]=s,r>c||(t.bl_count[s]++,o=0,r>=f&&(o=d[r-f]),a=u[2*r],t.opt_len+=a*(s+o),h&&(t.static_len+=a*(l[2*r+1]+o)));if(0!==p){do{for(s=v-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[v]--,p-=2}while(p>0);for(s=v;0!==s;s--)for(r=t.bl_count[s];0!==r;)(i=t.heap[--n])>c||(u[2*i+1]!==s&&(t.opt_len+=(s-u[2*i+1])*u[2*i],u[2*i+1]=s),r--)}}(t,e),R(s,c,t.bl_count)}function B(t,e,n){var r,i,s=-1,o=e[1],a=0,u=7,c=4;for(0===o&&(u=138,c=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=e[2*(r+1)+1],++a<u&&i===o||(a<c?t.bl_tree[2*i]+=a:0!==i?(i!==s&&t.bl_tree[2*i]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,s=i,0===o?(u=138,c=3):i===o?(u=6,c=3):(u=7,c=4))}function D(t,e,n){var r,i,s=-1,o=e[1],a=0,u=7,c=4;for(0===o&&(u=138,c=3),r=0;r<=n;r++)if(i=o,o=e[2*(r+1)+1],!(++a<u&&i===o)){if(a<c)do{x(t,i,t.bl_tree)}while(0!=--a);else 0!==i?(i!==s&&(x(t,i,t.bl_tree),a--),x(t,16,t.bl_tree),M(t,a-3,2)):a<=10?(x(t,17,t.bl_tree),M(t,a-3,3)):(x(t,18,t.bl_tree),M(t,a-11,7));a=0,s=i,0===o?(u=138,c=3):i===o?(u=6,c=3):(u=7,c=4)}}i(g);var I=!1;function F(t,e,n,i){M(t,0+(i?1:0),3),function(t,e,n,i){E(t),i&&(w(t,n),w(t,~n)),r.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}e._tr_init=function(t){I||(!function(){var t,e,n,r,i,u=new Array(16);for(n=0,r=0;r<28;r++)for(f[r]=n,t=0;t<1<<s[r];t++)d[n++]=r;for(d[n-1]=r,i=0,r=0;r<16;r++)for(g[r]=i,t=0;t<1<<o[r];t++)h[i++]=r;for(i>>=7;r<30;r++)for(g[r]=i<<7,t=0;t<1<<o[r]-7;t++)h[256+i++]=r;for(e=0;e<=15;e++)u[e]=0;for(t=0;t<=143;)c[2*t+1]=8,t++,u[8]++;for(;t<=255;)c[2*t+1]=9,t++,u[9]++;for(;t<=279;)c[2*t+1]=7,t++,u[7]++;for(;t<=287;)c[2*t+1]=8,t++,u[8]++;for(R(c,287,u),t=0;t<30;t++)l[2*t+1]=5,l[2*t]=T(t,5);v=new _(c,s,257,286,15),p=new _(l,o,0,30,15),m=new _(new Array(0),a,0,19,7)}(),I=!0),t.l_desc=new y(t.dyn_ltree,v),t.d_desc=new y(t.dyn_dtree,p),t.bl_desc=new y(t.bl_tree,m),t.bi_buf=0,t.bi_valid=0,k(t)},e._tr_stored_block=F,e._tr_flush_block=function(t,e,n,r){var i,s,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),C(t,t.l_desc),C(t,t.d_desc),o=function(t){var e;for(B(t,t.dyn_ltree,t.l_desc.max_code),B(t,t.dyn_dtree,t.d_desc.max_code),C(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*u[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),i=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=i&&(i=s)):i=s=n+5,n+4<=i&&-1!==e?F(t,e,n,r):4===t.strategy||s===i?(M(t,2+(r?1:0),3),S(t,c,l)):(M(t,4+(r?1:0),3),function(t,e,n,r){var i;for(M(t,e-257,5),M(t,n-1,5),M(t,r-4,4),i=0;i<r;i++)M(t,t.bl_tree[2*u[i]+1],3);D(t,t.dyn_ltree,e-1),D(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),S(t,t.dyn_ltree,t.dyn_dtree)),k(t),r&&E(t)},e._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(d[n]+256+1)]++,t.dyn_dtree[2*b(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){M(t,2,3),x(t,256,c),function(t){16===t.bi_valid?(w(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,e,n){"use strict";var r=n(91),i=n(8),s=n(54),o=n(56),a=n(34),u=n(55),c=n(94),l=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,e.windowBits);if(n!==o.Z_OK)throw new Error(a[n]);if(this.header=new c,r.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=s.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=r.inflateSetDictionary(this.strm,e.dictionary))!==o.Z_OK))throw new Error(a[n])}function d(t,e){var n=new h(e);if(n.push(t,!0),n.err)throw n.msg||a[n.err];return n.result}h.prototype.push=function(t,e){var n,a,u,c,h,d=this.strm,f=this.options.chunkSize,v=this.options.dictionary,p=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof t?d.input=s.binstring2buf(t):"[object ArrayBuffer]"===l.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(n=r.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&v&&(n=r.inflateSetDictionary(this.strm,v)),n===o.Z_BUF_ERROR&&!0===p&&(n=o.Z_OK,p=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==o.Z_STREAM_END&&(0!==d.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(u=s.utf8border(d.output,d.next_out),c=d.next_out-u,h=s.buf2string(d.output,u),d.next_out=c,d.avail_out=f-c,c&&i.arraySet(d.output,d.output,u,c,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(p=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=h,e.inflate=d,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},e.ungzip=d},function(t,e,n){"use strict";var r=n(8),i=n(52),s=n(53),o=n(92),a=n(93);function u(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function l(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(852),e.distcode=e.distdyn=new r.Buf32(592),e.sane=1,e.back=-1,0):-2}function h(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,l(t)):-2}function d(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?-2:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,h(t))):-2}function f(t,e){var n,r;return t?(r=new c,t.state=r,r.window=null,0!==(n=d(t,e))&&(t.state=null),n):-2}var v,p,m=!0;function g(t){if(m){var e;for(v=new r.Buf32(512),p=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(a(1,t.lens,0,288,v,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;a(2,t.lens,0,32,p,0,t.work,{bits:5}),m=!1}t.lencode=v,t.lenbits=9,t.distcode=p,t.distbits=5}function _(t,e,n,i){var s,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,e,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((s=o.wsize-o.wnext)>i&&(s=i),r.arraySet(o.window,e,n-i,s,o.wnext),(i-=s)?(r.arraySet(o.window,e,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}e.inflateReset=h,e.inflateReset2=d,e.inflateResetKeep=l,e.inflateInit=function(t){return f(t,15)},e.inflateInit2=f,e.inflate=function(t,e){var n,c,l,h,d,f,v,p,m,y,b,w,M,x,T,R,k,E,P,A,S,C,B,D,I=0,F=new r.Buf8(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return-2;12===(n=t.state).mode&&(n.mode=13),d=t.next_out,l=t.output,v=t.avail_out,h=t.next_in,c=t.input,f=t.avail_in,p=n.hold,m=n.bits,y=f,b=v,C=0;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;m<16;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}if(2&n.wrap&&35615===p){n.check=0,F[0]=255&p,F[1]=p>>>8&255,n.check=s(n.check,F,2,0),p=0,m=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&p)<<8)+(p>>8))%31){t.msg="incorrect header check",n.mode=30;break}if(8!=(15&p)){t.msg="unknown compression method",n.mode=30;break}if(m-=4,S=8+(15&(p>>>=4)),0===n.wbits)n.wbits=S;else if(S>n.wbits){t.msg="invalid window size",n.mode=30;break}n.dmax=1<<S,t.adler=n.check=1,n.mode=512&p?10:12,p=0,m=0;break;case 2:for(;m<16;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}if(n.flags=p,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=p>>8&1),512&n.flags&&(F[0]=255&p,F[1]=p>>>8&255,n.check=s(n.check,F,2,0)),p=0,m=0,n.mode=3;case 3:for(;m<32;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}n.head&&(n.head.time=p),512&n.flags&&(F[0]=255&p,F[1]=p>>>8&255,F[2]=p>>>16&255,F[3]=p>>>24&255,n.check=s(n.check,F,4,0)),p=0,m=0,n.mode=4;case 4:for(;m<16;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}n.head&&(n.head.xflags=255&p,n.head.os=p>>8),512&n.flags&&(F[0]=255&p,F[1]=p>>>8&255,n.check=s(n.check,F,2,0)),p=0,m=0,n.mode=5;case 5:if(1024&n.flags){for(;m<16;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}n.length=p,n.head&&(n.head.extra_len=p),512&n.flags&&(F[0]=255&p,F[1]=p>>>8&255,n.check=s(n.check,F,2,0)),p=0,m=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((w=n.length)>f&&(w=f),w&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,c,h,w,S)),512&n.flags&&(n.check=s(n.check,c,w,h)),f-=w,h+=w,n.length-=w),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===f)break t;w=0;do{S=c[h+w++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S))}while(S&&w<f);if(512&n.flags&&(n.check=s(n.check,c,w,h)),f-=w,h+=w,S)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===f)break t;w=0;do{S=c[h+w++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S))}while(S&&w<f);if(512&n.flags&&(n.check=s(n.check,c,w,h)),f-=w,h+=w,S)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;m<16;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}if(p!==(65535&n.check)){t.msg="header crc mismatch",n.mode=30;break}p=0,m=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=12;break;case 10:for(;m<32;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}t.adler=n.check=u(p),p=0,m=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=d,t.avail_out=v,t.next_in=h,t.avail_in=f,n.hold=p,n.bits=m,2;t.adler=n.check=1,n.mode=12;case 12:if(5===e||6===e)break t;case 13:if(n.last){p>>>=7&m,m-=7&m,n.mode=27;break}for(;m<3;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}switch(n.last=1&p,m-=1,3&(p>>>=1)){case 0:n.mode=14;break;case 1:if(g(n),n.mode=20,6===e){p>>>=2,m-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=30}p>>>=2,m-=2;break;case 14:for(p>>>=7&m,m-=7&m;m<32;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}if((65535&p)!=(p>>>16^65535)){t.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&p,p=0,m=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(w=n.length){if(w>f&&(w=f),w>v&&(w=v),0===w)break t;r.arraySet(l,c,h,w,d),f-=w,h+=w,v-=w,d+=w,n.length-=w;break}n.mode=12;break;case 17:for(;m<14;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}if(n.nlen=257+(31&p),p>>>=5,m-=5,n.ndist=1+(31&p),p>>>=5,m-=5,n.ncode=4+(15&p),p>>>=4,m-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;m<3;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}n.lens[L[n.have++]]=7&p,p>>>=3,m-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,B={bits:n.lenbits},C=a(0,n.lens,0,19,n.lencode,0,n.work,B),n.lenbits=B.bits,C){t.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;R=(I=n.lencode[p&(1<<n.lenbits)-1])>>>16&255,k=65535&I,!((T=I>>>24)<=m);){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}if(k<16)p>>>=T,m-=T,n.lens[n.have++]=k;else{if(16===k){for(D=T+2;m<D;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}if(p>>>=T,m-=T,0===n.have){t.msg="invalid bit length repeat",n.mode=30;break}S=n.lens[n.have-1],w=3+(3&p),p>>>=2,m-=2}else if(17===k){for(D=T+3;m<D;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}m-=T,S=0,w=3+(7&(p>>>=T)),p>>>=3,m-=3}else{for(D=T+7;m<D;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}m-=T,S=0,w=11+(127&(p>>>=T)),p>>>=7,m-=7}if(n.have+w>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=30;break}for(;w--;)n.lens[n.have++]=S}}if(30===n.mode)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,B={bits:n.lenbits},C=a(1,n.lens,0,n.nlen,n.lencode,0,n.work,B),n.lenbits=B.bits,C){t.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,B={bits:n.distbits},C=a(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,B),n.distbits=B.bits,C){t.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(f>=6&&v>=258){t.next_out=d,t.avail_out=v,t.next_in=h,t.avail_in=f,n.hold=p,n.bits=m,o(t,b),d=t.next_out,l=t.output,v=t.avail_out,h=t.next_in,c=t.input,f=t.avail_in,p=n.hold,m=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;R=(I=n.lencode[p&(1<<n.lenbits)-1])>>>16&255,k=65535&I,!((T=I>>>24)<=m);){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}if(R&&0==(240&R)){for(E=T,P=R,A=k;R=(I=n.lencode[A+((p&(1<<E+P)-1)>>E)])>>>16&255,k=65535&I,!(E+(T=I>>>24)<=m);){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}p>>>=E,m-=E,n.back+=E}if(p>>>=T,m-=T,n.back+=T,n.length=k,0===R){n.mode=26;break}if(32&R){n.back=-1,n.mode=12;break}if(64&R){t.msg="invalid literal/length code",n.mode=30;break}n.extra=15&R,n.mode=22;case 22:if(n.extra){for(D=n.extra;m<D;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}n.length+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;R=(I=n.distcode[p&(1<<n.distbits)-1])>>>16&255,k=65535&I,!((T=I>>>24)<=m);){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}if(0==(240&R)){for(E=T,P=R,A=k;R=(I=n.distcode[A+((p&(1<<E+P)-1)>>E)])>>>16&255,k=65535&I,!(E+(T=I>>>24)<=m);){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}p>>>=E,m-=E,n.back+=E}if(p>>>=T,m-=T,n.back+=T,64&R){t.msg="invalid distance code",n.mode=30;break}n.offset=k,n.extra=15&R,n.mode=24;case 24:if(n.extra){for(D=n.extra;m<D;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}n.offset+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===v)break t;if(w=b-v,n.offset>w){if((w=n.offset-w)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=30;break}w>n.wnext?(w-=n.wnext,M=n.wsize-w):M=n.wnext-w,w>n.length&&(w=n.length),x=n.window}else x=l,M=d-n.offset,w=n.length;w>v&&(w=v),v-=w,n.length-=w;do{l[d++]=x[M++]}while(--w);0===n.length&&(n.mode=21);break;case 26:if(0===v)break t;l[d++]=n.length,v--,n.mode=21;break;case 27:if(n.wrap){for(;m<32;){if(0===f)break t;f--,p|=c[h++]<<m,m+=8}if(b-=v,t.total_out+=b,n.total+=b,b&&(t.adler=n.check=n.flags?s(n.check,l,b,d-b):i(n.check,l,b,d-b)),b=v,(n.flags?p:u(p))!==n.check){t.msg="incorrect data check",n.mode=30;break}p=0,m=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;m<32;){if(0===f)break t;f--,p+=c[h++]<<m,m+=8}if(p!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=30;break}p=0,m=0}n.mode=29;case 29:C=1;break t;case 30:C=-3;break t;case 31:return-4;case 32:default:return-2}return t.next_out=d,t.avail_out=v,t.next_in=h,t.avail_in=f,n.hold=p,n.bits=m,(n.wsize||b!==t.avail_out&&n.mode<30&&(n.mode<27||4!==e))&&_(t,t.output,t.next_out,b-t.avail_out)?(n.mode=31,-4):(y-=t.avail_in,b-=t.avail_out,t.total_in+=y,t.total_out+=b,n.total+=b,n.wrap&&b&&(t.adler=n.check=n.flags?s(n.check,l,b,t.next_out-b):i(n.check,l,b,t.next_out-b)),t.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===y&&0===b||4===e)&&0===C&&(C=-5),C)},e.inflateEnd=function(t){if(!t||!t.state)return-2;var e=t.state;return e.window&&(e.window=null),t.state=null,0},e.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?-2:(n.head=e,e.done=!1,0):-2},e.inflateSetDictionary=function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?-2:11===n.mode&&i(1,e,r,0)!==n.check?-3:_(t,e,r,r)?(n.mode=31,-4):(n.havedict=1,0):-2},e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e,n){"use strict";t.exports=function(t,e){var n,r,i,s,o,a,u,c,l,h,d,f,v,p,m,g,_,y,b,w,M,x,T,R,k;n=t.state,r=t.next_in,R=t.input,i=r+(t.avail_in-5),s=t.next_out,k=t.output,o=s-(e-t.avail_out),a=s+(t.avail_out-257),u=n.dmax,c=n.wsize,l=n.whave,h=n.wnext,d=n.window,f=n.hold,v=n.bits,p=n.lencode,m=n.distcode,g=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;t:do{v<15&&(f+=R[r++]<<v,v+=8,f+=R[r++]<<v,v+=8),y=p[f&g];e:for(;;){if(f>>>=b=y>>>24,v-=b,0===(b=y>>>16&255))k[s++]=65535&y;else{if(!(16&b)){if(0==(64&b)){y=p[(65535&y)+(f&(1<<b)-1)];continue e}if(32&b){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}w=65535&y,(b&=15)&&(v<b&&(f+=R[r++]<<v,v+=8),w+=f&(1<<b)-1,f>>>=b,v-=b),v<15&&(f+=R[r++]<<v,v+=8,f+=R[r++]<<v,v+=8),y=m[f&_];n:for(;;){if(f>>>=b=y>>>24,v-=b,!(16&(b=y>>>16&255))){if(0==(64&b)){y=m[(65535&y)+(f&(1<<b)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(M=65535&y,v<(b&=15)&&(f+=R[r++]<<v,(v+=8)<b&&(f+=R[r++]<<v,v+=8)),(M+=f&(1<<b)-1)>u){t.msg="invalid distance too far back",n.mode=30;break t}if(f>>>=b,v-=b,M>(b=s-o)){if((b=M-b)>l&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(x=0,T=d,0===h){if(x+=c-b,b<w){w-=b;do{k[s++]=d[x++]}while(--b);x=s-M,T=k}}else if(h<b){if(x+=c+h-b,(b-=h)<w){w-=b;do{k[s++]=d[x++]}while(--b);if(x=0,h<w){w-=b=h;do{k[s++]=d[x++]}while(--b);x=s-M,T=k}}}else if(x+=h-b,b<w){w-=b;do{k[s++]=d[x++]}while(--b);x=s-M,T=k}for(;w>2;)k[s++]=T[x++],k[s++]=T[x++],k[s++]=T[x++],w-=3;w&&(k[s++]=T[x++],w>1&&(k[s++]=T[x++]))}else{x=s-M;do{k[s++]=k[x++],k[s++]=k[x++],k[s++]=k[x++],w-=3}while(w>2);w&&(k[s++]=k[x++],w>1&&(k[s++]=k[x++]))}break}}break}}while(r<i&&s<a);r-=w=v>>3,f&=(1<<(v-=w<<3))-1,t.next_in=r,t.next_out=s,t.avail_in=r<i?i-r+5:5-(r-i),t.avail_out=s<a?a-s+257:257-(s-a),n.hold=f,n.bits=v}},function(t,e,n){"use strict";var r=n(8),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,n,u,c,l,h,d){var f,v,p,m,g,_,y,b,w,M=d.bits,x=0,T=0,R=0,k=0,E=0,P=0,A=0,S=0,C=0,B=0,D=null,I=0,F=new r.Buf16(16),L=new r.Buf16(16),O=null,N=0;for(x=0;x<=15;x++)F[x]=0;for(T=0;T<u;T++)F[e[n+T]]++;for(E=M,k=15;k>=1&&0===F[k];k--);if(E>k&&(E=k),0===k)return c[l++]=20971520,c[l++]=20971520,d.bits=1,0;for(R=1;R<k&&0===F[R];R++);for(E<R&&(E=R),S=1,x=1;x<=15;x++)if(S<<=1,(S-=F[x])<0)return-1;if(S>0&&(0===t||1!==k))return-1;for(L[1]=0,x=1;x<15;x++)L[x+1]=L[x]+F[x];for(T=0;T<u;T++)0!==e[n+T]&&(h[L[e[n+T]]++]=T);if(0===t?(D=O=h,_=19):1===t?(D=i,I-=257,O=s,N-=257,_=256):(D=o,O=a,_=-1),B=0,T=0,x=R,g=l,P=E,A=0,p=-1,m=(C=1<<E)-1,1===t&&C>852||2===t&&C>592)return 1;for(;;){y=x-A,h[T]<_?(b=0,w=h[T]):h[T]>_?(b=O[N+h[T]],w=D[I+h[T]]):(b=96,w=0),f=1<<x-A,R=v=1<<P;do{c[g+(B>>A)+(v-=f)]=y<<24|b<<16|w|0}while(0!==v);for(f=1<<x-1;B&f;)f>>=1;if(0!==f?(B&=f-1,B+=f):B=0,T++,0==--F[x]){if(x===k)break;x=e[n+h[T]]}if(x>E&&(B&m)!==p){for(0===A&&(A=E),g+=R,S=1<<(P=x-A);P+A<k&&!((S-=F[P+A])<=0);)P++,S<<=1;if(C+=1<<P,1===t&&C>852||2===t&&C>592)return 1;c[p=B&m]=E<<24|P<<16|g-l|0}}return 0!==B&&(c[g+B]=x-A<<24|64<<16|0),d.bits=E,0}},function(t,e,n){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(96),i=n(16),s=n(5),o=n(24);function a(t){var e,n,s,o,a,u,c,l,h,d,f,v,p,m,g,_,y,b,w,M,x,T,R,k,E;const P={id:t.properties[0],name:t.properties[1].split("\0")[0],meshes:[],materials:[],transform:null};P.transform=new r.FBXTransform(P);const A=t.nestedNodes.find(t=>"Properties70"===t.name),S=null===(e=A)||void 0===e?void 0:e.nestedNodes.find(t=>"Lcl Translation"===t.properties[0]),C=null===(n=A)||void 0===n?void 0:n.nestedNodes.find(t=>"Lcl Rotation"===t.properties[0]),B=null===(s=A)||void 0===s?void 0:s.nestedNodes.find(t=>"Lcl Scaling"===t.properties[0]),D=null===(o=A)||void 0===o?void 0:o.nestedNodes.find(t=>"PreRotation"===t.properties[0]);return P.transform.localPosition=i.vec3.fromValues(null!=(u=null===(a=S)||void 0===a?void 0:a.properties[4])?u:0,null!=(l=null===(c=S)||void 0===c?void 0:c.properties[5])?l:0,null!=(d=null===(h=S)||void 0===h?void 0:h.properties[6])?d:0),P.transform.localRotation=i.quat.fromEuler(i.quat.create(),null!=(v=null===(f=C)||void 0===f?void 0:f.properties[4])?v:0,null!=(m=null===(p=C)||void 0===p?void 0:p.properties[5])?m:0,null!=(_=null===(g=C)||void 0===g?void 0:g.properties[6])?_:0),P.transform.localScaling=i.vec3.fromValues(null!=(b=null===(y=B)||void 0===y?void 0:y.properties[4])?b:1,null!=(M=null===(w=B)||void 0===w?void 0:w.properties[5])?M:1,null!=(T=null===(x=B)||void 0===x?void 0:x.properties[6])?T:1),D&&(P.transform.localRotation=i.quat.mul(P.transform.localRotation,i.quat.fromEuler(i.quat.create(),null!=(R=D.properties[4])?R:0,null!=(k=D.properties[5])?k:0,null!=(E=D.properties[6])?E:0),P.transform.localRotation)),P}function u(t){var e,n,r,i,a;const u=t.properties[0],f=t.properties[1].split("\0")[0],p=null!=(n=null===(e=t.nestedNodes.find(t=>"Vertices"===t.name))||void 0===e?void 0:e.properties[0])?n:new Float64Array,m=null!=(i=null===(r=t.nestedNodes.find(t=>"PolygonVertexIndex"===t.name))||void 0===r?void 0:r.properties[0])?i:new Int32Array,g=t.nestedNodes.find(t=>"LayerElementNormal"===t.name),_=t.nestedNodes.find(t=>"LayerElementUV"===t.name&&0===t.properties[0]),y=t.nestedNodes.find(t=>"LayerElementUV"===t.name&&1===t.properties[0]),b=t.nestedNodes.find(t=>"LayerElementMaterial"===t.name);let w=[],M=[],x=[],T=[],R=[];if(p.length%3!=0)throw new Error("Invalid vertices size.");const k=l(p);M=Array.from(m).map(t=>k[t>=0?t:-1^t]);let E=0;for(let t=0;t<m.length;)if(t+3<m.length&&m[t+3]<0)w[E++]=[t,t+1,t+2,t+3],t+=4;else{if(!(t+2<m.length&&m[t+2]<0))throw new Error("Invalid length of polygon index list.");w[E++]=[t,t+1,t+2],t+=3}if(g&&(x=c(g,"Normals",w,M,l)),_&&(T=c(_,"UV",w,M,h)),y&&(R=c(y,"UV",w,M,h)),b){const t=new Map,e=v(b,"MappingInformationType"),n=v(b,"ReferenceInformationType"),r=null!=(a=v(b,"Materials"))?a:s.panic("Missing materials.");if("AllSame"===e)return[{id:u,name:f,colors:[],verts:M,normals:x,triangles:d(w),uv0:T,uv1:R,material:null,mateiralId:0}];if("ByPolygon"!==e||"IndexToDirect"!==n)throw new Error(`Unsupported material info type '${e}', '${n}'.`);o.assert(r.length===w.length,"length of Material list missmatch.");for(let e=0;e<r.length;e++)t.has(r[e])||t.set(r[e],[]),t.get(r[e]).push(e);const i=[];for(const[e,n]of t){const t={id:u,name:f,colors:[],verts:[],normals:[],triangles:[],uv0:[],uv1:[],material:null,mateiralId:e};let r=0;const s=[];for(const e of n){s.push(w[e]);for(let n=0;n<w[e].length;n++){const i=w[e][n];t.verts[r]=M[i],x.length>0&&(t.normals[r]=x[i]),T.length>0&&(t.uv0[r]=T[i]),R.length>0&&(t.uv1[r]=R[i]),r++}}t.triangles=d(s),i.push(t)}return i}return[{id:u,name:f,colors:[],verts:M,normals:x,triangles:d(w),uv0:T,uv1:R,material:null,mateiralId:0}]}function c(t,e,n,r,i){var a,u,c;const l=i(null!=(a=v(t,e))?a:s.panic(`Invalid data format of '${e}'.`));let h=new Array(r.length);const d=v(t,"MappingInformationType"),f=v(t,"ReferenceInformationType");if("ByPolygon"===d){if("Direct"===f){o.assert(l.length===n.length,"Invalid length of normal list.");for(let t=0;t<l.length;t++)for(let e=0;e<n.length;e++)h[n[t][e]]=l[t]}else if("IndexToDirect"===f){const i=null!=(u=v(t,e+"Index"))?u:s.panic(e+"Index missing.");o.assert(i.length===r.length,`Length of ${e}Index missmatch.`);for(let t=0;t<n.length;t++)for(let e=0;e<n[t].length;e++)h[n[t][e]]=l[i[t]]}}else if("ByPolygonVertex"===d){if("Direct"===f)o.assert(l.length===r.length,"Invalid length of "+e),h=l;else if("IndexToDirect"===f){const n=null!=(c=v(t,e+"Index"))?c:s.panic(e+"Index missing.");o.assert(n.length===r.length,`Length of ${e}Index missmatch.`);for(let t=0;t<n.length;t++)h[t]=l[n[t]]}}else{if("ByEdge"===d)throw new Error(`Mapping '${e}' by edge is not supported.`);if("AllSame"!==d)throw new Error(`Unknown mapping type for '${e}'.`);for(let t=0;t<h.length;t++)h[t]=l[0]}return h}function l(t){o.assert(t.length%3==0,"Invalid data length for vec3 array.");const e=new Array(t.length/3);for(let n=0;n<t.length;n+=3)e[n/3]=i.vec3.fromValues(t[n],t[n+1],t[n+2]);return e}function h(t){o.assert(t.length%2==0,"Invalid data length for vec2 array.");const e=new Array(t.length/2);for(let n=0;n<t.length;n+=2)e[n/2]=i.vec2.fromValues(t[n],t[n+1]);return e}function d(t){const e=[];for(const n of t)if(3===n.length)e.push(...n);else{if(4!==n.length)throw new Error("Invalid polygon size.");e.push(n[0],n[1],n[2],n[0],n[2],n[3])}return e}function f(t){const e={id:t.properties[0],name:t.properties[1].split("\0")[0]},n=t.nestedNodes.find(t=>"Properties70"===t.name);if(n)for(const t of n.nestedNodes){const n=t.properties[0],r=t.properties[1];switch(r){case"KString":e[n]=t.properties[4];break;case"double":case"Number":e[n]=t.properties[4];break;case"Color":const[,,,,s,o,a]=t.properties;e[n]=i.vec4.fromValues(s,o,a,1);break;case"Bool":e[n]=1===t.properties[4];break;case"Vector3D":const[,,,,u,c,l]=t.properties;e[n]=i.vec3.fromValues(u,c,l);break;default:console.warn(`Unknown material property type '${r}'`)}}return e}function v(t,e,n=0){var r;return null===(r=t.nestedNodes.find(t=>t.name===e))||void 0===r?void 0:r.properties[n]}e.extractFBXAssets=function(t){const e=t.nodes.find(t=>"Objects"===t.name);if(!e)return{materials:[],models:[]};const n=new Map,r=e.nestedNodes.filter(t=>"Model"===t.name).map(a),i=e.nestedNodes.filter(t=>"Geometry"===t.name).map(u),s=e.nestedNodes.filter(t=>"Material"===t.name).map(f);for(const t of r)n.set(t.id,{type:"model",data:t});for(const t of i)n.set(t[0].id,{type:"geometry",data:t});for(const t of s)n.set(t.id,{type:"material",data:t});const o=t.nodes.find(t=>"Connections"===t.name);n.set(BigInt(0),{type:"null"}),o&&function(t,e){for(const n of t.nestedNodes){const[,t,r]=n.properties,i=e.get(t),s=e.get(r);i?s?"model"===i.type&&"model"===s.type?(i.data.transform.parent=s.data.transform,s.data.transform.children.push(i.data.transform)):"geometry"===i.type&&"model"===s.type?s.data.meshes=i.data:"material"===i.type&&"model"===s.type&&s.data.materials.push(i.data):console.warn(`Resource with id '${r}' is missing.`):console.warn(`Resource with id '${t}' is missing.`)}}(o,n);for(const t of r)for(const e of t.meshes)e.material=t.materials[e.mateiralId];return{materials:s,models:r}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(16),i=n(24);e.FBXTransform=class{constructor(t,e=null){this.parent=null,this.children=[],this.localPosition=r.vec3.create(),this.localRotation=r.quat.identity(r.quat.create()),this.localScaling=r.vec3.fromValues(0,0,0),this.parent=e,this.model=t}get position(){if(!this.parent)return this.localPosition;let[t,e,n]=this.localPosition;return[t,e,n]=r.vec4.transformMat4(r.vec4.create(),r.vec4.fromValues(t,e,n,1),this.localToWorldMatrix),r.vec3.fromValues(t,e,n)}set position(t){this.parent?this.localPosition=i.mulPoint(this.localPosition,this.parent.localToWorldMatrix,this.localPosition):this.localPosition=t}get rotation(){return this.parent?r.quat.mul(r.quat.create(),this.parent.rotation,this.localRotation):this.localRotation}set rotation(t){this.parent?this.localRotation=r.quat.normalize(this.localRotation,r.quat.mul(this.localRotation,r.quat.invert(r.quat.create(),this.parent.rotation),t)):this.localRotation=r.quat.normalize(this.localRotation,this.localRotation)}get scaling(){return this.parent?r.vec3.mul(r.vec3.create(),this.parent.scaling,this.localScaling):this.localScaling}set scaling(t){this.parent?this.localScaling=r.vec3.div(this.localScaling,t,this.parent.scaling):this.localScaling=t}get localToWorldMatrix(){if(!this.parent)return r.mat4.fromRotationTranslationScale(r.mat4.create(),this.localRotation,this.localPosition,this.localScaling);const t=r.mat4.fromRotationTranslationScale(r.mat4.create(),this.localRotation,this.localPosition,this.localScaling);return r.mat4.mul(t,this.parent.localToWorldMatrix,t)}get worldToLocalMatrix(){return r.mat4.invert(this.localToWorldMatrix,this.localToWorldMatrix)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(33),i=n(18),s=n(11),o=n(2);e.TextureImporter={import:(t,e,n=o.GlobalContext())=>new Promise((e,o)=>{const a=new Blob([t]),u=new Image;u.src=URL.createObjectURL(a);const c=()=>{const t=new i.Texture2D(u.width,u.height,s.TextureFormat.RGBA,i.FilterMode.Linear,n);t.setData(u);const o=new r.AssetsPack;o.add("img",t),o.setMain(t),e(o)};u.complete?c():u.onload=c})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(40))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RenderPipeline=void 0;const r=n(0),i=n(22),s=n(25),o=n(58);e.RenderPipeline=class{constructor(){this.debuglayer=new r.DebugLayerRenderer,this.lightmap=new r.RenderTexture(16,16,!1),this.lightComposeMat=new o.LightComposeMaterial}render(t,e){for(const n of e){const e=new r.RenderData(n,t.scene);this.renderCamera(t,e)}}replaceMaterial(t,e){throw new Error("Method not implemented.")}renderCamera(t,e){const n=e.camera;n.__preRender(t),this.lightmap.width===t.renderer.canvasSize.x&&this.lightmap.height===t.renderer.canvasSize.y||(this.lightmap.destroy(),this.lightmap=new r.RenderTexture(t.renderer.canvasSize.x,t.renderer.canvasSize.y,!1),this.lightmap.update()),n.output===i.RenderTarget.CanvasTarget?t.renderer.setRenderTarget(i.RenderTarget.CanvasTarget):t.renderer.setRenderTarget(n.output),t.renderer.clear(n.clearColor,n.clearDepth),t.renderer.setViewProjection(n.worldToLocalMatrix,n.projectionMatrix),t.renderer.setGlobalUniform("uCameraPos","vec3",n.position);const s=e.getVisibleObjects(r.RenderOrder.FarToNear);for(const n of s){n.__onRender(t,e);const r=n.localToWorldMatrix;for(let e=0;e<n.meshes.length;e++){if(!n.meshes[e])continue;const i=n.materials[e]||t.renderer.assets.materials.default;t.renderer.drawMesh(n.meshes[e],r,i)}}this.renderLight(t,e),this.debuglayer.render(t,e),n.__postRender(t)}renderLight(t,e){var n=t.scene.getEntitiesOfType(s.Light2D);t.renderer.setRenderTarget(this.lightmap),t.renderer.clear(r.Color.black);for(const e of n)e.enable&&t.renderer.drawMesh(e.mesh,e.localToWorldMatrix,e.material);t.renderer.setRenderTarget(i.RenderTarget.CanvasTarget),t.renderer.blit(this.lightmap,i.RenderTarget.CanvasTarget,this.lightComposeMat)}}},function(t,e){t.exports="#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vColor;\r\nin vec4 vPos;\r\nin vec2 vUV;\r\n\r\nuniform sampler2D uMainTex;\r\nuniform vec4 uColor;\r\nuniform vec2 uLightDirection;\r\nuniform float uLightAngle;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    vec2 uv = (vUV - vec2(0.5)) * vec2(2);\r\n    if(dot(normalize(uv), uLightDirection) < cos(uLightAngle))\r\n    {\r\n        fragColor = vec4(0, 0, 0, 1.0);\r\n        return;\r\n    }\r\n    float r = length(uv);\r\n    float light = pow(max(1.0 - r, 0.0), 2.0);\r\n    vec3 color = texture(uMainTex, vUV.xy).rgb;\r\n    // color = color * vec3(uColor);\r\n    fragColor = vec4(light, light, light, 1.0);\r\n}\r\n"},function(t,e){t.exports="#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vColor;\r\nin vec4 vPos;\r\nin vec2 vUV;\r\nin vec3 vNormal;\r\n\r\nuniform sampler2D uMainTex;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    fragColor = texture(uMainTex, vUV).rgba;\r\n}"},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.start=void 0;const s=n(0),o=n(61),a=n(26),u=i(n(104)),c=i(n(62)),l=n(105),h=n(27),d=n(121),f=n(25),v=n(125),p=n(15);e.start=function(t,e){return r(this,void 0,void 0,(function*(){const n=new s.InputManager,r=new s.Camera;r.position=s.vec3(0,0,10),r.projection=s.Projection.Orthographic,r.viewHeight=10,t.scene.add(r);const i=t.renderer.assets.meshes.quad,m=new s.RenderObject;m.meshes[0]=i;const g=new o.Material2D,_=yield a.loadImage(u.default),y=new s.Texture2D;y.setData(_),g.texture=y,m.materials[0]=g,t.scene.add(m);let b=new l.Tilemap;b.position=s.vec3(0,0,-10),t.scene.add(b);const w=new s.Texture2D;w.filterMode=s.FilterMode.Nearest,w.setData(yield a.loadImage(c.default)),b.materials[0].texture=w,b.materials[0].atlasSize=s.vec2(7,7);const M=new h.ChunksManager(b,e.seed);let x=new d.Player(t.scene,n,b,e);t.scene.add(x),r.parent=x;let T=new v.NetworkPlayer(t.scene,e);t.scene.add(T);let R=new f.Light2D;t.scene.add(R,x),R.size=12;t.on("update",()=>{n.update(),M.update()}),p.initGlobalEntities({scene:t.scene,engine:t,camera:r,chunksManager:M,player:x,remotePlayer:T,tilemap:b,assets:yield p.loadAssets(),input:n,session:e}),t.start()}))}},function(t,e){t.exports="#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vColor;\r\nin vec4 vPos;\r\nin vec2 vUV;\r\n\r\nuniform sampler2D uMainTex;\r\nuniform vec4 uColor;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    vec4 color = texture(uMainTex, vUV.xy).rgba;\r\n    // color = color * vec3(uColor);\r\n    fragColor = color.rgba;\r\n}"},function(t,e,n){"use strict";n.r(e),e.default=n.p+"static/img/tex.png"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Chunk=e.Tilemap=void 0;const r=n(0),i=n(106),s=n(63),o=n(12);class a extends r.RenderObject{constructor(){super(),this.chunks=new Map,this.on("render",this.onRender.bind(this)),this.materials[0]=new i.TilemapMaterial}onRender(t,e,n){let i=r.vec2(n.camera.viewHeight*n.camera.aspectRatio,n.camera.viewHeight),[s]=this.chunkPos(r.minus(n.camera.position.toVec2(),i)),[o]=this.chunkPos(r.plus(n.camera.position.toVec2(),i));for(let t=s.y;t<=o.y;t++)for(let n=s.x;n<=o.x;n++){const i=this.getChunk(r.vec2(n,t));i&&e.renderer.drawMesh(i.mesh,r.mat4.translate(r.vec3(16*n,16*t,0)),this.materials[0])}}getTile(t){let[e,n]=this.chunkPos(o.floor2(t));return this.getOrCreateChunk(e).getTile(n)}setTile(t,e){let[n,r]=this.chunkPos(o.floor2(t));return this.getOrCreateChunk(n).setTile(r,e)}visibleChunkRange(t){let e=r.vec2(t.viewHeight*t.aspectRatio,t.viewHeight),[n]=this.chunkPos(r.minus(t.position.toVec2(),e)),[i]=this.chunkPos(r.plus(t.position.toVec2(),e));return[n,r.plus(i,1)]}getOrCreateChunk(t){const e=s.calcChunkID(t);let n=this.chunks.get(e);return n||(n=new u,this.chunks.set(e,n),n)}getChunk(t){const e=s.calcChunkID(t);return this.chunks.get(e)}chunkPos(t){return s.calcChunkPos(t,16)}}e.Tilemap=a;class u{constructor(){this.tiles=new Array(256),this.mesh=function(){const t=new r.MeshBuilder;for(let e=0;e<16;e++)for(let n=0;n<16;n++)t.addPolygon([r.vec3(n-.005,e-.005,0),r.vec3(n+1+.005,e-.005,0),r.vec3(n+1+.005,e+1+.005,0),r.vec3(n-.005,e+1+.005,0)],[r.vec2(0,0),r.vec2(1,0),r.vec2(1,1),r.vec2(0,1)]);const e=t.toMesh();e.update();const n=e.uv2;for(let t=0;t<n.length;t++)n[t]=r.vec2(-1,-1);return e.uv2=n,e.update(),e}()}getTile(t){const e=16*t.y+t.x;return this.tiles[e]}setTile(t,e){e&&(e={collide:e.collide,texture_offset:e.texture_offset.clone()});let n=16*t.y+t.x;this.tiles[n]=e;const i=e?e.texture_offset:r.vec2(-1,-1);let s=this.mesh.uv2;n*=4,s[n+0]=i,s[n+1]=i,s[n+2]=i,s[n+3]=i,this.mesh.uv2=s}}e.Chunk=u},function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.TilemapMaterial=void 0;const s=n(0),o=i(n(107)),a=i(n(108));let u=class extends(s.MaterialFromShader(new s.Shader(o.default,a.default,{blend:[s.Blending.SrcAlpha,s.Blending.OneMinusSrcAlpha]}))){constructor(){super(...arguments),this.texture=null,this.atlasSize=s.vec2(1,1)}};r([s.shaderProp("uMainTex","tex2d")],u.prototype,"texture",void 0),r([s.shaderProp("uAtlasSize","vec2")],u.prototype,"atlasSize",void 0),u=r([s.materialDefine],u),e.TilemapMaterial=u},function(t,e){t.exports="#version 300 es\r\nprecision mediump float;\r\n\r\nin vec3 aPos;\r\nin vec4 aColor;\r\nin vec2 aUV;\r\nin vec2 aUV2;\r\nin vec3 aNormal;\r\n\r\nuniform mat4 uTransformM;\r\nuniform mat4 uTransformVP;\r\nuniform mat4 uTransformMVP;\r\nuniform mat4 uTransformM_IT;\r\n\r\nout vec4 vColor;\r\nout vec4 vPos;\r\nout vec2 vUV;\r\nout vec2 vUV2;\r\nout vec3 vNormal;\r\nout vec3 vWorldPos;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = uTransformMVP * vec4(aPos, 1);\r\n    vPos = gl_Position;\r\n    vColor = aColor;\r\n    vUV = aUV;\r\n    vUV2 = aUV2;\r\n    vNormal = (uTransformM_IT *  vec4(aNormal, 0)).xyz;\r\n    vWorldPos = (uTransformM * vec4(aPos, 1)).xyz;\r\n    \r\n}"},function(t,e){t.exports="#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vColor;\r\nin vec4 vPos;\r\nin vec2 vUV;\r\nin vec2 vUV2;\r\n\r\nuniform sampler2D uMainTex;\r\nuniform vec4 uColor;\r\nuniform vec2 uAtlasSize;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    // color = color * vec3(uColor);\r\n    if (vUV2.x < 0.0f || vUV2.y < 0.0f)\r\n    {\r\n        fragColor = vec4(0);\r\n        return;\r\n    }\r\n    vec2 uv = (vUV + vUV2) / uAtlasSize;\r\n    vec3 color = texture(uMainTex, uv.xy).rgb;\r\n    fragColor = vec4(color.rgb, 1);\r\n}"},function(t,e,n){var r=n(110),i=n(111),s=n(112),o=n(113),a=n(114),u=n(115),c=n(116);c.alea=r,c.xor128=i,c.xorwow=s,c.xorshift7=o,c.xor4096=a,c.tychei=u,t.exports=c},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e,n=this,r=(e=4022871197,function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function u(t,e){var n=new o(t),r=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n(4)&&n(14)?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.alea=u}(0,t,n(4))}).call(this,n(13)(t))},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function u(t,e){var n=new o(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n(4)&&n(14)?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xor128=u}(0,t,n(4))}).call(this,n(13)(t))},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function u(t,e){var n=new o(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n(4)&&n(14)?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xorwow=u}(0,t,n(4))}).call(this,n(13)(t))},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function u(t,e){null==t&&(t=+new Date);var n=new o(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.x&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n(4)&&n(14)?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xorshift7=u}(0,t,n(4))}).call(this,n(13)(t))},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,s=e.i;return e.w=r=r+1640531527|0,n=i[s+34&127],t=i[s=s+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[s]=n^t,e.i=s,n+(r^r>>>16)|0},function(t,e){var n,r,i,s,o,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),i=0,s=-32;s<u;++s)e&&(r^=e.charCodeAt((s+32)%e.length)),0===s&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,s>=0&&(o=o+1640531527|0,i=0==(n=a[127&s]^=r+o)?i+1:0);for(i>=128&&(a[127&(e&&e.length||0)]=-1),i=127,s=512;s>0;--s)r=a[i+34&127],n=a[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[i]=r^n;t.w=o,t.X=a,t.i=i}(e,t)}function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function u(t,e){null==t&&(t=+new Date);var n=new o(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.X&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n(4)&&n(14)?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xor4096=u}(0,t,n(4))}).call(this,n(13)(t))},function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function u(t,e){var n=new o(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n(4)&&n(14)?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.tychei=u}(0,t,n(4))}).call(this,n(13)(t))},function(t,e,n){var r;!function(i,s,o){var a,u=o.pow(256,6),c=o.pow(2,52),l=2*c;function h(t,e,n){var r=[],h=v(function t(e,n){var r,i=[],s=typeof e;if(n&&"object"==s)for(r in e)try{i.push(t(e[r],n-1))}catch(t){}return i.length?i:"string"==s?e:e+"\0"}((e=1==e?{entropy:!0}:e||{}).entropy?[t,p(s)]:null==t?function(){try{var t;return a&&(t=a.randomBytes)?t=t(256):(t=new Uint8Array(256),(i.crypto||i.msCrypto).getRandomValues(t)),p(t)}catch(t){var e=i.navigator,n=e&&e.plugins;return[+new Date,i,n,i.screen,p(s)]}}():t,3),r),m=new d(r),g=function(){for(var t=m.g(6),e=u,n=0;t<c;)t=256*(t+n),e*=256,n=m.g(1);for(;t>=l;)t/=2,e/=2,n>>>=1;return(t+n)/e};return g.int32=function(){return 0|m.g(4)},g.quick=function(){return m.g(4)/4294967296},g.double=g,v(p(m.S),s),(e.pass||n||function(t,e,n,r){return r&&(r.S&&f(r,m),t.state=function(){return f(m,{})}),n?(o.random=t,e):t})(g,h,"global"in e?e.global:this==o,e.state)}function d(t){var e,n=t.length,r=this,i=0,s=r.i=r.j=0,o=r.S=[];for(n||(t=[n++]);i<256;)o[i]=i++;for(i=0;i<256;i++)o[i]=o[s=255&s+t[i%n]+(e=o[i])],o[s]=e;(r.g=function(t){for(var e,n=0,i=r.i,s=r.j,o=r.S;t--;)e=o[i=255&i+1],n=256*n+o[255&(o[i]=o[s=255&s+e])+(o[s]=e)];return r.i=i,r.j=s,n})(256)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function v(t,e){for(var n,r=t+"",i=0;i<r.length;)e[255&i]=255&(n^=19*e[255&i])+r.charCodeAt(i++);return p(e)}function p(t){return String.fromCharCode.apply(0,t)}if(v(o.random(),s),t.exports){t.exports=h;try{a=n(117)}catch(t){}}else void 0===(r=function(){return h}.call(e,n,e,t))||(t.exports=r)}("undefined"!=typeof self?self:this,[],Math)},function(t,e){},function(t,e,n){!function(t){function e(t){function e(t,e,n){this.x=t,this.y=e,this.z=n}e.prototype.dot2=function(t,e){return this.x*t+this.y*e},e.prototype.dot3=function(t,e,n){return this.x*t+this.y*e+this.z*n},this.grad3=[new e(1,1,0),new e(-1,1,0),new e(1,-1,0),new e(-1,-1,0),new e(1,0,1),new e(-1,0,1),new e(1,0,-1),new e(-1,0,-1),new e(0,1,1),new e(0,-1,1),new e(0,1,-1),new e(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(t||0)}e.prototype.seed=function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=this.p,n=0;n<256;n++){var r;r=1&n?e[n]^255&t:e[n]^t>>8&255;var i=this.perm,s=this.gradP;i[n]=i[n+256]=r,s[n]=s[n+256]=this.grad3[r%12]}};var n=.5*(Math.sqrt(3)-1),r=(3-Math.sqrt(3))/6,i=1/6;function s(t){return t*t*t*(t*(6*t-15)+10)}function o(t,e,n){return(1-n)*t+n*e}e.prototype.simplex2=function(t,e){var i,s,o=(t+e)*n,a=Math.floor(t+o),u=Math.floor(e+o),c=(a+u)*r,l=t-a+c,h=e-u+c;l>h?(i=1,s=0):(i=0,s=1);var d=l-i+r,f=h-s+r,v=l-1+2*r,p=h-1+2*r;a&=255,u&=255;var m=this.perm,g=this.gradP,_=g[a+m[u]],y=g[a+i+m[u+s]],b=g[a+1+m[u+1]],w=.5-l*l-h*h,M=.5-d*d-f*f,x=.5-v*v-p*p;return 70*((w<0?0:(w*=w)*w*_.dot2(l,h))+(M<0?0:(M*=M)*M*y.dot2(d,f))+(x<0?0:(x*=x)*x*b.dot2(v,p)))},e.prototype.simplex3=function(t,e,n){var r,s,o,a,u,c,l=(t+e+n)*(1/3),h=Math.floor(t+l),d=Math.floor(e+l),f=Math.floor(n+l),v=(h+d+f)*i,p=t-h+v,m=e-d+v,g=n-f+v;p>=m?m>=g?(r=1,s=0,o=0,a=1,u=1,c=0):p>=g?(r=1,s=0,o=0,a=1,u=0,c=1):(r=0,s=0,o=1,a=1,u=0,c=1):m<g?(r=0,s=0,o=1,a=0,u=1,c=1):p<g?(r=0,s=1,o=0,a=0,u=1,c=1):(r=0,s=1,o=0,a=1,u=1,c=0);var _=p-r+i,y=m-s+i,b=g-o+i,w=p-a+2*i,M=m-u+2*i,x=g-c+2*i,T=p-1+.5,R=m-1+.5,k=g-1+.5;h&=255,d&=255,f&=255;var E=this.perm,P=this.gradP,A=P[h+E[d+E[f]]],S=P[h+r+E[d+s+E[f+o]]],C=P[h+a+E[d+u+E[f+c]]],B=P[h+1+E[d+1+E[f+1]]],D=.5-p*p-m*m-g*g,I=.5-_*_-y*y-b*b,F=.5-w*w-M*M-x*x,L=.5-T*T-R*R-k*k;return 32*((D<0?0:(D*=D)*D*A.dot3(p,m,g))+(I<0?0:(I*=I)*I*S.dot3(_,y,b))+(F<0?0:(F*=F)*F*C.dot3(w,M,x))+(L<0?0:(L*=L)*L*B.dot3(T,R,k)))},e.prototype.perlin2=function(t,e){var n=Math.floor(t),r=Math.floor(e);t-=n,e-=r,n&=255,r&=255;var i=this.perm,a=this.gradP,u=a[n+i[r]].dot2(t,e),c=a[n+i[r+1]].dot2(t,e-1),l=a[n+1+i[r]].dot2(t-1,e),h=a[n+1+i[r+1]].dot2(t-1,e-1),d=s(t);return o(o(u,l,d),o(c,h,d),s(e))},e.prototype.perlin3=function(t,e,n){var r=Math.floor(t),i=Math.floor(e),a=Math.floor(n);t-=r,e-=i,n-=a,r&=255,i&=255,a&=255;var u=this.perm,c=this.gradP,l=c[r+u[i+u[a]]].dot3(t,e,n),h=c[r+u[i+u[a+1]]].dot3(t,e,n-1),d=c[r+u[i+1+u[a]]].dot3(t,e-1,n),f=c[r+u[i+1+u[a+1]]].dot3(t,e-1,n-1),v=c[r+1+u[i+u[a]]].dot3(t-1,e,n),p=c[r+1+u[i+u[a+1]]].dot3(t-1,e,n-1),m=c[r+1+u[i+1+u[a]]].dot3(t-1,e-1,n),g=c[r+1+u[i+1+u[a+1]]].dot3(t-1,e-1,n-1),_=s(t),y=s(e),b=s(n);return o(o(o(l,v,_),o(h,p,_),b),o(o(d,m,_),o(f,g,_),b),y)},t.Noise=e}(t.exports)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Chest=void 0;const r=n(15),i=n(28);class s extends i.SpriteObject{constructor(t,e){super(),this.items=t,this.chunk=e,this.sprite=r.Global().assets.spriteChest}open(){return r.Global().scene.remove(this),this.chunk.removeChest(this),this.items}}e.Chest=s},function(t,e,n){"use strict";n.r(e),e.default=n.p+"static/img/checkboard.png"},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;const s=n(0),o=n(122),a=n(26),u=n(27),c=n(123),l=n(65),h=n(15),d=n(66),f=n(124),v=n(67),p=n(68),m=n(35),g=i(n(69)),_=n(11);class y extends o.Rigidbody{constructor(t,e,n,r){super(n),this.moveSpeed=5,this.resources=new Map,this.tools=[{type:u.ItemType.None,count:0,endure:1}],this.currentToolIdx=0,this.facing=s.vec2.down(),this.flashlightTool=null,this.input=e,this.session=r,this.flashlight=new p.FlashLight,this.flashlight.size=30,this.flashlight.halfAngle=Math.PI/6,t.add(this.flashlight,this),this.on("update",this.update.bind(this)),this.init(),f.updateTools(this.tools,this.currentToolIdx)}init(){return r(this,void 0,void 0,(function*(){const t=yield a.loadImage(g.default),e=new s.Texture2D(t.width,t.height,_.TextureFormat.RGBA,s.FilterMode.Nearest);e.setData(t),this.sprite=new m.Sprite(e,s.vec2(16,16),s.vec2(4,7))}))}update(t,e){const n=s.vec2.zero();(this.input.getKey(s.Keys.W)||this.input.getKey(s.Keys.Up))&&(n.y+=1),(this.input.getKey(s.Keys.S)||this.input.getKey(s.Keys.Down))&&(n.y-=1),(this.input.getKey(s.Keys.A)||this.input.getKey(s.Keys.Left))&&(n.x-=1),(this.input.getKey(s.Keys.D)||this.input.getKey(s.Keys.Right))&&(n.x+=1),(this.input.getKeyDown(s.Keys.W)||this.input.getKeyDown(s.Keys.Up))&&(this.facing=s.vec2.up()),(this.input.getKeyDown(s.Keys.S)||this.input.getKeyDown(s.Keys.Down))&&(this.facing=s.vec2.down()),(this.input.getKeyDown(s.Keys.A)||this.input.getKeyDown(s.Keys.Left))&&(this.facing=s.vec2.left()),(this.input.getKeyDown(s.Keys.D)||this.input.getKeyDown(s.Keys.Right))&&(this.facing=s.vec2.right());const r=h.Global().camera.screenToWorld(this.input.pointerPosition).toVec2();if(this.input.getKeyDown(s.Keys.F2)){}if(n.normalize(),this.velocity=s.mul(n,this.moveSpeed),this.session.sendSync({pos:this.position.toVec2(),velocity:this.velocity,flashlight:this.flashlight.enable,flashlightDir:this.flashlight.direction}),this.input.getKeyDown(s.Keys.C))this.craft();else if(this.input.getKeyDown(s.Keys.E))this.useTool(this.position.toVec2());else if(this.input.getKeyDown(s.Keys.Mouse0)){const t=h.Global().camera.screenToWorld(this.input.pointerPosition).toVec2();s.minus(t,this.position.toVec2()).magnitude<1.6&&this.useTool(t)}if(this.input.wheelDelta>0?(this.currentToolIdx=(this.currentToolIdx+1)%this.tools.length,f.updateTools(this.tools,this.currentToolIdx)):this.input.wheelDelta<0&&(this.currentToolIdx=(this.currentToolIdx-1+this.tools.length)%this.tools.length,f.updateTools(this.tools,this.currentToolIdx)),this.flashlight.enable){const t=20;this.flashlight.enable=this.reduceEndure(u.ItemType.Flashlight,1/t*e.deltaTime)}this.flashlight.direction=s.minus(r,this.position.toVec2()).normalized}craft(){return r(this,void 0,void 0,(function*(){switch(yield c.craft(this.resources)){case u.ItemType.Campfire:l.Campfire.spawn(this.position.toVec2(),!0);break;case u.ItemType.Flashlight:this.addTool(u.ItemType.Flashlight);break;case u.ItemType.Pickaxe:this.addTool(u.ItemType.Pickaxe);break;case u.ItemType.Radio:this.addTool(u.ItemType.Radio)}}))}reduceEndure(t,e){for(const n of this.tools)if(n.type==t){if(n.endure-=e,n.endure<=0){if(n.count--,n.count<=0)return this.tools=this.tools.filter(t=>t!==n),this.currentToolIdx%=this.tools.length,f.updateTools(this.tools,this.currentToolIdx),d.showLog(`[${u.ItemName[n.type]}] ...`),!1;d.showLog(` [${u.ItemName[n.type]}] x1`),n.endure=1}return f.updateTools(this.tools,this.currentToolIdx),!0}return!1}getTool(t){for(const e of this.tools)if(e.type==t)return e;return null}addTool(t){let e=this.getTool(t);d.showLog(` [${u.ItemName[t]}] x1`),e?e.count++:(e={type:t,count:1,endure:1},this.tools.push(e)),f.updateTools(this.tools,this.currentToolIdx)}useTool(t){const e=h.Global().chunksManager.getChunkAt(this.position.toVec2());for(const t of e.chests){const e=s.minus(t.position,this.position).toVec2(),n=e.magnitude;if(n<1||n<=2&&e.dot(this.facing)>=.5)return console.log("open chest at "+n),void this.openChest(t)}const n=t=>{t.count--,t.count<=0&&(this.tools=this.tools.filter(e=>e!==t),this.currentToolIdx=0),f.updateTools(this.tools,this.currentToolIdx)},r=this.tools[this.currentToolIdx];switch(r.type){case u.ItemType.Paint:v.Mark.makeOnGround(t,!0),n(r);break;case u.ItemType.Pickaxe:break;case u.ItemType.Flashlight:this.flashlight.enable=!this.flashlight.enable}}openChest(t){const e=t.open();for(const t of e)switch(t){case u.ItemType.Battery:case u.ItemType.Glass:case u.ItemType.Iron:case u.ItemType.PCB:case u.ItemType.Petrol:case u.ItemType.Wire:case u.ItemType.Wood:const e=this.resources.get(t)||0;this.resources.set(t,e+1),d.showLog(` [${u.ItemName[t]}] x1`);break;case u.ItemType.Flashlight:case u.ItemType.Paint:case u.ItemType.Pickaxe:case u.ItemType.Radio:this.addTool(t)}}}e.Player=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Rigidbody=void 0;const r=n(0),i=n(57),s=n(12),o=n(28);class a extends o.SpriteObject{constructor(t){super(),this.colliderSize=r.vec2(.8,.8),this.colliderOffset=r.vec2.zero(),this.velocity=r.vec2.zero(),this.neighborTiles=[],this.tilemap=t,this.on("update",this.updatePhysics.bind(this))}updatePhysics(t,e){const n=r.mul(this.velocity,e.deltaTime);let i=this.velocity.clone();{const[t,o]=this.collisionCheck(e.deltaTime,this.velocity,r.vec2.down(),r.vec2.left());t&&(n.y=s.minAbs(n.y,i.normalized.y*o))}{const[t,o]=this.collisionCheck(e.deltaTime,this.velocity,r.vec2.up(),r.vec2.left());t&&(n.y=s.minAbs(n.y,i.normalized.y*o))}{const[t,o]=this.collisionCheck(e.deltaTime,this.velocity,r.vec2.left(),r.vec2.up());t&&(n.x=s.minAbs(n.x,i.normalized.x*o))}{const[t,o]=this.collisionCheck(e.deltaTime,this.velocity,r.vec2.right(),r.vec2.up());t&&(n.x=s.minAbs(n.x,i.normalized.x*o))}this.velocity=r.div(n,e.deltaTime),this.position=r.plus(this.position,r.mul(this.velocity,e.deltaTime))}collisionCheck(t,e,n,o){const a=this.colliderSize;var u=r.div(a,2),c=r.plus(this.position,this.colliderOffset).toVec2(),l=r.mul(e,t);this.neighborTiles=[],!this.isColliderTile(r.plus(c,o))&&this.isColliderTile(r.plus(c,n).plus(o))&&this.neighborTiles.push(new s.Rect(s.floor2(r.plus(c,n).plus(o)).minus(u),r.vec2.one().plus(a))),!this.isColliderTile(r.minus(c,o))&&this.isColliderTile(r.plus(c,n).minus(o))&&this.neighborTiles.push(new s.Rect(s.floor2(r.plus(c,n).minus(o)).minus(u),r.vec2.one().plus(a))),this.isColliderTile(r.plus(c,n))&&this.neighborTiles.push(new s.Rect(s.floor2(r.plus(c,n)).minus(u),r.vec2.one().plus(a)));let h=Number.MAX_VALUE,d=!1;for(const t of this.neighborTiles){i.Debug().drawRect(t.min,t.max,new r.Color(.5*n.x+.5,.5*n.y+.5,1));const o=-1e-5,[a,u,f]=s.boxRaycast(t,c,e.normalized);a&&o<=u&&u<=l.magnitude&&f.dot(n)<-.99&&(i.Debug().drawLine(r.plus(c,e.normalized.mul(r.vec2(u))).toVec3(),r.plus(c,e.normalized.mul(r.vec2(u)).plus(f)).toVec3()),h=Math.min(u,h),d=!0)}return[d,h]}isColliderTile(t){const e=this.tilemap.getTile(t);return!!e&&e.collide}}e.Rigidbody=a},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.craft=void 0;const i=n(27),s=n(64);let o=!1;e.craft=function(t){if(o)return(()=>r(this,void 0,void 0,(function*(){return null})))();o=!0;const e=()=>{s.$("#craft").style.display="none",o=!1};return s.$("#craft").style.display="flex",new Promise((n,r)=>{const o=10,a=2,u=5,c=1,l=2,h=2,d=2,f=5,v=3;let p=t.get(i.ItemType.Wood)||0,m=t.get(i.ItemType.Glass)||0,g=t.get(i.ItemType.Battery)||0,_=t.get(i.ItemType.Iron)||0,y=t.get(i.ItemType.PCB)||0;const b=()=>{t.set(i.ItemType.Wood,p),t.set(i.ItemType.Glass,m),t.set(i.ItemType.Battery,g),t.set(i.ItemType.Iron,_),t.set(i.ItemType.PCB,y)};document.querySelector("#craft #campfire .button").onclick=()=>{p>=o&&(p-=o,b(),n(i.ItemType.Campfire),e())},s.$("#craft #flashlight .button").onclick=()=>{m>=c&&g>=h&&_>=l&&(m-=c,g-=h,_-=l,b(),n(i.ItemType.Flashlight),e())},s.$("#craft #pickaxe .button").onclick=()=>{p>=a&&_>=u&&(p-=a,_-=u,b(),n(i.ItemType.Pickaxe),e())},s.$("#craft #radio .button").onclick=()=>{_>=d&&g>=f&&y>=v&&(_-=d,g-=f,y-=v,b(),n(i.ItemType.Radio),e())},s.$("#craft .close").onclick=()=>{n(null),e()},document.querySelectorAll("#craft .wood").forEach(t=>t.innerHTML=p.toString()),document.querySelectorAll("#craft .iron").forEach(t=>t.innerHTML=_.toString()),document.querySelectorAll("#craft .glass").forEach(t=>t.innerHTML=m.toString()),document.querySelectorAll("#craft .pcb").forEach(t=>t.innerHTML=y.toString()),document.querySelectorAll("#craft .battery").forEach(t=>t.innerHTML=g.toString())})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.updateTools=void 0;const r=n(27),i=n(64);e.updateTools=function(t,e){const n=i.$("#tools");n.innerHTML="",t.forEach((t,i)=>{const s=document.createElement("li");s.classList.add("tool"),e==i&&s.classList.add("active"),s.innerHTML=`<span class="name">${r.ItemName[t.type]}</span>x<span class="count">${t.count}</span>`,n.appendChild(s)})}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.NetworkPlayer=void 0;const s=n(0),o=n(26),a=n(65),u=n(68),c=n(67),l=n(28),h=i(n(69)),d=n(35),f=n(11);class v extends l.SpriteObject{constructor(t,e){super(),this.flashlight=new u.FlashLight,t.add(this.flashlight,this),this.session=e,this.init()}init(){return r(this,void 0,void 0,(function*(){const t=yield o.loadImage(h.default),e=new s.Texture2D;e.filterMode=s.FilterMode.Nearest,e.format=f.TextureFormat.RGBA,e.setData(t),this.sprite=new d.Sprite(e,s.vec2(16,16),s.vec2(4,7))}))}sync(t){this.position=s.vec3(t.pos[0],t.pos[1],3)}setObj(t){switch(t.type){case"campfire":a.Campfire.spawn(s.vec2(t.pos[0],t.pos[1]));break;case"mark":c.Mark.makeOnGround(s.vec2(t.pos[0],t.pos[1]))}}}e.NetworkPlayer=v},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GameSession=void 0;const r=n(127),i=n(70);e.GameSession=class{constructor(t,e){this.id="",this.seed="seed",this.onError=()=>{},this.onSync=()=>{},this.onStart=()=>{},this.onSetObj=()=>{},this.name=e,this.socket=new r.FakeServer,this.socket.onmessage=this.handshake.bind(this),this.socket.onopen=this.start.bind(this)}sendSync(t){const e={id:this.id,type:i.MessageType.Sync,data:t};this.sendMsg(e)}setObj(t){const e={id:this.id,type:i.MessageType.SetObject,data:t};this.sendMsg(e)}handshake(t){const e=JSON.parse(t.data);switch(e.type){case i.MessageType.ServerHandshake:this.id=e.data.id;break;case i.MessageType.Start:this.socket.onmessage=this.serverSync.bind(this),this.seed=e.data.seed,this.onStart(e.data);break;default:throw new Error("Invalid server message")}}serverSync(t){const e=JSON.parse(t.data);switch(e.type){case i.MessageType.Sync:this.onSync(e.data);break;case i.MessageType.SetObject:this.onSetObj(e.data);break;default:throw new Error("Invalid server message")}}sendMsg(t){try{this.socket.send(JSON.stringify(t))}catch(t){console.error(t)}}start(){const t={id:"",type:i.MessageType.Join,data:{name:this.name}};this.socket.send(JSON.stringify(t))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FakeServer=void 0;const r=n(70);e.FakeServer=class{constructor(){setTimeout(()=>{var t,e;null===(t=this.onopen)||void 0===t||t.call(this),null===(e=this.onmessage)||void 0===e||e.call(this,{data:JSON.stringify({type:r.MessageType.ServerHandshake,data:{id:"ID"}})}),this.sendToClient({type:r.MessageType.Start,data:{seed:Math.floor(Math.random()*(1<<30)).toString(),spawn:[0,0]}})},100)}send(t){}sendToClient(t){var e;null===(e=this.onmessage)||void 0===e||e.call(this,{data:JSON.stringify(t)})}}}]);
//# sourceMappingURL=index.js.map